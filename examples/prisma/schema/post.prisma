/// 게시글(Post) 정보
model posts {
  id         String    @id @db.Uuid
  user_id    String    @db.Uuid
  status     String    @db.VarChar
  created_at DateTime  @db.Timestamptz
  deleted_at DateTime? @db.Timestamptz

  author         users            @relation(fields: [user_id], references: [id])
  snapshots      post_snapshots[]
  comments       comments[]
  media          post_media[]
  hashtags       post_tags[]
  recommended_by recommend_logs[]
}

/// 게시글 Snapshot(버전)
model post_snapshots {
  id         String   @id @db.Uuid
  post_id    String   @db.Uuid
  content    String
  visibility String   @db.VarChar
  location   String?
  created_at DateTime @db.Timestamptz

  post     posts                 @relation(fields: [post_id], references: [id])
  media    post_snapshot_media[]
  hashtags post_snapshot_tags[]
}

/// 게시글 snapshot과 Media N:M
model post_snapshot_media {
  id               String @id @db.Uuid
  post_snapshot_id String @db.Uuid
  media_id         String @db.Uuid
  sequence         Int    @db.Integer

  post_snapshot post_snapshots @relation(fields: [post_snapshot_id], references: [id])
  media         media          @relation(fields: [media_id], references: [id])

  @@unique([post_snapshot_id, media_id])
}

/// 게시글 snapshot과 Tag N:M (해시태그)
model post_snapshot_tags {
  id               String @id @db.Uuid
  post_snapshot_id String @db.Uuid
  tag_id           String @db.Uuid

  post_snapshot post_snapshots @relation(fields: [post_snapshot_id], references: [id])
  tag           tags           @relation(fields: [tag_id], references: [id])

  @@unique([post_snapshot_id, tag_id])
}

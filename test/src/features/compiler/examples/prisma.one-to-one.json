{"files":[{"filename":"schema-01-core.prisma","namespace":"Core","models":[{"name":"ai_mall_customer","description":"[Customer account entity] - This implements end-user customer account management as required in the User & Access Management and the System Architecture documentation. \n\nHolds core data for individual shoppers—credential link, profile, and status. Maintains 3NF by separating authentication, profile, and verification. For example, when a shopper signs up or manages their own orders, this entity provides their account anchor, and links to profile (1:1) and verification (1:N). \n\nKey relationships: connects to user profile (1:1, unique), user verification (1:N), and relevant foreign keys in other domains (orders, cart, etc). \nSpecial behaviors: soft deletion, registration timestamp, RBAC mapping; each customer is a unique, actor-scoped user.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Customer primary key] - Implements uniqueness per customer account as required by the access management requirement. \n\nAtomic and unique per customer; all relationships reference this UUID. For example, all orders placed by a given customer link here. Strict integrity: cannot be NULL, always generated."},"foreignFields":[{"name":"user_profile_id","type":"uuid","description":"[Relationship to ai_mall_user_profile] - Each customer references exactly one user profile, ensuring separation between account and personal data, per 3NF. \n\nBusiness use: Links customer accounts to their human profile. For example, updating profile details such as address or language links here.\nEnsures integrity by foreign key constraint.","target":"ai_mall_user_profile","unique":true,"nullable":false,"relation":{"name":"userProfile","fields":["user_profile_id"],"references":["id"],"onDelete":"Restrict","targetModel":"ai_mall_user_profile"}}],"plainFields":[{"name":"registered_at","type":"datetime","description":"[Registration timestamp] - Implements traceability of customer registration (audit/compliance).\n\nBusiness meaning: date/time the customer signed up. Atomic by nature. Used for onboarding metrics, account lifecycle analysis.\nAlways required; no business-logic aggregation.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Soft deletion timestamp] - Implements logical deletion as required for GDPR and business policy. Null if active, set if deleted; supports compliance for 'right to be forgotten'. Allows safe deactivation without data loss.","nullable":true}],"uniqueIndexes":[{"name":"uq_ai_mall_customer_user_profile_id","fieldNames":["user_profile_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_seller","description":"[Seller account entity] - Implements the platform seller model from the User & Access Management document. \n\nRepresents business or individual accounts authorized to list and manage products. Maintains 3NF by referencing independent profile and organization data. For example, a business seller managing a storefront on the platform will have an account here. \nKey relationships: links to user profile (1:1), organization (M:1), user verification (1:N), and product/catalog entities. \nSpecial behaviors: soft deletion, audit trail of registration and organization association.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Seller primary key] - System-unique seller account identifier.\n\nAtomic, not derived. All seller platform actions, including product and campaign management, refer here. No calculated fields."},"foreignFields":[{"name":"user_profile_id","type":"uuid","description":"[Relationship to ai_mall_user_profile] - Each seller is linked to a unique platform profile. Enforces distinct business-persona mapping. Used for role assignment, communication, and profile updates.","target":"ai_mall_user_profile","unique":true,"nullable":false,"relation":{"name":"userProfile","fields":["user_profile_id"],"references":["id"],"onDelete":"Restrict","targetModel":"ai_mall_user_profile"}},{"name":"organization_id","type":"uuid","description":"[Relationship to ai_mall_organization] - Seller can belong to an organization (e.g., company account). M:N possible via organization memberships (if needed, handled by junctions elsewhere).\n\nEnables group policies, analytics, and legal scoping.","target":"ai_mall_organization","unique":false,"nullable":true,"relation":{"name":"organization","fields":["organization_id"],"references":["id"],"onDelete":"SetNull","targetModel":"ai_mall_organization"}}],"plainFields":[{"name":"registered_at","type":"datetime","description":"[Registration timestamp] - When seller joined the platform. Enables analytics, onboarding funnel review, compliance tracking.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Soft deletion timestamp] - Logical account deletion for GDPR/business-policy compliance. Null if active.","nullable":true}],"uniqueIndexes":[{"name":"uq_ai_mall_seller_user_profile_id","fieldNames":["user_profile_id"],"unique":true}],"plainIndexes":[{"name":"ix_ai_mall_seller_organization_id","fieldNames":["organization_id"]}],"ginIndexes":[]},{"name":"ai_mall_admin","description":"[Administrator account entity] - Implements core administrator management and system-wide access segregation per compliance requirements.\n\nAdmins manage the entire platform—all permissions, monitoring, and auditing. Each admin is mapped to a single user profile. Maintains strict 3NF—no denormalized profiles or roles stored here directly.\nFor example, all admin activities (policy changes, reviews) are tracked to this anchor. \nKey relationships: 1:1 user profile, 1:N verifications, system audit logs. \nSpecial behaviors: soft deletion, system role flag; used in audit trail enforcement.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Admin primary key] - Unique admin account identity. Atomic; all admin actions map to this. No business-data calculated here."},"foreignFields":[{"name":"user_profile_id","type":"uuid","description":"[Relationship to ai_mall_user_profile] - Unique human identity linkage. Ensures profile/account separation for audit and compliance. For example, changing administrator contact info updates via profile relation.","target":"ai_mall_user_profile","unique":true,"nullable":false,"relation":{"name":"userProfile","fields":["user_profile_id"],"references":["id"],"onDelete":"Restrict","targetModel":"ai_mall_user_profile"}}],"plainFields":[{"name":"registered_at","type":"datetime","description":"[Registration timestamp] - Track when admin was added to the system. Used for compliance, operator rollouts, audit trails.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Soft deletion timestamp] - Logical removal for role revoking, compliance, or reassignment. Null if admin still active.","nullable":true}],"uniqueIndexes":[{"name":"uq_ai_mall_admin_user_profile_id","fieldNames":["user_profile_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_user_verification","description":"[User verification event entity] - Implements the multi-step verification/audit requirement for user accounts (customer/seller/admin) from User Management and Compliance specs.\n\nCaptures one event per verification (email, mobile, KYC, etc). Strict 3NF by storing each as an atomic record with a single foreign user ref. For example, tracking a customer's email verification or a seller's KYC step uses this table.\nKey relationships: references user profile (M:N—multiple verif events per user, each event only linked to one profile). Relates to customer/seller/admin but does not duplicate their fields.\nBehavior: immutable logs, timestamp per event, nullable expiry for OTPs, deletion handled by record removal.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Verification event primary key] - Unique event ID, never reused. Enables precise tracing; all verifications reference this as their event basis."},"foreignFields":[{"name":"user_profile_id","type":"uuid","description":"[Related ai_mall_user_profile] - Event applies to this profile (customer, seller, or admin). Normalized: does not store duplicated user info.","target":"ai_mall_user_profile","unique":false,"nullable":false,"relation":{"name":"userProfile","fields":["user_profile_id"],"references":["id"],"onDelete":"Cascade","targetModel":"ai_mall_user_profile"}}],"plainFields":[{"name":"verification_type","type":"string","description":"[Type of verification] - e.g., 'email', 'mobile', 'kyc', etc. Maps directly to business/requirement: which method was used? Used for policy and analytics. Required, atomic, normalized.","nullable":false},{"name":"verified_at","type":"datetime","description":"[Verification timestamp] - When the verification occurred or completed. Enables compliance tracing and audit log matching.","nullable":false},{"name":"expires_at","type":"datetime","description":"[Expiry, for temporary verifications] - Null if permanent. OTP or temporary verifications have a deadline; supports cycling, security.","nullable":true},{"name":"success","type":"boolean","description":"[Verification outcome] - True if successful, false if failed/expired, for audit/statistic granularity. Atomic, not derived.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"name":"ix_ai_mall_user_verification_user_profile_id_type","fieldNames":["user_profile_id","verification_type"]}],"ginIndexes":[]},{"name":"ai_mall_user_profile","description":"[User profile entity] - Implements strict 3NF division of core profile info from account/role-specific data. \n\nContains unique, atomic profile data for all platform users—customers, sellers, admins. Used to provide name, contact, and locale. Referenced as 1:1 by all account types. For example, editing contact info updates only this table, not customer/seller/admin tables. \nKey relationships: referenced by customer, seller, admin accounts; linked to verifications. \nBehavior: does not store sensitive authentication/authorization data or sensitive business role info; atomic only.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Profile primary key] - Uniquely identifies user profile. Single instance per human or organization user. Not derived, not calculated."},"foreignFields":[],"plainFields":[{"name":"email","type":"string","description":"[Contact email] - Human account email for notification, password resets, and onboarding. Required, atomic, for communication. Must be unique across profiles.","nullable":false},{"name":"name","type":"string","description":"[Name] - Display or legal name per locale/role. Used for UIs and legal documents as required; all roles reference. Required.","nullable":false},{"name":"phone","type":"string","description":"[Phone, international format] - SMS/contact number for OTPs, notifications. Required for security/country compliance. Maintains atomicity.","nullable":false},{"name":"locale","type":"string","description":"[Locale/language code] - User’s chosen locale for communications. Required for accessibility, regionalization. Normalized to avoid duplication.","nullable":false},{"name":"avatar_url","type":"uri","description":"[Avatar image URI] - Profile image link, atomic. Null if unset. No transformations or thumbnails calculated here.","nullable":true},{"name":"created_at","type":"datetime","description":"[Profile creation timestamp] - When this profile was created. Required for auditing and metrics, no business-level calculation here.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Profile update timestamp] - Last time the profile was changed; for compliance and audit trail.","nullable":false}],"uniqueIndexes":[{"name":"uq_ai_mall_user_profile_email","fieldNames":["email"],"unique":true}],"plainIndexes":[{"name":"ix_ai_mall_user_profile_locale","fieldNames":["locale"]}],"ginIndexes":[{"name":"gin_ai_mall_user_profile_name","fieldName":"name"}]},{"name":"ai_mall_organization","description":"[Organization/company entity] - Implements account grouping, legal scope, and seller management under legal entities per User Management and Compliance requirements.\n\nRepresents seller organizations (companies) or admin groups. Maintains normalized legal/communication info for each organization. For example, a franchise seller managing multiple accounts will be referenced here. \nKey relationships: referenced by sellers. \nBehavior: atomic, no user account fields; legal details only. Organization membership/junction modeling handled elsewhere if M:N is needed.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Organization primary key] - Unique company or group identifier for legal business mapping. Not derived."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","description":"[Organization name] - Legal/trade name of the organization. Used for reporting, analytics, and legal/notification context. Atomic, required.","nullable":false},{"name":"contact_email","type":"string","description":"[Organization contact email] - Primary business communication channel. Used for admin contacts, notifications, compliance events. Atomic.","nullable":false},{"name":"contact_phone","type":"string","description":"[Organization contact phone number] - For business support and legal notifications. Atomic, required for company verification or urgent comms. Not duplicated.","nullable":false},{"name":"address","type":"string","description":"[Registered address] - Legal business address for compliance and communication. Atomic, not derived.","nullable":false},{"name":"locale","type":"string","description":"[Default organization locale] - Main region/language preference for communications and notifications. Used for localization and legal notices.","nullable":false},{"name":"created_at","type":"datetime","description":"[Organization creation timestamp] - When the organization was created in the system; supports compliance and metrics. Atomic.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Organization update timestamp] - Last update, for tracking legal/account changes and compliance needs.","nullable":false}],"uniqueIndexes":[{"name":"uq_ai_mall_organization_name","fieldNames":["name"],"unique":true}],"plainIndexes":[{"name":"ix_ai_mall_organization_locale","fieldNames":["locale"]}],"ginIndexes":[]}]},{"filename":"schema-02-product-catalog.prisma","namespace":"ProductCatalog","models":[{"name":"ai_mall_channel","description":"Sales & Engagement Channels - Implements requirement for multipurpose channel segregation from '02_ai-mall_business-concepts.md' and '09_ai-mall_system-architecture-and-extensibility.md'.\n\nDistinct sales/marketing/engagement channels. Maintains strict 3NF by separating channel atomic data from product, section, or assignment tables. Used for multi-channel operations, admin enable/disable flows, and referenced by sections and products.\n\nKey relationships: Used by sections, categories, products. Controlled activation/deactivation.\nSpecial behaviors: Unique by code; can be soft-deleted for business lifecycle.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Channel unique ID."},"foreignFields":[],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Channel display name. E.g., 'Web Store', 'Mobile App'."},{"name":"code","type":"string","nullable":false,"description":"Business code for this channel, e.g., 'WEB'."},{"name":"is_active","type":"boolean","nullable":false,"description":"Is this channel enabled for user access?"},{"name":"created_at","type":"datetime","nullable":false,"description":"Creation time."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Update time."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp, nullable."}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true,"description":"Unique business code."}],"plainIndexes":[{"fieldNames":["is_active"],"description":"Search channels by status."}],"ginIndexes":[]},{"name":"ai_mall_section","description":"UI Content Sections - Logical UI groupings (banners, carousels, AI suggestion sections, etc), each belonging to a channel. 3NF: section logic not embedded in channels, nor in products. Used for both manual and AI-driven content groupings configurable by admin/seller.\n\nKey relationships: links to channel via channel_id. Used for admin UI content placement; never duplicates product or category data.\nSpecial behaviors: Can be toggled active/inactive and uniquely named per channel.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Section unique ID."},"foreignFields":[{"name":"channel_id","type":"uuid","target":"ai_mall_channel","relation":{"name":"channel","model":"ai_mall_channel","targetModel":"ai_mall_channel"},"unique":false,"nullable":false,"description":"Reference channel for this section."}],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Display name, e.g., 'Featured', 'AI Recommendations'."},{"name":"type","type":"string","nullable":false,"description":"Single word/short layout code (e.g., 'carousel', 'banner')."},{"name":"position","type":"int","nullable":false,"description":"UI position/order for rendering in channel."},{"name":"is_active","type":"boolean","nullable":false,"description":"Is this section enabled/hidden?"},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last updated timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete timestamp, nullable."}],"uniqueIndexes":[{"fieldNames":["channel_id","name"],"unique":true,"description":"Name must be unique within the channel."}],"plainIndexes":[{"fieldNames":["channel_id"],"description":"Search sections by channel."}],"ginIndexes":[]},{"name":"ai_mall_category","description":"Product Categories - Implements hierarchical catalog classification structure from '02_ai-mall_business-concepts.md'.\n\nStrict 3NF: Only contains atomic name/description data, self-referential for parent relationship. Used for browsing, filtering, analytics; no denormalized count/summary data. AI can propose category reorganizations.\n\nKey relationships: Self-references parent_id; used by products for grouping.\nSpecial behaviors: Unique by (name, parent); supports multi-level trees; can be hidden/activated.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Category unique ID."},"foreignFields":[{"name":"parent_id","type":"uuid","target":"ai_mall_category","relation":{"name":"parent","model":"ai_mall_category","targetModel":"ai_mall_category","mappingName":"recursive"},"unique":false,"nullable":true,"description":"Self-reference for parent category (null if top-level)."}],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Category display name."},{"name":"description","type":"string","nullable":false,"description":"Atomic description, for admin/browse."},{"name":"is_active","type":"boolean","nullable":false,"description":"Is category available for use?"},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last updated timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete timestamp, nullable."}],"uniqueIndexes":[{"fieldNames":["name","parent_id"],"unique":true,"description":"Unique name per parent."}],"plainIndexes":[{"fieldNames":["parent_id"],"description":"Index for tree queries."}],"ginIndexes":[{"fieldName":"name","description":"Full-text GIN: search by category name."},{"fieldName":"description","description":"Full-text GIN: search by category description."}]},{"name":"ai_mall_product","description":"Products/Catalog Items - Core item records per '04_ai-mall_product-management.md'.\n\nStrictly normalized (3NF): atomic product info only, no pre-calculated fields; all inventory/pricing/summary logic kept in other tables. Supports AI-driven suggestions (title_suggestions) without being canonical. Catalog structure, audit, and versioning enforced externally.\n\nKey relationships: seller_id (FK, ai_mall_seller); optional category grouping for browsing. Used as reference by option, variant, bundle M:N/junction tables.\nSpecial behaviors: Updates create snapshots. Name unique per seller.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Primary product ID."},"foreignFields":[{"name":"seller_id","type":"uuid","target":"ai_mall_seller","relation":{"name":"seller","model":"ai_mall_seller","targetModel":"ai_mall_seller"},"unique":false,"nullable":false,"description":"FK to owning seller."},{"name":"category_id","type":"uuid","target":"ai_mall_category","relation":{"name":"category","model":"ai_mall_category","targetModel":"ai_mall_category"},"unique":false,"nullable":true,"description":"Optional category reference for catalog navigation."}],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Product name/title."},{"name":"description","type":"string","nullable":false,"description":"Product description, editable."},{"name":"ai_title_suggestions","type":"string","isArray":true,"nullable":false,"description":"AI-proposed titles. Not canonical."},{"name":"status","type":"string","nullable":false,"description":"Enum: draft/published/archived."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Updated timestamp."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete."}],"uniqueIndexes":[{"fieldNames":["seller_id","name"],"unique":true,"description":"Name unique per seller."}],"plainIndexes":[{"fieldNames":["category_id"],"description":"Quick lookup by category."}],"ginIndexes":[{"fieldName":"name","description":"Full-text search: name."},{"fieldName":"description","description":"Full-text search: description."}]},{"name":"ai_mall_product_option","description":"Product Options (size, color, etc.) - Normalized (3NF) option types for each product per '04_ai-mall_product-management.md'.\n\nBelongs to specific product, and only stores allowed option values—not combinations. Used to define allowed axes for each item; atomic so variants can reference only option value combinations.\n\nKey relationships: FK to ai_mall_product.\nSpecial behaviors: Can be added/removed flexibly. Uniqueness enforced per product.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Product option unique ID."},"foreignFields":[{"name":"product_id","type":"uuid","target":"ai_mall_product","relation":{"name":"product","model":"ai_mall_product","targetModel":"ai_mall_product"},"unique":false,"nullable":false,"description":"FK to product."}],"plainFields":[{"name":"option_name","type":"string","nullable":false,"description":"Type (e.g., color, size, flavor, style)."},{"name":"allowed_values","type":"string","isArray":true,"nullable":false,"description":"Allowed raw values (e.g., ['Red', 'Blue'])."},{"name":"is_required","type":"boolean","nullable":false,"description":"Option required for purchase (true/false)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete."}],"uniqueIndexes":[{"fieldNames":["product_id","option_name"],"unique":true,"description":"No duplicate types per product."}],"plainIndexes":[{"fieldNames":["product_id"],"description":"Lookup: all options for product."}],"ginIndexes":[]},{"name":"ai_mall_product_variant","description":"Product Variants - Implements 4.2 from '04_ai-mall_product-management.md'.\n\nDefines each physical/configurable version of a product (e.g., Red+M, Blue+L), atomic info only—no duplication from product or option tables. Stock, price, SKU are stored atomically here.\n\nKey relationships: FK to product. Used for inventory, order item linkage.\nSpecial behaviors: Uniqueness per (product_id, option_values).","material":false,"primaryField":{"name":"id","type":"uuid","description":"Variant ID."},"foreignFields":[{"name":"product_id","type":"uuid","target":"ai_mall_product","relation":{"name":"product","model":"ai_mall_product","targetModel":"ai_mall_product"},"unique":false,"nullable":false,"description":"FK to product."}],"plainFields":[{"name":"option_values","type":"string","isArray":true,"nullable":false,"description":"Array of selected option values for this variant."},{"name":"sku","type":"string","nullable":false,"description":"Business SKU code."},{"name":"barcode","type":"string","nullable":true,"description":"Optional barcode."},{"name":"price","type":"double","nullable":false,"description":"Current price."},{"name":"stock","type":"int","nullable":false,"description":"Actual inventory count for this variant."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Last modified."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete."}],"uniqueIndexes":[{"fieldNames":["product_id","option_values"],"unique":true,"description":"No duplicate combination per product."},{"fieldNames":["sku"],"unique":true,"description":"SKU unique globally."}],"plainIndexes":[{"fieldNames":["product_id"],"description":"Quick lookup for all variants of product."}],"ginIndexes":[]},{"name":"ai_mall_product_bundle","description":"Product Bundles - Implements 4.3 in '04_ai-mall_product-management.md'.\n\nRepresents groupings of products as sets (pre-composed or AI-suggested). Maintains strict 3NF: only atomic bundle info, composition handled by ai_mall_bundle_item M:N table. Never stores pre-calculated or duplicate product info.\n\nKey relationships: seller_id FK. Referenced by bundle_item for composition.\nSpecial behaviors: Unique name per seller. Soft delete supported.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Bundle unique ID."},"foreignFields":[{"name":"seller_id","type":"uuid","target":"ai_mall_seller","relation":{"name":"seller","model":"ai_mall_seller","targetModel":"ai_mall_seller"},"unique":false,"nullable":false,"description":"FK to owning seller."}],"plainFields":[{"name":"name","type":"string","nullable":false,"description":"Bundle display name."},{"name":"description","type":"string","nullable":false,"description":"Optional freeform/marketing description."},{"name":"discount_type","type":"string","nullable":false,"description":"Enum: 'percentage', 'amount', 'none'."},{"name":"discount_value","type":"double","nullable":false,"description":"Numeric value for discount (0 if none)."},{"name":"is_active","type":"boolean","nullable":false,"description":"Bundle can/can't be selected by end users."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-delete."}],"uniqueIndexes":[{"fieldNames":["seller_id","name"],"unique":true,"description":"Unique bundle name per seller."}],"plainIndexes":[{"fieldNames":["seller_id"],"description":"Search bundles for seller."}],"ginIndexes":[{"fieldName":"name","description":"Bundle name FTS."},{"fieldName":"description","description":"Bundle desc FTS."}]},{"name":"ai_mall_bundle_item","description":"Bundle Membership Junction - M:N composition table between product_bundle and product. Implements normalized set relationships from 4.3 of requirement docs.\n\nStrict 3NF: only atomic data for composition (FKs, quantity, discount per item). No duplicate group summaries.\n\nKey relationships: bundle_id/product_id FKs. Uniqueness per bundle-product enforced.\nSpecial behaviors: Can soft delete rows; allows arbitrary quantity/discount for each relation.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Bundle membership row ID, unique."},"foreignFields":[{"name":"bundle_id","type":"uuid","target":"ai_mall_product_bundle","relation":{"name":"bundle","model":"ai_mall_product_bundle","targetModel":"ai_mall_product_bundle"},"unique":false,"nullable":false,"description":"FK to bundle."},{"name":"product_id","type":"uuid","target":"ai_mall_product","relation":{"name":"product","model":"ai_mall_product","targetModel":"ai_mall_product"},"unique":false,"nullable":false,"description":"FK to product included in this bundle."}],"plainFields":[{"name":"quantity","type":"int","nullable":false,"description":"Absolute (not derived) quantity of this product in bundle."},{"name":"fixed_discount","type":"double","nullable":false,"description":"Fixed item-specific discount value."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created at."},{"name":"updated_at","type":"datetime","nullable":false,"description":"Update."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft delete."}],"uniqueIndexes":[{"fieldNames":["bundle_id","product_id"],"unique":true,"description":"No duplicate product memberships per bundle."}],"plainIndexes":[{"fieldNames":["product_id"],"description":"Lookup: bundles per product."}],"ginIndexes":[]},{"name":"ai_mall_product_snapshot","description":"Product Snapshot - Implements 4.4 (Catalog Snapshots/Audits) from '04_ai-mall_product-management.md'.\n\nRecords versioned, atomic \"image\" of product fields at a point in time. Does not copy-calculated state, only reflects data available at snapshot time. 3NF: No summary/denormalized info stored here. Used for rollback, audit histories, compliance.\n\nKey relationships: FK to ai_mall_product. Used for viewing revertable changes and audit trails.\nSpecial behaviors: Only one snapshot per product per timestamp.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Snapshot ID."},"foreignFields":[{"name":"product_id","type":"uuid","target":"ai_mall_product","relation":{"name":"product","model":"ai_mall_product","targetModel":"ai_mall_product"},"unique":false,"nullable":false,"description":"FK to product whose snapshot is recorded."}],"plainFields":[{"name":"snapshot_time","type":"datetime","nullable":false,"description":"Timestamp for this snapshot version."},{"name":"snapshot_data","type":"string","nullable":false,"description":"Serialized atomic product data at that time."},{"name":"created_at","type":"datetime","nullable":false,"description":"Row creation timestamp."}],"uniqueIndexes":[{"fieldNames":["product_id","snapshot_time"],"unique":true,"description":"Only one snapshot per product per timestamp."}],"plainIndexes":[{"fieldNames":["product_id"],"description":"Product lookup: all snapshots."}],"ginIndexes":[]},{"name":"ai_mall_product_audit","description":"Product Audit Log - Audit history row per 4.4 from '04_ai-mall_product-management.md'.\n\nAtomic (non-snapshot) event log for every significant action (CRUD, AI-proposal, restore/rollback, etc). Separate from product or snapshot tables. 3NF: only event data, never redundant or derived info. Used for audit review, compliance, and restoration workflows.\n\nKey relationships: FK to ai_mall_product.\nSpecial behaviors: Unique per product/time; stores before/after for audit trace and compliance restoration.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Audit log ID."},"foreignFields":[{"name":"product_id","type":"uuid","target":"ai_mall_product","relation":{"name":"product","model":"ai_mall_product","targetModel":"ai_mall_product"},"unique":false,"nullable":false,"description":"FK to product being audited."}],"plainFields":[{"name":"event_type","type":"string","nullable":false,"description":"Action performed (create/update/delete/restore/ai_suggestion/rollback)."},{"name":"actor","type":"string","nullable":false,"description":"User or system role responsible (free-text ID, typically linked cross-file to user mgmt/audit)."},{"name":"event_time","type":"datetime","nullable":false,"description":"Time at which this event occurred."},{"name":"before_data","type":"string","nullable":false,"description":"JSON/text before-state for event."},{"name":"after_data","type":"string","nullable":false,"description":"JSON/text after-state for event."},{"name":"description","type":"string","nullable":false,"description":"Explanation/context for event."},{"name":"created_at","type":"datetime","nullable":false,"description":"Created timestamp."}],"uniqueIndexes":[{"fieldNames":["product_id","event_time"],"unique":true,"description":"Unique event per timestamp per product."}],"plainIndexes":[{"fieldNames":["event_type","actor"],"description":"Quick event search by actor/type."},{"fieldNames":["product_id"],"description":"All events for a product."}],"ginIndexes":[]}]},{"filename":"schema-03-cart-orders-payments.prisma","namespace":"CartOrdersPayments","models":[{"name":"ai_mall_cart","description":"[Shopping Cart Model] - This implements the persistent, cross-device shopping cart requirement (Section 6.5, 'Shopping Cart') from the requirements document.\n\nAllows customers to manage their product selections across sessions and devices with support for guest and authenticated users. Maintains 3NF compliance by separating cart structure (ai_mall_cart) from cart items (ai_mall_cart_item). For example, a customer logs in from mobile and web and always sees a consistent cart state.\n\nKey relationships: links to ai_mall_customer (owner), ai_mall_cart_item (items), ai_mall_channel (channel/storefront context). Special behaviors: Guest carts may be purged, abandoned carts are tracked for recommendations and analytics; no pre-calculated fields, all state is atomic.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Represents the unique identifier for each cart. Implements the atomic identity requirement and ensures normalization by serving as the only 1NF-appropriate unique key.","id":true},"foreignFields":[{"name":"customer_id","type":"uuid","description":"[Customer Reference] - Implements the linkage to the ai_mall_customer entity, establishing ownership of the cart as per the multi-device persistence requirement. Ensures normalization by storing only the reference, not customer data. Example: Links an active session cart to a specific logged-in user.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"nullable":false,"unique":true},{"name":"channel_id","type":"uuid","description":"[Channel Context] - Links cart to a specific ai_mall_channel, supporting omnichannel operations (web/mobile/storefronts). Normalized as only the reference is held. Cart recommendations and UI vary by channel. Example: A saved web cart is distinct from mobile app cart.","relation":{"name":"channel","targetModel":"ai_mall_channel"},"nullable":false,"unique":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"[Cart Creation Timestamp] - Records when the cart was first created, supporting audit and rollback per compliance needs. Maintains normalization by holding atomic data. Example: Used to track cart abandonment age.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Cart Update Timestamp] - Stores last update time for the cart contents, enabling stale cart detection and AI-based recovery prompts. 3NF compliance by keeping only atomic, non-derived date values.","nullable":false},{"name":"is_guest","type":"boolean","description":"[Guest Cart Flag] - Marks if the cart is for a guest session, enabling automatic expiration and purging policies. Ensures full normalization by isolating only the flag.","nullable":false}],"uniqueIndexes":[{"name":"unique_customer_channel_cart","fieldNames":["customer_id","channel_id"],"unique":true}],"plainIndexes":[{"name":"idx_cart_created_at","fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"ai_mall_cart_item","description":"[Cart Item Model] - Implements per-itemization of cart contents (Section 6.5, 'Shopping Cart') from requirements. Supports atomic item-line tracking for 3NF compliance.\n\nAllows management of multiple products/variants in a cart, each as a separate row. Maintain strict normalization by referencing product or product_variant directly—no duplication of product details. Example: A cart contains both SKU-1 (blue shirt, L) and SKU-2 (pants, M) as atomic rows.\n\nKey relationships: ai_mall_cart (parent cart), ai_mall_product (product), ai_mall_product_variant (specific SKU/option). Special behaviors: Quantity and price must always be updated based on current stock/AI rules.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique item instance for this cart, enforcing 1NF uniqueness for all cart lines.","id":true},"foreignFields":[{"name":"cart_id","type":"uuid","description":"[Cart Reference] - Links each item atomically to its parent cart, 3NF compliant. Example: Lets system manage multi-item carts cleanly.","relation":{"name":"cart","targetModel":"ai_mall_cart"},"nullable":false,"unique":false},{"name":"product_id","type":"uuid","description":"[Product Reference] - Links to ai_mall_product for basic item details. Ensures atomic, foreign relationship only; price, stock must not be duplicated here. Example: SKU-1 references product T-shirt.","relation":{"name":"product","targetModel":"ai_mall_product"},"nullable":false,"unique":false},{"name":"product_variant_id","type":"uuid","description":"[Variant Reference] - Links to ai_mall_product_variant for option/SKU specificity. Enforces normalization: no variant fields/description duplicated here. Example: Blue/L cart line references specific variant row.","relation":{"name":"productVariant","targetModel":"ai_mall_product_variant"},"nullable":true,"unique":false}],"plainFields":[{"name":"quantity","type":"int","description":"[Item Quantity] - Purely atomic count of items for this row. Maintains 3NF by not introducing derived/cached values. Example: 3 units of product in cart.","nullable":false},{"name":"added_at","type":"datetime","description":"[Added Timestamp] - When this line was added to cart. Supports triggers for automated cart actions. Example: Used for item freshness/expiration.","nullable":false}],"uniqueIndexes":[{"name":"unique_cart_product_variant","fieldNames":["cart_id","product_id","product_variant_id"],"unique":true}],"plainIndexes":[{"name":"idx_cart_item_product","fieldNames":["product_id"]}],"ginIndexes":[]},{"name":"ai_mall_order","description":"[Order Model] - Implements unique, traceable order creation as required in Cart & Order System (Section 6.5, 'Order Management').\n\nEach order row atomically represents a customer order, normalized from any cart or checkout flow and decoupled from transient cart state (3NF). Example: A completed checkout produces an entry here, distinct from cart.\n\nKey relationships: ai_mall_customer (order owner), ai_mall_channel (source channel), ai_mall_shipping_address (target address), ai_mall_order_item (line items).\nSpecial behaviors: Status tracking is handled atomically; audit and lifecycle handled via ai_mall_order_audit.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - 1NF atomic identity for order. Uniquely represents each transaction for compliance and audit."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"[Customer Reference] - Links order to purchaser. 3NF compliance by holding pointer, not customer details.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"nullable":false,"unique":false},{"name":"channel_id","type":"uuid","description":"[Channel Reference] - Channel context for order placement. Allows analysis/reporting per channel.","relation":{"name":"channel","targetModel":"ai_mall_channel"},"nullable":false,"unique":false},{"name":"shipping_address_id","type":"uuid","description":"[Shipping Address] - References ai_mall_shipping_address for where to deliver this order. Fully normalized, no address fields duplicated here.","relation":{"name":"shippingAddress","targetModel":"ai_mall_shipping_address"},"nullable":true,"unique":false}],"plainFields":[{"name":"order_number","type":"string","description":"[Business Order Number] - Unique, sequential code per order; e.g. ORD-20250715-00001. Atomic value, not derived; maintained externally for reporting.","nullable":false},{"name":"status","type":"string","description":"[Order Status] - Atomic workflow state: e.g. 'pending', 'confirmed', 'shipped', 'delivered', 'canceled'. Ensures compliance with 3NF by storing the base state only, not derived summaries. Used for lifecycle management and auditing.","nullable":false},{"name":"ordered_at","type":"datetime","description":"[Order Timestamp] - When the order was created from a finalized cart. Supports compliance and workflow automation. Normalized atomic field.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Last Update Timestamp] - Records last workflow-related change to the order (e.g., shipped/canceled). Each change also triggers audit entry. 3NF compliance; no derived aggregates.","nullable":false}],"uniqueIndexes":[{"name":"unique_order_number","fieldNames":["order_number"],"unique":true}],"plainIndexes":[{"name":"idx_order_status","fieldNames":["status"]}],"ginIndexes":[]},{"name":"ai_mall_order_item","description":"[Order Item Model] - Implements the line-item breakdown of orders (Section 6.5). Strictly normalized 3NF records separating order metadata from items purchased.\n\nEach row represents an atomic purchase item within an order. Example: An order with two shirts and a belt results in two ai_mall_order_item rows.\n\nKey relationships: ai_mall_order (parent), ai_mall_product (item), ai_mall_product_variant (specific SKU/option). Special behaviors: No pre-calculated or cached totals; inventory logic handled outside this table.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique atomic identifier for one item in the order (e.g., one row for each unique product/SKU purchased)."},"foreignFields":[{"name":"order_id","type":"uuid","description":"[Order Reference] - Links this row to the specific order. Ensures strict normalization by not including order metadata here.","relation":{"name":"order","targetModel":"ai_mall_order"},"nullable":false,"unique":false},{"name":"product_id","type":"uuid","description":"[Product Reference] - Specifies which product was purchased. Ensures atomic product reference only; no product details copied here.","relation":{"name":"product","targetModel":"ai_mall_product"},"nullable":false,"unique":false},{"name":"product_variant_id","type":"uuid","description":"[Variant Reference] - Links to ai_mall_product_variant for option/SKU specificity. Guarantees 3NF: no denormalization or duplication of name, price, etc.","relation":{"name":"productVariant","targetModel":"ai_mall_product_variant"},"nullable":true,"unique":false}],"plainFields":[{"name":"quantity","type":"int","description":"[Ordered Quantity] - Number of units of this product purchased. Atomic per line; no summation calculations stored.","nullable":false},{"name":"unit_price","type":"double","description":"[Sale Unit Price] - Sold price at the time of purchase (atomic). No derived/cached total values or averages. Normalization: only the paid price per SKU, not historical pricing info.","nullable":false}],"uniqueIndexes":[{"name":"unique_order_product_variant","fieldNames":["order_id","product_id","product_variant_id"],"unique":true}],"plainIndexes":[{"name":"idx_order_item_product","fieldNames":["product_id"]}],"ginIndexes":[]},{"name":"ai_mall_order_audit","description":"[Order Audit Model] - Implements comprehensive audit trail (Section 6.5, \"Audit logging for sensitive/financial transactions\").\n\nAtomic log record of all order status changes, user actions, and system events tied to a specific ai_mall_order. Strict 3NF: only atomic event info. Example: If order moves from 'pending' ⇒ 'shipped', a row is inserted here with before/after values. Used for compliance, rollback, and fraud analysis.\n\nKey relationships: ai_mall_order (audited), ai_mall_customer (actor/customer), ai_mall_admin (admin actors). Special behaviors: All critical events are written here; restoration/rollback supported via UI referencing these rows.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Atomic row identity for the audit entry."},"foreignFields":[{"name":"order_id","type":"uuid","description":"[Order Reference] - Specifies the order being audited. Ensures proper normalization by not duplicating order state.","relation":{"name":"order","targetModel":"ai_mall_order"},"nullable":false,"unique":false},{"name":"actor_customer_id","type":"uuid","description":"[Customer Actor] - Nullable if action performed by customer; normalized reference only.","relation":{"name":"actorCustomer","targetModel":"ai_mall_customer"},"nullable":true,"unique":false},{"name":"actor_admin_id","type":"uuid","description":"[Admin Actor] - Nullable if action performed by admin; normalized reference only. Ensures 3NF by not copying admin data.","relation":{"name":"actorAdmin","targetModel":"ai_mall_admin"},"nullable":true,"unique":false}],"plainFields":[{"name":"event_type","type":"string","description":"[Event Type] - Type of audit event (e.g., 'create', 'update', 'cancel', 'ship'). Atomic, not calculated or summarized.","nullable":false},{"name":"before_status","type":"string","description":"[Before Status] - Status before this event, for rollback and reporting. Atomic, no derived/computed info.","nullable":false},{"name":"after_status","type":"string","description":"[After Status] - Status after event. Maintains normalization by storing only the atomic state value.","nullable":false},{"name":"event_payload","type":"string","description":"[Event Payload] - (Optional) Additional info as JSON string. For storing context (e.g., what fields changed). Atomic value, not summary or pre-aggregate; nullable in case of basic status change.","nullable":true},{"name":"created_at","type":"datetime","description":"[Event Timestamp] - When this audit entry was generated. Atomic for ordering in audit trail.","nullable":false}],"uniqueIndexes":[{"name":"unique_order_audit_event","fieldNames":["order_id","created_at","event_type"],"unique":true}],"plainIndexes":[{"name":"idx_order_audit_created_at","fieldNames":["created_at"]}],"ginIndexes":[{"name":"gin_order_audit_payload","fieldName":"event_payload"}]},{"name":"ai_mall_payment","description":"[Payment Model] - Implements PCI-compliant order payment reference (Section 6.5).\n\nStrictly normalized row linking a payment to a specific order. Never stores full credit card/payment details—atomic reference and compliance. For example, one ai_mall_order may have one or more payment attempts/records (e.g., retry, different methods).\n\nKey relationships: ai_mall_order (target), ai_mall_customer (payer). Special behaviors: Refunds never tracked here (use ai_mall_refund).","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique identifier per payment record."},"foreignFields":[{"name":"order_id","type":"uuid","description":"[Order Reference] - Links payment to corresponding order. Only reference, never duplicated order details.","relation":{"name":"order","targetModel":"ai_mall_order"},"nullable":false,"unique":false},{"name":"customer_id","type":"uuid","description":"[Customer Reference] - Links to the payer customer. 3NF: only the atomic reference is kept here.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"nullable":false,"unique":false}],"plainFields":[{"name":"payment_method","type":"string","description":"[Payment Method] - Enum string ('card', 'bank_transfer', 'paypal', etc). Fully atomic, 3NF. Example: 'card'.","nullable":false},{"name":"amount","type":"double","description":"[Payment Amount] - The atomic value (charged/attempted). Absolutely no summaries, only raw payment attempt value.","nullable":false},{"name":"transaction_id","type":"string","description":"[Transaction ID] - Atomic reference to provider or gateway txn; 3NF as reference only.","nullable":false},{"name":"status","type":"string","description":"[Payment Status] - Atomic; one of 'pending', 'succeeded', 'failed', 'canceled'. Maintains normalization by only recording atomic event. For reporting/audit only.","nullable":false},{"name":"paid_at","type":"datetime","description":"[Payment Timestamp] - When payment event was processed. No summaries or calculated values held.","nullable":false}],"uniqueIndexes":[{"name":"unique_order_payment_txn","fieldNames":["order_id","transaction_id"],"unique":true}],"plainIndexes":[{"name":"idx_payment_status","fieldNames":["status"]}],"ginIndexes":[]},{"name":"ai_mall_refund","description":"[Refund Model] - Implements refund transaction tracking (Section 6.5, refund/cancellation workflows).\n\nNormalized record of attempted or completed refund linked to payment/order. Complies with 3NF: refund amount, status, and atomic references only—never denormalized summaries.\n\nKey relationships: ai_mall_payment (base payment), ai_mall_order (order), ai_mall_customer (recipient). Special behaviors: Refund/cancel amounts may only be a subset of original payment; refunds require admin audit entry for reporting/audit compliance.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Atomic identity of this refund event."},"foreignFields":[{"name":"payment_id","type":"uuid","description":"[Payment Reference] - Links refund to the original payment row. Ensures strict normalization: only reference, not payment details.","relation":{"name":"payment","targetModel":"ai_mall_payment"},"nullable":false,"unique":false},{"name":"order_id","type":"uuid","description":"[Order Reference] - Atomic reference to the affected order. 3NF enforced by foreign key only.","relation":{"name":"order","targetModel":"ai_mall_order"},"nullable":false,"unique":false},{"name":"customer_id","type":"uuid","description":"[Customer Reference] - Refund recipient; atomic link only.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"nullable":false,"unique":false}],"plainFields":[{"name":"amount","type":"double","description":"[Refund Amount] - The atomic, requested or completed refund value. Pure 3NF: no cumulative/roll-up data stored.","nullable":false},{"name":"status","type":"string","description":"[Refund Status] - Atomic lifecycle value: e.g. 'pending', 'approved', 'rejected', 'completed', 'failed'. Fully normalized; used for workflow and audit only.","nullable":false},{"name":"processed_at","type":"datetime","description":"[Processed Timestamp] - When the refund was executed/attempted. No derived or summary data; strictly atomic.","nullable":false}],"uniqueIndexes":[{"name":"unique_refund_payment_proc","fieldNames":["payment_id","processed_at"],"unique":true}],"plainIndexes":[{"name":"idx_refund_status","fieldNames":["status"]}],"ginIndexes":[]},{"name":"ai_mall_shipping_address","description":"[Shipping Address Model] - Implements full separation of shipping destination from order (Section 6.5, normalized shipping/delivery info).\n\nStrict 3NF: Holds only core fields, referenced by ai_mall_order. Multiple orders can reference the same address, or update as needed—no denormalized customer/order data here.\n\nKey relationships: ai_mall_customer (address owner). Special behaviors: Change history handled outside this table (possible via audit tables elsewhere in the system).","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Atomic, normalized reference for an address."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"[Customer Reference] - The owner; not denormalized customer info, just atomic FK reference.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"nullable":false,"unique":false}],"plainFields":[{"name":"recipient_name","type":"string","description":"[Recipient Name] - Atomic, normalized name for package addressee. 3NF: never derived/concatenated from user fields.","nullable":false},{"name":"phone_number","type":"string","description":"[Recipient Phone] - Atomic value for contact. 3NF enforced; never duplicated from profile/customer table.","nullable":false},{"name":"postal_code","type":"string","description":"[Postal Code] - Fully normalized atomic field. Example: '04020'.","nullable":false},{"name":"address_line1","type":"string","description":"[Address Line 1] - Street/building. Maintains strict normalization and allows instant update on edit/change.","nullable":false},{"name":"address_line2","type":"string","description":"[Address Line 2] - Apartment/unit/etc. Strictly atomic.","nullable":true},{"name":"city","type":"string","description":"[City] - Fully atomic city/region, never composed or concatenated.","nullable":false},{"name":"state","type":"string","description":"[State/Province] - Pure atomic value of state/region.","nullable":false},{"name":"country_code","type":"string","description":"[ISO Country Code] - ISO 3166-1 alpha-2 format, e.g., 'KR', 'US'. Never denormalized.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created Timestamp] - When address was added, atomic data for audit/rollback.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Update Timestamp] - Last change to this address record (not order-level change). Ensures full address normalization and up-to-date reference.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"name":"idx_address_customer","fieldNames":["customer_id"]}],"ginIndexes":[]}]},{"filename":"schema-04-promotions-loyalty.prisma","namespace":"PromotionsLoyalty","models":[{"name":"ai_mall_promotion","description":"[Promotion Program] - This implements the core promotion requirements from the Promotions & Loyalty System (07_ai-mall_promotions-and-loyalty-system.md). Enables the creation, configuration, and lifecycle management of diverse promotion types (sitewide, seller, product).\n\nBusiness explanation: Used by admins/sellers to define discounts, campaign parameters, application rules, and validity periods for dynamic marketing. Maintains 3NF by keeping only atomic program details (no total redemption counts or denormalized stats).\n\nFor example, a seller schedules a product-specific flash sale with limited time and eligibility rules.\n\nKey relationships: referenced by coupons, campaigns, and applied to products, channels, or customer segments.\nSpecial behaviors: supports scheduling, rule-driven targeting, and admin/seller-scoped control. Deletion is soft/logical with full audit coverage.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Implements unique ID requirement. Uniquely identifies each promotion for traceability and relationships. Ensures normalization via single-identity reference point for all related models. Always generated as UUID.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"created_by_admin_id","type":"uuid","description":"[Created by Admin] - Captures which admin user created/approved the promotion. Enables role-scoped audit trail. Required for system-wide campaigns, optional for seller-scoped ones.","relation":{"name":"createdByAdmin","targetModel":"ai_mall_admin"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"seller_id","type":"uuid","description":"[Seller Scope] - Which seller (if any) owns/controls the promotion. If null, means system/global. Enforces 3NF by relating ownership atomically, never denormalizing seller details.","relation":{"name":"seller","targetModel":"ai_mall_seller"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"title","type":"string","description":"[Promotion Title] - Implements promotion naming for discovery/search. Ensures atomicity; never includes summaries or stats. Ex: 'Flash Sale - Summer Shoes'.","nullable":false},{"name":"type","type":"string","description":"[Promotion Type] - Implements the program type requirement ('discount', 'bogo', 'tiered', etc.). Fully normalized as an atomic enum. Example: 'discount', 'bogo', 'free_shipping', 'tiered', 'personalized'.","nullable":false},{"name":"description","type":"string","description":"[Description] - Brief marketing descriptor. Atomic text, not derived or calculated. Example: '10% off all summer sandals.'.","nullable":false},{"name":"rule_json","type":"string","description":"[Promotion Rules] - JSON blob for atomic eligibility and application rules (target products, limits, etc.). 3NF: no computed or precalculated values.","nullable":false},{"name":"start_at","type":"datetime","description":"[Start Time] - Promotion activation datetime. Not denormalized; atomic schedule. Example: '2025-05-01T00:00:00Z'.","nullable":false},{"name":"end_at","type":"datetime","description":"[End Time] - Promotion end datetime. Not denormalized. Example: '2025-05-07T23:59:59Z'.","nullable":false},{"name":"is_active","type":"boolean","description":"[Status Flag] - Whether currently enabled (system can deactivate without deletion). Purely atomic, no denormalization.","nullable":false},{"name":"created_at","type":"datetime","description":"[Creation Timestamp] - When promotion was created. Required for audit trail (not a summary).","nullable":false},{"name":"updated_at","type":"datetime","description":"[Update Timestamp] - Last modified time for audit/history. Not computed or denormalized.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Soft Delete Marker] - Null if active; set if logically deleted. Never removed from DB, supports compliance.","nullable":true}],"uniqueIndexes":[{"name":"unique_title_seller","fields":["title","seller_id"],"description":"Ensures a seller cannot have two active promotions with the same title, enforcing business uniqueness at the scope of each seller.","fieldNames":["title","seller_id"],"unique":true}],"plainIndexes":[{"name":"idx_promotions_active_time","fields":["is_active","start_at","end_at"],"description":"Supports efficient query of currently valid promotions in UI/checkout flows.","fieldNames":["is_active","start_at","end_at"]}],"ginIndexes":[{"name":"gin_promotions_title_desc","fields":["title","description"],"description":"Full-text/trigram search for promotion discovery by admins, sellers, customers.","fieldName":"title"}]},{"name":"ai_mall_coupon","description":"[Coupon] - Implements coupon code requirements from Promotions & Loyalty System. Each coupon is defined independently, fully normalized with no precomputed usages, totals, or aggregations.\n\nBusiness: Coupons may be issued/claimed by customers and redeemed for discounts. Creation/audit tracked by admin/seller. Examples: single-use, multi-use, or limited-time codes.\n\nKey relationships: references a promotion for logic, links to redemptions and campaigns.\nSpecial behaviors: uniquely auto-generated or human-friendly codes, expiration logic handled at runtime only. No duplicate codes allowed within scope.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Implements coupon identity for tracking/redemption. 3NF, atomic key for all coupon relationships.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"promotion_id","type":"uuid","description":"[Promotion Link] - Associates coupon with a promotion program. Ensures atomic relation, never stores promotion data redundantly. Fully normalized.","relation":{"name":"promotion","targetModel":"ai_mall_promotion"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"issued_to_customer_id","type":"uuid","description":"[Issued to Customer] - Optionally links coupon to a specific customer for targeted/disposable codes. Null if general use. 3NF: never contain customer data here.","relation":{"name":"issuedToCustomer","targetModel":"ai_mall_customer"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"created_by_admin_id","type":"uuid","description":"[Issued by Admin] - Tracks who issued/created the code. Always a foreign key for audit trail, normalized.","relation":{"name":"createdByAdmin","targetModel":"ai_mall_admin"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"seller_id","type":"uuid","description":"[Owner Seller] - For seller-specific coupons. Null if system/omni-channel. Required for per-seller limits/uniqueness.","relation":{"name":"seller","targetModel":"ai_mall_seller"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"code","type":"string","description":"[Coupon Code] - Human-readable or system-generated code. Always unique within seller or global scope. 3NF: not denormalized, not a precomputed value.","nullable":false},{"name":"type","type":"string","description":"[Coupon Type] - Tag to distinguish code behavior (e.g. 'single-use', 'multi-use', 'invite-only'). Fully normalized, atomic, not calculated.","nullable":false},{"name":"max_redemptions","type":"int","description":"[Max Redemptions] - Caps how many times this code may be redeemed (total across all customers). 3NF; not computed from actuals, only the rule.","nullable":false},{"name":"expires_at","type":"datetime","description":"[Expiry Time] - Coupon deactivation date, not calculated field.","nullable":false},{"name":"start_at","type":"datetime","description":"[Validity Start] - When can the coupon first be used.","nullable":false},{"name":"is_active","type":"boolean","description":"[Active Flag] - Allows for disabling before expiry, strictly boolean.","nullable":false},{"name":"created_at","type":"datetime","description":"[Create Time] - Track issue for audit purposes.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Update Time] - Audit tracking.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Soft Delete] - Null if not deleted; datetime if logically removed.","nullable":true}],"uniqueIndexes":[{"name":"unique_coupon_code_seller","fields":["code","seller_id"],"description":"Guarantees coupon code uniqueness per seller (or global, when seller_id is null).","fieldNames":["code","seller_id"],"unique":true}],"plainIndexes":[{"name":"idx_coupon_is_active","fields":["is_active","expires_at","start_at"],"description":"Fast query for only currently valid/active codes.","fieldNames":["is_active","expires_at","start_at"]},{"name":"idx_coupon_customer","fields":["issued_to_customer_id"],"description":"Fast lookup for customer wallet pages, especially for targeted coupons.","fieldNames":["issued_to_customer_id"]}],"ginIndexes":[{"name":"gin_coupon_code","fields":["code"],"description":"Facilitates fast fuzzy search on coupon codes, e.g. for admin lookup or fraud investigation.","fieldName":"code"}]},{"name":"ai_mall_coupon_redemption","description":"[Coupon Redemption] - Implements the coupon usage event/audit trail per the business rules (logs the redemption history for compliance, anti-fraud, and analytics). Every redemption event is recorded (atomic).\n\nBusiness: Each redemption links a coupon, customer, order, and actor (who performed/revoked if necessary). 3NF is maintained - no summary fields.\n\nFor example, a customer using a coupon during checkout logs who, what, when. Admins and sellers use this for audits and abuse prevention.\nKey relationships: Many-to-one to coupon, customer, order, and optionally admin (if overridden/canceled).\nSpecial behaviors: Non-deletable, complete historical log.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Redemption record unique identity for trace/audit.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"coupon_id","type":"uuid","description":"[Target Coupon] - The code that was redeemed. Atomic, 3NF, not denormalized.","relation":{"name":"coupon","targetModel":"ai_mall_coupon"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"customer_id","type":"uuid","description":"[Customer Redeemer] - End user who used the coupon. No denormalized user info; atomic reference.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"order_id","type":"uuid","description":"[Relevant Order] - If redemption is tied to a purchase, link to the order.","relation":{"name":"order","targetModel":"ai_mall_order"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"redeemed_by_admin_id","type":"uuid","description":"[Admin Override] - If admin manually marks as redeemed/canceled. Audit/compliance scenario.","relation":{"name":"redeemedByAdmin","targetModel":"ai_mall_admin"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"redeemed_at","type":"datetime","description":"[Redemption Time] - Timestamp of coupon usage.","nullable":false},{"name":"revoked_at","type":"datetime","description":"[Revocation Time] - If a redemption is reversed/invalidated. Optional, atomic.","nullable":true},{"name":"reason","type":"string","description":"[Redemption Reason] - Freeform compliance note or cancellation annotation.","nullable":true}],"uniqueIndexes":[{"name":"unique_coupon_customer","fields":["coupon_id","customer_id"],"description":"Prevents duplicate redemption by the same user (for single-use or invite-only coupons).","fieldNames":["coupon_id","customer_id"],"unique":true}],"plainIndexes":[{"name":"idx_coupon_redeemed_at","fields":["coupon_id","redeemed_at"],"description":"Enables history lookup/reporting by coupon, fast search over redemption logs.","fieldNames":["coupon_id","redeemed_at"]}],"ginIndexes":[]},{"name":"ai_mall_loyalty_point","description":"[Loyalty Point Record] - Implements the business requirements for recording atomic customer point balances (not precomputed, only current state). 3NF maintained, never stores summaries or historical aggregations here.\n\nBusiness: Each record holds fungible, up-to-date point totals for 1 customer in 1 context (global or per-seller), strictly atomic. All balance histories go to ai_mall_loyalty_transaction.\nKey relationships: Linked to customer and, optionally, a seller (for per-seller programs).\nSpecial behaviors: Unique per (customer,seller); never deleted, always adjusted additively with point transactions, not summaries.\n\nExample: Query current point balance for a customer, or in seller's loyalty program.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Identifies individual loyalty point instance, unique per customer/seller.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"customer_id","type":"uuid","description":"[Loyalty Owner] - Who these points belong to. 1:1 with customer.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"seller_id","type":"uuid","description":"[Seller Loyalty Context] - Null means global (platform) program, or set for per-seller point pools.","relation":{"name":"seller","targetModel":"ai_mall_seller"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"current_balance","type":"double","description":"[Point Balance] - The actual currently available points for this entity. 3NF enforced: no summary of redemptions, only precise atomic number.","nullable":false},{"name":"last_updated_at","type":"datetime","description":"[Last Update] - When points were last changed (earn/spend/expire/etc.).","nullable":false}],"uniqueIndexes":[{"name":"unique_customer_seller_loyalty","fields":["customer_id","seller_id"],"description":"Only one balance allowed per (customer,seller).","fieldNames":["customer_id","seller_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_loyalty_transaction","description":"[Loyalty Transactions] - Implements audit trail of all atomic earn/spend/expire events in the loyalty system. Required for point/balance histories in compliance, undo, or reporting scenarios. 3NF enforced: no aggregate or computed fields.\n\nBusiness: Each transaction records a precise delta to a customer's point balance, why, and who/what originated it. Never stores running totals; all computation happens in view layer/app.\n\nExample: Customer earns 100 points on an order, spends 50 on a coupon. Entry here, but actual balance only in ai_mall_loyalty_point.\nKey relationships: Linked to customer, loyalty point record, admin, seller, optional order/payment/refund.\nSpecial behaviors: Immutable for audit/compliance.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique transaction event for traceability, rollback.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"loyalty_point_id","type":"uuid","description":"[Affected Point Record] - Links to the ai_mall_loyalty_point record this changes.","relation":{"name":"loyaltyPoint","targetModel":"ai_mall_loyalty_point"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"customer_id","type":"uuid","description":"[Source Customer] - Who owns/earned/spent points.","relation":{"name":"customer","targetModel":"ai_mall_customer"},"relationType":"many-to-one","nullable":false,"unique":false},{"name":"seller_id","type":"uuid","description":"[Program Context Seller] - The seller context for this transaction. Null for global.","relation":{"name":"seller","targetModel":"ai_mall_seller"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"order_id","type":"uuid","description":"[Related Order] - If points are earned/spent via an order, reference it.","relation":{"name":"order","targetModel":"ai_mall_order"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"payment_id","type":"uuid","description":"[Related Payment] - If tied to a payment/refund.","relation":{"name":"payment","targetModel":"ai_mall_payment"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"refund_id","type":"uuid","description":"[Refund Relation] - Refund context, if applicable.","relation":{"name":"refund","targetModel":"ai_mall_refund"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"admin_id","type":"uuid","description":"[Operator/Admin] - Who created/approved/rolled back this event, if any.","relation":{"name":"admin","targetModel":"ai_mall_admin"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"delta","type":"double","description":"[Point Delta] - Signed number; positive for earn, negative for spend, zero for no-change event (i.e. expiry). 3NF, atomic event only.","nullable":false},{"name":"type","type":"string","description":"[Event Type] - E.g. 'earn', 'spend', 'expire', 'rollback', 'adjust'. Atomic enumerated value.","nullable":false},{"name":"reason","type":"string","description":"[Reason/Audit] - Compliance, business context or human-entered annotation.","nullable":false},{"name":"event_at","type":"datetime","description":"[Event Timestamp] - When this event was executed.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"name":"idx_loyalty_customer_date","fields":["customer_id","event_at"],"description":"For reporting customer transaction histories fast.","fieldNames":["customer_id","event_at"]}],"ginIndexes":[]},{"name":"ai_mall_campaign","description":"[Promotion/Loyalty Campaign] - Implements multi-promotion marketing event package as per Promotions System requirements. Fully normalized: no stats, no aggregates, only atomic campaign definitions and configuration.\n\nBusiness: Campaigns represent groupings and scheduling of multiple atomic promotions/coupons, with metadata and targeting logic. Used by admins/sellers to orchestrate holiday events, flash sales, or cross-promotion.\n\nFor example, a Black Friday mega event including several promotions and targeted coupon releases.\nKey relationships: Many-to-many with promotions, coupons (via campaign linkage, not duplication).\nSpecial behaviors: Never deleted, only deactivated/superseded. Links to campaigns are via atomic IDs.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique campaign identity for atomic event packaging. No denormalization.","isId":true,"isGenerated":true,"dbType":"Uuid"},"foreignFields":[{"name":"owner_admin_id","type":"uuid","description":"[Admin Creator] - Admin who orchestrated the campaign. For audit/security.","relation":{"name":"ownerAdmin","targetModel":"ai_mall_admin"},"relationType":"many-to-one","nullable":true,"unique":false},{"name":"seller_id","type":"uuid","description":"[Owning Seller] - For seller-custom campaigns. Null for omni/global.","relation":{"name":"seller","targetModel":"ai_mall_seller"},"relationType":"many-to-one","nullable":true,"unique":false}],"plainFields":[{"name":"name","type":"string","description":"[Campaign Name] - Human readable, for display (no summaries or aggregates).","nullable":false},{"name":"description","type":"string","description":"[Description] - Marketing, eligibility, intent. Atomic string, no computed stats.","nullable":false},{"name":"rule_json","type":"string","description":"[Targeting & Content Rules] - Atomic JSON config, no calculated values. E.g. A/B test config, segmentation.","nullable":false},{"name":"is_active","type":"boolean","description":"[Active Flag] - Live campaign or ended.","nullable":false},{"name":"start_at","type":"datetime","description":"[Start Timestamp] - Activation date (atomic, not calculated).","nullable":false},{"name":"end_at","type":"datetime","description":"[End Timestamp] - End date (atomic, not calculated).","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - When was the campaign created?","nullable":false},{"name":"updated_at","type":"datetime","description":"[Updated At] - When was the campaign last modified?","nullable":false}],"uniqueIndexes":[{"name":"unique_campaign_name_seller","fields":["name","seller_id"],"description":"No duplicate campaign names within a seller or globally.","fieldNames":["name","seller_id"],"unique":true}],"plainIndexes":[{"name":"idx_campaign_active_time","fields":["is_active","start_at","end_at"],"description":"Support listing/search of active campaigns in UI flows.","fieldNames":["is_active","start_at","end_at"]}],"ginIndexes":[{"name":"gin_campaign_name_desc","fields":["name","description"],"description":"Full-text search for campaign discovery in backoffice.","fieldName":"name"}]}]},{"filename":"schema-05-inquiries-reviews.prisma","namespace":"InquiriesReviews","models":[{"name":"ai_mall_product_inquiry","description":"[Product Inquiry] - This implements the requirement for recording customer-initiated product inquiries as detailed in the AI Mall Inquiry & Review System specification and Section 1 of the Inquiry & Review document.\n\nCustomers can submit questions (public or private) tied to a specific product and optionally a product snapshot, with a full audit trail and support for threaded replies. Maintains strict 3NF normalization by splitting replies and audit info into separate tables, and referencing customers/products via foreign keys. Example: a customer asks about shipping options for product X – this record logs the initial query and visibility.\n\nKey relationships: links to ai_mall_customer, ai_mall_product, ai_mall_product_snapshot (optional), and founder reply thread. Special behaviors: supports public/private visibility, soft deletion, and AI-driven moderation flags.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Implements record uniqueness. The unique identifier for each product inquiry. Ensures normalization (1NF) by giving every inquiry a distinct identity. Used for all foreign keys referencing inquiries.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"customer_id","type":"uuid","relation":{"name":"customer","targetModel":"ai_mall_customer"},"description":"[Inquiry Customer Reference] - Implements assignment of inquiry to a customer, per customer Q&A requirement in the Inquiry & Review System.\n\nLinks this inquiry to the customer who asked it. Ensures 3NF by referencing the customer table and not storing redundant user data here. Example: Used to fetch all inquiries by a specific customer.\n","nullable":false,"unique":false},{"name":"product_id","type":"uuid","relation":{"name":"product","targetModel":"ai_mall_product"},"description":"[Inquiry Product Reference] - Implements traceability per product, as required for inquiry analytics and context in the Inquiry System document.\n\nLinks this inquiry to a specific product. 3NF: product info is not duplicated here—always referenced.\nExample: Fetching all inquiries for product X.\n","nullable":false,"unique":false},{"name":"snapshot_id","type":"uuid","relation":{"name":"snapshot","targetModel":"ai_mall_product_snapshot"},"description":"[Product Snapshot Reference] - Implements traceability for inquiry context at product state time (optional), per snapshot feature in the Inquiry & Review System doc.\n\nAllows linking an inquiry to a product snapshot (auditing catalog state at question time). Enforces 3NF; nullable since not all inquiries require this.\nExample: Seller references the exact SKU state at time of question.\n","nullable":true,"unique":false}],"plainFields":[{"name":"title","type":"string","description":"[Inquiry Title] - Implements requirement for inquiry summarization. Atomic summary. Allows users and staff to quickly review or search. Maintains 1NF by being atomic.\nExample: 'Is this product available in blue?'","nullable":false},{"name":"body","type":"string","description":"[Inquiry Body] - Implements customer message input as detailed in Inquiry requirements. Holds the full message. 1NF: Each message is atomic.\nExample: 'Can you ship this item to Korea?'","nullable":false},{"name":"is_public","type":"boolean","description":"[Public/Private Toggle] - Implements user-facing privacy control for inquiries as per Inquiry System spec.\nEnsures visibility status is atomic and not redundant.\nExample: is_public = false means only the customer and seller/admin can view.","nullable":false},{"name":"status","type":"string","description":"[Inquiry Status] - Implements workflow tracking: visible, hidden, pending moderation, removed. Ensures 3NF – status is a core attribute, not derived, and is not duplicated elsewhere.\nExample: status = 'pending_moderation'.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Implements audit requirement to timestamp inquiry creation for traceability. Ensures 1NF; atomic datetime. Used in all audit/reporting queries.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Updated At] - Tracks last modification as required for inquiry audits and edit flows. Maintains normalization – not duplicated elsewhere.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Deleted At] - Implements soft-delete for retention & audit needs, ensuring normalization (not a flag). Nullable: absent for active inquiries. On deletion, timestamp is set.","nullable":true},{"name":"ai_moderation_flag","type":"boolean","description":"[AI Moderation Flag] - Implements requirement for automated content flagging. Used for scalable moderation insights; 1NF.","nullable":false}],"uniqueIndexes":[{"fieldNames":["customer_id","product_id","created_at"],"unique":true,"description":"Enforces at-most-one inquiry per customer/product at a given timestamp; prevents accidental duplicates."}],"plainIndexes":[{"fieldNames":["product_id","created_at"],"description":"Improves performance on product inquiry search/recency queries."}],"ginIndexes":[{"fieldName":"title","description":"Enables full-text search on inquiry content for staff/admins."},{"fieldName":"body","description":"Enables full-text search on inquiry content for staff/admins."}]},{"name":"ai_mall_product_inquiry_reply","description":"[Inquiry Reply] - This model implements the threaded discussion requirement for product inquiries in Section 3 of the Inquiry & Review System spec.\n\nEach reply inquires are linked as child messages to parent inquiries, and may reference the acting seller, administrator, or customer. Replies support audit trail, permissions, and moderation. Fully normalized – no redundant actor/user/profile data in reply; actor type is stored for reference and auditing. Example use: Seller responds to a customer's question about product fit.\n\nKey relationships: parent inquiry (ai_mall_product_inquiry), actor ref (to customer, seller, or admin). Special: AI flag for auto-moderation, visibility status.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique reply identifier. Ensures 1NF and direct reference from audit trails/threads.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"inquiry_id","type":"uuid","relation":{"name":"inquiry","targetModel":"ai_mall_product_inquiry"},"description":"[Parent Inquiry Reference] - Implements linkage of reply to top-level inquiry, for strict 3NF and logical threading.\n\nAllows easy fetching of all replies per inquiry, with no data duplication.","nullable":false,"unique":false},{"name":"actor_customer_id","type":"uuid","relation":{"name":"actorCustomer","targetModel":"ai_mall_customer"},"description":"[Customer Actor Reference] - Used only if a customer replies. Implements audit traceability; maintains normalization. Nullable, only set if the reply is from a customer.","nullable":true,"unique":false},{"name":"actor_seller_id","type":"uuid","relation":{"name":"actorSeller","targetModel":"ai_mall_seller"},"description":"[Seller Actor Reference] - Set if a seller replies. Maintains normalized design & audit traceability. Nullable, only set if reply is from a seller.","nullable":true,"unique":false},{"name":"actor_admin_id","type":"uuid","relation":{"name":"actorAdmin","targetModel":"ai_mall_admin"},"description":"[Admin Actor Reference] - Used for admin replies. Maintains RBAC and audit requirements; normalization preserved. Nullable.","nullable":true,"unique":false}],"plainFields":[{"name":"body","type":"string","description":"[Reply Body] - Implements content of the reply. Atomic value; 1NF. Example: 'Yes, we ship to Korea.'","nullable":false},{"name":"status","type":"string","description":"[Reply Status] - Workflow state (visible, hidden, pending moderation, removed). 3NF compliance; status is not derived or duplicated. Enables quick view filtering. Example: 'visible'.","nullable":false},{"name":"ai_moderation_flag","type":"boolean","description":"[AI Moderation Flag] - Implements AI moderation features as required. Atomic flag; 1NF. Used for workflow escalation.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Timestamp of reply, for audit/logging compliance. 1NF: atomic, not derived.","nullable":false},{"name":"updated_at","type":"datetime","description":"[Updated At] - Last edit timestamp, for audit requirements.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Deleted At] - Soft-delete timestamp for reliable moderation/auditing. Nullable for active records.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["inquiry_id","created_at"],"description":"Speeds threaded reply fetch (per inquiry, by created_at) for UI and moderation."}],"ginIndexes":[{"fieldName":"body","description":"For full-text search in replies when staff are reviewing content."}]},{"name":"ai_mall_product_review","description":"[Product Review] - Implements requirement for customer-initiated product reviews, as outlined in Section 2 of the Inquiry & Review System and verified purchase flows.\n\nReview is atomic, linked by FK to customer and product, and may reference a specific order item for verification compliance. 3NF compliance by splitting attachments and comments to other tables; no redundant product/info here. Example: Customer reviews delivered product Y with star rating and photos.\n\nKey relationships: ai_mall_customer, ai_mall_product, ai_mall_order_item (for verified status). Special: review status, moderation, soft delete, AI flag.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique review identifier. Ensures 1NF, strictly atomic.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"customer_id","type":"uuid","relation":{"name":"customer","targetModel":"ai_mall_customer"},"description":"[Customer Reference] - Links review to reviewing customer. Maintains 3NF, traceable by user. Not nullable – all reviews must have an author.","nullable":false,"unique":false},{"name":"product_id","type":"uuid","relation":{"name":"product","targetModel":"ai_mall_product"},"description":"[Product Reference] - Links review to reviewed product, no redundancy. Maintains normalized join for reporting/search by product.","nullable":false,"unique":false},{"name":"order_item_id","type":"uuid","relation":{"name":"orderItem","targetModel":"ai_mall_order_item"},"description":"[Order Item Reference] - For enforcing verified-purchase review rules. Nullable if allowed by policy. 3NF compliance: order item details are referenced, not duplicated.","nullable":true,"unique":false}],"plainFields":[{"name":"rating","type":"int","description":"[Star Rating] - Implements product rating (required as integer, 1-5). Atomic and per event. Maintains 1NF; no summary field here, only single event. Example: rating=5.","nullable":false},{"name":"title","type":"string","description":"[Review Title] - Short summary/title, atomic. 1NF. Example: 'Fantastic headphones!'","nullable":false},{"name":"body","type":"string","description":"[Review Body] - Full review content. Atomic; no arrays or nested values. 1NF compliance. Example: 'The sound quality is perfect for my studio work.'","nullable":false},{"name":"status","type":"string","description":"[Review Status] - Current moderation/publication status of review (visible, hidden, pending_moderation, removed). 3NF: not calculated elsewhere.","nullable":false},{"name":"ai_moderation_flag","type":"boolean","description":"[AI Moderation Flag] - Used to flag the review for auto-moderation queue. Ensures normalization by keeping this atomic and not spreading moderation reason redundantly.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Timestamp for review creation (audit/canonical event).","nullable":false},{"name":"updated_at","type":"datetime","description":"[Updated At] - Last edit timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Deleted At] - Soft-delete implementation for record retention. Nullable.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","product_id","order_item_id"],"unique":true,"description":"Prevents duplicate reviews by the same customer for the same product/order item."}],"plainIndexes":[{"fieldNames":["product_id","created_at"],"description":"Speeds product review timeline queries."}],"ginIndexes":[{"fieldName":"title","description":"Facilitates review search by title/content in moderation dashboards."},{"fieldName":"body","description":"Facilitates review search by title/content in moderation dashboards."}]},{"name":"ai_mall_review_comment","description":"[Review Comment] - Implements threaded comments on reviews (Section 3, Inquiry & Review System). Supports both staff and user comments, with actor type FKs and full normalization.\n\nRole-based access—admin, seller, or customer. Fully normalized; all actor/user info is referenced, not duplicated. Example: Seller explains resolution to a negative review in comment thread.\n\nKey relationships: ai_mall_product_review (review parent), plus possible actor FK. Special: status, AI flag, deleted_at.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Distinct identifier for each comment, ensures atomicity & normalization.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"review_id","type":"uuid","relation":{"name":"review","targetModel":"ai_mall_product_review"},"description":"[Parent Review Reference] - Links comment to the specific review, normalized per 3NF.","nullable":false,"unique":false},{"name":"actor_customer_id","type":"uuid","relation":{"name":"actorCustomer","targetModel":"ai_mall_customer"},"description":"[Customer Actor Reference] - Comment author link, if a customer. Nullable as staff/admin may comment. Maintains normalization, gatekeeps by actor type.","nullable":true,"unique":false},{"name":"actor_seller_id","type":"uuid","relation":{"name":"actorSeller","targetModel":"ai_mall_seller"},"description":"[Seller Actor Reference] - Comment author link, if a seller.","nullable":true,"unique":false},{"name":"actor_admin_id","type":"uuid","relation":{"name":"actorAdmin","targetModel":"ai_mall_admin"},"description":"[Admin Actor Reference] - Comment writer, system or moderation response; ensures full auditability. Nullable.","nullable":true,"unique":false}],"plainFields":[{"name":"body","type":"string","description":"[Comment Body] - Main comment content; fully atomic, 1NF. Example: 'Thank you for your feedback, a replacement has shipped.'","nullable":false},{"name":"status","type":"string","description":"[Comment Status] - Status (pending, visible, hidden, removed). 3NF; not derived—core state only.","nullable":false},{"name":"ai_moderation_flag","type":"boolean","description":"[AI Moderation Flag] - For auto-moderation comments just as for reviews/replies.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Timestamp (full audit log for all threads).","nullable":false},{"name":"updated_at","type":"datetime","description":"[Updated At] - Last edit event.","nullable":false},{"name":"deleted_at","type":"datetime","description":"[Deleted At] - Soft-delete for audit and compliance. Nullable for active comments.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["review_id","created_at"],"description":"Fetches comment thread for a review efficiently."}],"ginIndexes":[{"fieldName":"body","description":"Full-text comment lookup for moderation and analytics."}]},{"name":"ai_mall_review_attachment","description":"[Review Attachment] - Implements review attachment requirement from Inquiry & Review spec. All attachments (image/video/docs) are uploaded via attachment module and linked via FK. Normalized – no blob data, only FK, type, role, and context maintained here.\n\nPrevents duplicate references, supports moderation and access control. Example: Review photo attached by customer.\nKey relationships: ai_mall_product_review (review), ai_mall_attachment (actual file asset), and uploader (customer/seller/admin, optional, for audit).","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique id for each attachment, ensures direct FK referencing, 1NF.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"review_id","type":"uuid","relation":{"name":"review","targetModel":"ai_mall_product_review"},"description":"[Review Reference] - Connects file to review. Ensures normalized storage and lookup.\nAll review/media linkage reports reference this FK.","nullable":false,"unique":false},{"name":"attachment_id","type":"uuid","relation":{"name":"attachment","targetModel":"ai_mall_attachment"},"description":"[Attachment Reference] - Connects to centralized attachment/file module, per Attachments & Media spec. Normalized; no redundant URLs, etc. here. All moderation and access control is via this reference.","nullable":false,"unique":false},{"name":"uploader_customer_id","type":"uuid","relation":{"name":"uploaderCustomer","targetModel":"ai_mall_customer"},"description":"[Uploader Customer Reference] - If uploaded by customer; author attribution per compliance/audit. Nullable (seller/admin uploads possible).","nullable":true,"unique":false},{"name":"uploader_seller_id","type":"uuid","relation":{"name":"uploaderSeller","targetModel":"ai_mall_seller"},"description":"[Uploader Seller Reference] - For seller-uploaded attachments (e.g. resolution images). 3NF normalized.","nullable":true,"unique":false},{"name":"uploader_admin_id","type":"uuid","relation":{"name":"uploaderAdmin","targetModel":"ai_mall_admin"},"description":"[Uploader Admin Reference] - For admin-added/moderated assets (e.g. DMCA compliance).","nullable":true,"unique":false}],"plainFields":[{"name":"role","type":"string","description":"[Uploader Role] - string value for role at upload time: 'customer', 'seller', 'admin'. Not duplicated elsewhere. 1NF compliance.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Upload timestamp for audit/ref logs.","nullable":false}],"uniqueIndexes":[{"fieldNames":["review_id","attachment_id"],"unique":true,"description":"Prevents duplicate attachment per review/file, for data integrity."}],"plainIndexes":[{"fieldNames":["uploader_customer_id","created_at"],"description":"Audit/report of customer-uploaded files by recency."}],"ginIndexes":[]},{"name":"ai_mall_inquiry_audit","description":"[Inquiry Audit Log] - Implements full audit logging per Inquiry System and Compliance requirements (audit trail for all inquiry/reply/review changes).\n\nEvery material change (created, updated, deleted, moderated, AI intervention) is logged here with before/after states, actor, and reason. Fully 3NF, atomic records per event. Example: Restore prior state for an inquiry due to wrongful deletion.\nKey relationships: may reference inquiry/reply/review, FK to actor (user, seller, admin).","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary Key] - Unique per audit event; audited events are traceable by id. 1NF/3NF compliance.","id":true,"dbType":"Uuid"},"foreignFields":[{"name":"inquiry_id","type":"uuid","relation":{"name":"inquiry","targetModel":"ai_mall_product_inquiry"},"description":"[Inquiry Reference] - Audit event linked to inquiry event. Nullable for audit on reply/review unrelated to direct inquiry. 3NF adherence.","nullable":true,"unique":false},{"name":"reply_id","type":"uuid","relation":{"name":"reply","targetModel":"ai_mall_product_inquiry_reply"},"description":"[Reply Reference] - Audit on reply event. Nullable; supports flexible audit scenarios. 3NF, no redundancy.","nullable":true,"unique":false},{"name":"review_id","type":"uuid","relation":{"name":"review","targetModel":"ai_mall_product_review"},"description":"[Review Reference] - Audit event for reviews. Nullable; normalized traceability.","nullable":true,"unique":false},{"name":"actor_customer_id","type":"uuid","relation":{"name":"actorCustomer","targetModel":"ai_mall_customer"},"description":"[Actor Customer Reference] - Set if customer caused the event (edit, delete, etc). Nullable. Maintains audit compliance.","nullable":true,"unique":false},{"name":"actor_seller_id","type":"uuid","relation":{"name":"actorSeller","targetModel":"ai_mall_seller"},"description":"[Actor Seller Reference] - Set if event triggered by seller. Maintains audit integrity. Nullable.","nullable":true,"unique":false},{"name":"actor_admin_id","type":"uuid","relation":{"name":"actorAdmin","targetModel":"ai_mall_admin"},"description":"[Actor Admin Reference] - Set if admin made the change; compliance and rollback requirement. Nullable.","nullable":true,"unique":false}],"plainFields":[{"name":"event_type","type":"string","description":"[Event Type] - Canonical audit type: 'create', 'update', 'delete', 'moderate', 'ai_action'. String per audit policy; not duplicated elsewhere.","nullable":false},{"name":"before_json","type":"string","description":"[Before State JSON] - Pre-event state (snapshot of before). Atomic and stored as stringified JSON. Example use: rollback/restore prior state. Maintains 1NF by not storing nested structures.","nullable":false},{"name":"after_json","type":"string","description":"[After State JSON] - Post-event state. Atomic, JSON string. Audit/rollback assurance.","nullable":false},{"name":"reason","type":"string","description":"[Reason] - Human/audit reason. Example: 'Inappropriate content flagged by AI', fully atomic. 1NF compliance.","nullable":false},{"name":"created_at","type":"datetime","description":"[Created At] - Audit event timestamp. Canonical event identifier, maintains normalization.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["inquiry_id","created_at"],"description":"Audit review by inquiry and event time."}],"ginIndexes":[]}]},{"filename":"schema-06-attachments-media.prisma","namespace":"AttachmentsMedia","models":[{"name":"ai_mall_attachment","description":"[Attachment registry] - Implements file upload management per 10_ai-mall_attachments-and-media.md.\n\nTracks every user-uploaded file with strict normalization and auditability. Uploader always references ai_mall_user_profile for reliable ownership and permission. Business context/type allows polymorphic reference (e.g., product, review). NEVER stores calculated or summary info here. Used in product images, reviews, or user avatars; maintains full 3NF and integrity for audit logs, erasure, and contextual fetches.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Primary key; unique UUID for this attachment."},"foreignFields":[{"name":"uploader_id","type":"uuid","target":"ai_mall_user_profile","nullable":false,"unique":false,"relation":{"fields":["uploader_id"],"references":["id"],"model":"ai_mall_user_profile","name":"fkAttachmentUploaderId","targetModel":"ai_mall_user_profile","onDelete":"Restrict"},"description":"FK to profile of uploading user (customer/seller/admin); enforces atomic user reference for all attachments."}],"plainFields":[{"name":"business_context_type","type":"string","nullable":false,"description":"Business context for attachment (e.g., product, review, inquiry, profile, etc.)."},{"name":"business_context_id","type":"uuid","nullable":true,"description":"Polymorphic context FK (refers to product_id, review_id, etc.); nullable if unattached."},{"name":"media_type","type":"string","nullable":false,"description":"MIME type of file (e.g., image/png, application/pdf)."},{"name":"file_extension","type":"string","nullable":false,"description":"File extension (e.g., png, jpg, pdf)."},{"name":"is_public","type":"boolean","nullable":false,"description":"ACL: true=public (CDN addressable), false=private (restricted download)."},{"name":"created_at","type":"datetime","nullable":false,"description":"Upload timestamp (auditing, compliance)."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-deletion timestamp for GDPR/erasure flows; null if active."}],"uniqueIndexes":[{"name":"uidx_attachment_file_context","fieldNames":["business_context_type","business_context_id","media_type","file_extension"],"unique":true,"description":"Unique constraint: only one file of type/context/extension per logical attachment."}],"plainIndexes":[{"name":"idx_attachment_uploader","fieldNames":["uploader_id"],"description":"Optimize lookup/files by uploader."},{"name":"idx_attachment_context","fieldNames":["business_context_type","business_context_id"],"description":"Optimize lookup by context type/id."},{"name":"idx_attachment_created_at","fieldNames":["created_at"],"description":"Optimize queries by upload date."}],"ginIndexes":[{"fieldName":"media_type","description":"GIN index for type search/fuzzy search (advanced admin tools)."}]},{"name":"ai_mall_media_version","description":"[Attachment Version History] - Tracks immutable file versions for every attachment for full audit/history (see 10_ai-mall_attachments-and-media.md). Enforces strict 3NF by using atomic versioned records; never stores redundant info. Every update to a file creates a new ai_mall_media_version row, linked to ai_mall_attachment, with all storage/actor info. Used for moderation, rollbacks, accident restores, and compliance history. Business logic requires always linking these to both parent attachment and the actual uploader.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Primary key; unique UUID for media version row."},"foreignFields":[{"name":"attachment_id","type":"uuid","target":"ai_mall_attachment","nullable":false,"unique":false,"relation":{"fields":["attachment_id"],"references":["id"],"model":"ai_mall_attachment","name":"fkMediaVersionAttachmentId","targetModel":"ai_mall_attachment","onDelete":"Cascade"},"description":"FK to parent ai_mall_attachment."},{"name":"uploader_id","type":"uuid","target":"ai_mall_user_profile","nullable":false,"unique":false,"relation":{"fields":["uploader_id"],"references":["id"],"model":"ai_mall_user_profile","name":"fkMediaVersionUploaderId","targetModel":"ai_mall_user_profile","onDelete":"Restrict"},"description":"FK to actual user who uploaded this specific version (may differ from original uploader for moderation/transfers)."}],"plainFields":[{"name":"storage_url","type":"uri","nullable":false,"description":"CDN or storage URI for versioned file (e.g., https://cdn.domain/media/uuid.jpg)."},{"name":"version_number","type":"int","nullable":false,"description":"Monotonically increasing file version number for each attachment. Starts at 1 for first upload."},{"name":"created_at","type":"datetime","nullable":false,"description":"Upload/audit timestamp for this version."},{"name":"deleted_at","type":"datetime","nullable":true,"description":"Soft-deletion timestamp for old revisions or moderation takedowns."}],"uniqueIndexes":[{"name":"uidx_media_version","fieldNames":["attachment_id","version_number"],"unique":true,"description":"Unique version number per attachment; ensures strict monotonic version control."}],"plainIndexes":[{"name":"idx_media_version_attachment","fieldNames":["attachment_id"],"description":"Optimize all versions for an attachment."}],"ginIndexes":[]},{"name":"ai_mall_media_metadata","description":"[Media Metadata] - Atomic property-value pairs for file metadata (e.g., alt text, compliance, dimensions); strictly normalized (one key-value pair per row) as per 10_ai-mall_attachments-and-media.md. No summaries/calculated fields; never stores file content. Enables extensible tagging for accessibility/GDPR/auditing needs. Used for enforcing alt text, logging virus scans, storing transcript state, etc. Always references a media version row (not the attachment root).","material":false,"primaryField":{"name":"id","type":"uuid","description":"Primary key; unique UUID for this metadata entry."},"foreignFields":[{"name":"media_version_id","type":"uuid","target":"ai_mall_media_version","nullable":false,"unique":false,"relation":{"fields":["media_version_id"],"references":["id"],"model":"ai_mall_media_version","name":"fkMetadataMediaVersionId","targetModel":"ai_mall_media_version","onDelete":"Cascade"},"description":"FK to ai_mall_media_version; ensures atomicity for key/value pairs and context."}],"plainFields":[{"name":"meta_key","type":"string","nullable":false,"description":"Metadata property key (e.g., alt_text, virus_scan_passed, width)."},{"name":"meta_value","type":"string","nullable":true,"description":"Value for property key (e.g., accessibility label, scan status, etc.); nullable for some flag-only keys."}],"uniqueIndexes":[{"name":"uidx_media_metadata","fieldNames":["media_version_id","meta_key"],"unique":true,"description":"Unique metadata key per version; prevents duplicate keys."}],"plainIndexes":[{"name":"idx_metadata_version","fieldNames":["media_version_id"],"description":"Optimize lookups of all metadata attached to a file version."}],"ginIndexes":[{"fieldName":"meta_key","description":"GIN index for fuzzy/meta key search (e.g., compliance_flag, alt_text)."}]}]},{"filename":"schema-07-analytics-ai-automation.prisma","namespace":"AnalyticsAIAutomation","models":[{"name":"ai_mall_ai_recommendations","description":"[Model Purpose] - Implements detailed storage for AI-powered product/content recommendations per event/session as specified in '08_ai-mall_ai-features-and-analytics.md'.\n\nServes personalization, audit, and measurement, maintaining 3NF by referencing all context entities by ID with no aggregate/denormalized data. Supports analysis of recommendation effectiveness and model versioning.\n\nKey relationships: Links ai_mall_ai_recommendation_sessions (context), ai_mall_customer (user), ai_mall_product (subject), ai_mall_ai_model_versions (model lineage).\nSpecial behaviors: Enables A/B test evaluation, attribution analytics, and training feedback. No pre-aggregated fields.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Globally unique recommendation row. 3NF. Example: Used as recommendation_id. Always not null.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[{"name":"recommendation_session_id","type":"uuid","description":"Reference to recommendation session/event for analytics. Required. 3NF enforced.","targetModel":"ai_mall_ai_recommendation_sessions","relationName":"recommendation_session","unique":false,"nullable":false,"relation":{"name":"recommendationSession","targetModel":"ai_mall_ai_recommendation_sessions"}},{"name":"customer_id","type":"uuid","description":"Reference to recipient customer. Required for personalized analysis. 3NF enforced.","targetModel":"ai_mall_customer","relationName":"customer","unique":false,"nullable":false,"relation":{"name":"customer","targetModel":"ai_mall_customer"}},{"name":"product_id","type":"uuid","description":"Target product for recommendation. Required. Fully normalized - no denormalized product data.","targetModel":"ai_mall_product","relationName":"product","unique":false,"nullable":false,"relation":{"name":"product","targetModel":"ai_mall_product"}},{"name":"model_version_id","type":"uuid","description":"AI model version that generated recommendation. Required. Enables audit/tracing per 3NF.","targetModel":"ai_mall_ai_model_versions","relationName":"model_version","unique":false,"nullable":false,"relation":{"name":"modelVersion","targetModel":"ai_mall_ai_model_versions"}}],"plainFields":[{"name":"rank","type":"int","description":"The position of the recommendation in results (1-based). Enforces atomic value, no arrays. Example: rank 1=top recommendation.","nullable":false},{"name":"score","type":"double","description":"Model-generated confidence or relevance score. Fully atomic, required. Example: 0.8423.","nullable":false},{"name":"engaged","type":"boolean","description":"True if customer engaged (clicked/viewed/etc) with this recommendation. No pre-aggregation. 3NF. Not null.","nullable":false},{"name":"engaged_at","type":"datetime","description":"If engagement occurred, the timestamp. Null if no engagement. Atomic. May be null.","nullable":true},{"name":"created_at","type":"datetime","description":"When recommendation was generated/logged. Enables audit/trend analysis. Required.","nullable":false}],"uniqueIndexes":[{"name":"unique_session_product_rank","fieldNames":["recommendation_session_id","product_id","rank"],"unique":true,"description":"Guarantees each recommendation per session/product/rank is unique (no duplicates allowed)."}],"plainIndexes":[{"name":"idx_customer","fieldNames":["customer_id"],"description":"Frequently used for filtering by customer in analytics."},{"name":"idx_created_at","fieldNames":["created_at"],"description":"For time-based analysis/query patterns."}],"ginIndexes":[]},{"name":"ai_mall_ai_recommendation_sessions","description":"[Model Purpose] - Groups recommendation events into logical sessions for analytics/personalization context per '08_ai-mall_ai-features-and-analytics.md'.\n\nEach session encapsulates context like page type, channel, section to allow for segment analysis and experience tracking. 3NF by referencing related entities only by ID.\n\nKey relationships: Linked to multiple ai_mall_ai_recommendations. Section and channel references optional to support anonymous or non-targeted sessions. No aggregation or pre-computed stats stored.\nSpecial behaviors: Enables audit/log replay and context attribution.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Primary key for context/session. Globally unique. Used for analytics joins and session trace. Not null.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Optional reference to user (if known). Nullable for anonymous sessions. Maintains normalization.","targetModel":"ai_mall_customer","relationName":"customer","unique":false,"nullable":true,"relation":{"name":"customer","targetModel":"ai_mall_customer"}},{"name":"channel_id","type":"uuid","description":"Optional linkage to channel (web/mobile/etc). Nullable. Strictly as context.","targetModel":"ai_mall_channel","relationName":"channel","unique":false,"nullable":true,"relation":{"name":"channel","targetModel":"ai_mall_channel"}},{"name":"section_id","type":"uuid","description":"Optional linkage to section for UX targeting. Nullable (open context).","targetModel":"ai_mall_section","relationName":"section","unique":false,"nullable":true,"relation":{"name":"section","targetModel":"ai_mall_section"}}],"plainFields":[{"name":"page_type","type":"string","description":"Type of page/context triggering session (e.g. homepage, PDP, cart, etc). No arrays. Not null.","nullable":false},{"name":"trigger","type":"string","description":"Recommendation trigger type (user_action/system/etc). Categorical string. Not null.","nullable":false},{"name":"created_at","type":"datetime","description":"Session start/record creation. Audit key. Not null.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"name":"idx_channel","fieldNames":["channel_id"],"description":"Used for channel-based analytics reports."}],"ginIndexes":[]},{"name":"ai_mall_ai_model_versions","description":"[Model Purpose] - Tracks AI/ML recommendation model versions and lineage for audit, experiment, and reproducibility in '08_ai-mall_ai-features-and-analytics.md'.\n\nAll model provenance data: name, tag, release note, hash, effective window. Maintains separation from recommendations for 3NF. Enables reproducibility and explainability.\n\nKey relationships: Referenced by ai_mall_ai_recommendations and ai_mall_ai_audit_logs. No aggregate data or cross-model status here.\nSpecial behaviors: Unique index on (model_name, version_tag).","material":false,"primaryField":{"name":"id","type":"uuid","description":"Unique version PK. Used to join with recommendations and logs. Not null.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[],"plainFields":[{"name":"model_name","type":"string","description":"Canonical model name (e.g. homepage_rec_v2). Required. Ensures normalization.","nullable":false},{"name":"version_tag","type":"string","description":"Version label (e.g. 2024-01-prod, ab-group2). Required, used for unique index.","nullable":false},{"name":"release_notes","type":"string","description":"Human-readable notes. Required. Supports audit/review.","nullable":false},{"name":"training_hash","type":"string","description":"Training run hash/fingerprint. Required, for reproducibility.","nullable":false},{"name":"effective_from","type":"datetime","description":"Date/time version went live. Required. For audit/historical matching.","nullable":false},{"name":"effective_to","type":"datetime","description":"Date/time this version was retired. Null for still-active.","nullable":true}],"uniqueIndexes":[{"name":"unique_model_name_version","fieldNames":["model_name","version_tag"],"unique":true,"description":"Prevents duplicate model names/tags."}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_ai_audit_logs","description":"[Model Purpose] - Stores audit logs of AI system/model actions for explainability, compliance, and debugging. Implements audit logging per '08_ai-mall_ai-features-and-analytics.md'.\n\nStores events (trainings, inferences, anomalies, errors) and all model interaction details. Maintains 3NF by referencing model_version and customer when possible; no aggregation or summary data stored here.\n\nKey relationships: References ai_mall_customer and ai_mall_ai_model_versions for root cause attribution and compliance reporting.\nSpecial behaviors: Designed for deep search/query/debug by analysts.","material":false,"primaryField":{"name":"id","type":"uuid","description":"Unique audit log PK for each event/action. Not null, required.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Actor (if exists). Null if background job or system event. 3NF normalization.","targetModel":"ai_mall_customer","relationName":"customer","unique":false,"nullable":true,"relation":{"name":"customer","targetModel":"ai_mall_customer"}},{"name":"model_version_id","type":"uuid","description":"Model that triggered event/log (inference, training, etc). Always required. 3NF enforced.","targetModel":"ai_mall_ai_model_versions","relationName":"model_version","unique":false,"nullable":false,"relation":{"name":"modelVersion","targetModel":"ai_mall_ai_model_versions"}}],"plainFields":[{"name":"event_type","type":"string","description":"Event type/category (e.g. train, infer, error). Required for filtering. No arrays.","nullable":false},{"name":"event_detail","type":"string","description":"Free text/details/context/trace for this action/log. Required for search/debug.","nullable":false},{"name":"created_at","type":"datetime","description":"When event/log created. Not null. Used for reporting, auditing.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"name":"idx_event_type","fieldNames":["event_type"],"description":"Used for filtered event lookup (dashboards, compliance)."}],"ginIndexes":[{"name":"gin_idx_event_detail","fieldName":"event_detail","description":"For full-text search/debug in event_detail."}]},{"name":"ai_mall_mv_dashboard_metrics","description":"[Model Purpose] - Materialized view for denormalized dashboard metrics (counts, KPIs) per '08_ai-mall_ai-features-and-analytics.md'.\n\nHolds computed values for fast dashboard UI and reporting. All denormalized/aggregate data is strictly in this view (no business tables). Used for business, admin, seller dashboards and reporting only. Not editable by business ops (read-only).","material":true,"primaryField":{"name":"id","type":"uuid","description":"UUID PK for each dashboard metric for drilldown/trace. Required/unique.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[],"plainFields":[{"name":"metric_name","type":"string","description":"Metric identifier key (e.g. total_customers).","nullable":false},{"name":"value","type":"double","description":"Denormalized/calculated metric value. Always present for BI/reporting.","nullable":false},{"name":"calculation_time","type":"datetime","description":"Timestamp when metric calculated. Needed for data freshness. Required.","nullable":false}],"uniqueIndexes":[{"name":"unique_metric_name_time","fieldNames":["metric_name","calculation_time"],"unique":true,"description":"Metric/time uniqueness enforced; no multi-records for duplicate metric/time."}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_mv_traffic_metrics","description":"[Model Purpose] - Materialized view for denormalized, time-bucketed traffic stats needed for dashboards and ML as per '08_ai-mall_ai-features-and-analytics.md'.\n\nPre-computed unique visitors, page views, by time/channel for fast analytics. Not editable, only for reporting/BI and ML pipelines. All denormalized aggregate values restricted to this MV.\n\nKey: bucket, metric, channel uniquely identifies a row.","material":true,"primaryField":{"name":"id","type":"uuid","description":"Unique PK for each bucketed traffic record. Used for analytics joins/drilldown. Required.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[],"plainFields":[{"name":"bucket_start_at","type":"datetime","description":"Bucket open/start time (e.g. start of day/week/month). Required.","nullable":false},{"name":"bucket_end_at","type":"datetime","description":"Bucket close/end time. Required.","nullable":false},{"name":"channel","type":"string","description":"Channel code (e.g. web, mobile). Required for segmentation.","nullable":false},{"name":"metric_name","type":"string","description":"Metric identifier ('visits', 'page_views', etc). Required.","nullable":false},{"name":"metric_value","type":"double","description":"Precomputed value for metric in this bucket/channel. Always required.","nullable":false},{"name":"calculation_time","type":"datetime","description":"When value calculated. Required for freshness checks.","nullable":false}],"uniqueIndexes":[{"name":"unique_metric_channel_bucket","fieldNames":["metric_name","channel","bucket_start_at"],"unique":true,"description":"Guarantees uniqueness of metric/channel/bucket_start triple."}],"plainIndexes":[],"ginIndexes":[]},{"name":"ai_mall_mv_sales_trends","description":"[Model Purpose] - Materialized view of denormalized product/channel sales trends over time—per '08_ai-mall_ai-features-and-analytics.md'.\n\nComputed aggregates for ML, BI, dashboard visualizations. Read-only, never updated by end users. All denormalized/bucketed/summary fields contained only in view. For reporting, alerts, ML analysis.\n\nKey: product/channel/bucket unique.","material":true,"primaryField":{"name":"id","type":"uuid","description":"Unique PK for each trend bucket. Required, joins for drilldown.","optional":false,"unique":true,"id":true,"db":"Uuid"},"foreignFields":[],"plainFields":[{"name":"bucket_start_at","type":"datetime","description":"Bucket open/start time (e.g. start of day/week/month). Required.","nullable":false},{"name":"bucket_end_at","type":"datetime","description":"Bucket close time. Required.","nullable":false},{"name":"product_id","type":"uuid","description":"Reference to product. Not denormalized. Required. 3NF is enforced for product identity.","nullable":false},{"name":"channel","type":"string","description":"Channel code (e.g. web, mobile). Required for segmentation.","nullable":false},{"name":"total_sales","type":"double","description":"Aggregate sales amount for this bucket. ONLY in MV. Required.","nullable":false},{"name":"total_orders","type":"int","description":"Aggregate order count for this bucket. ONLY in MV. Required.","nullable":false},{"name":"calculation_time","type":"datetime","description":"When trend value was calculated. Required for staleness validation.","nullable":false}],"uniqueIndexes":[{"name":"unique_product_channel_bucket","fieldNames":["product_id","channel","bucket_start_at"],"unique":true,"description":"Uniqueness for product/channel/bucket triple to prevent duplicate trend rows."}],"plainIndexes":[],"ginIndexes":[]}]},{"filename":"schema-08-business-rules-compliance.prisma","namespace":"BusinessRulesCompliance","models":[{"name":"ai_mall_audit_log","description":"[Comprehensive action and event audit log] - This implements the system-wide auditing requirement from the business rules and compliance documentation (see audit log retention and role-based access control, section 6 in the requirements).\n\nTracks all critical resource actions (orders, payments, payouts, products, account changes) to ensure operational transparency, regulatory compliance, and accountability. Maintains 3NF by separating each event with atomic details and related identities, avoiding duplication (e.g., separate actor type/id, event type, and before/after states). For example, every admin, seller, or customer action that affects sensitive entities is written here, allowing for immutable traces and regulator/audit review.\n\nKey relationships: Links to actors (customer, seller, admin) and affected resources. \nSpecial behaviors: Append-only, never updates in-place; only authorized admins can review full details. Immutable after write.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Audit log primary key] - Uniquely identifies each log entry. Implements non-redundant event storage. Ensures normalization by storing a single UUID for every log row. This field is always auto-generated.","isId":true},"foreignFields":[{"name":"actor_customer_id","type":"uuid","relation":{"targetModel":"ai_mall_customer","name":"fkAiMallAuditLogActorCustomer"},"unique":false,"nullable":true,"description":"[Foreign key to customer actor] - References the customer who performed the action. Implements actor traceability and RBAC compliance (requirement 3). Nullable for cases where action is by seller/admin only. Example: A customer changing their profile triggers an entry with this populated. Maintains 3NF - only references customer, doesn't redundantly store names/emails. Nullable for non-customer actions."},{"name":"actor_seller_id","type":"uuid","relation":{"targetModel":"ai_mall_seller","name":"fkAiMallAuditLogActorSeller"},"unique":false,"nullable":true,"description":"[Foreign key to seller actor] - References the seller who performed the action. Implements actor traceability and RBAC compliance. Nullable except when a seller is the actor. Example: Seller updates product info. Maintains 3NF. Nullable for non-seller actions."},{"name":"actor_admin_id","type":"uuid","relation":{"targetModel":"ai_mall_admin","name":"fkAiMallAuditLogActorAdmin"},"unique":false,"nullable":true,"description":"[Foreign key to admin actor] - References the admin who performed the action. Implements admin-trackable events for escalations and exceptional actions. Maintains 3NF, never duplicating admin info."}],"plainFields":[{"name":"event_type","type":"string","description":"[Type of action/event logged] - Implements business rules for action tracing. Examples: 'order_update', 'product_delete', 'user_login', etc. Ensures normalization by not mixing event descriptions with types. Used for compliance reporting and auditing.","nullable":false},{"name":"event_target_type","type":"string","description":"[Affected resource type] - Implements the requirement to classify the resource affected by each action (e.g., 'order', 'product', 'account'). Ensures normalized handling of event context. Example: For a product price change, this would be 'product'.","nullable":false},{"name":"event_target_id","type":"uuid","description":"[ID of impacted entity] - Uniquely represents the affected resource (order, product, etc). Implements resource traceability per audit requirements. Maintains normalization by not duplicating target details.","nullable":false},{"name":"event_timestamp","type":"datetime","description":"[Timestamp of the event] - Implements audit log temporal requirements. Ensures each entry is timestamped precisely. Required for audit trail sequencing. Example: When an order status changes, records the instant of change.","nullable":false},{"name":"event_before_snapshot","type":"string","description":"[JSON of entity before change] - Captures the state of the target before action. Implements requirement for before/after audit trail. Ensures atomic detail. For example, contains JSON of order state before a cancel event. Not redundant since full copy is only in snapshots, not in every log.","nullable":false},{"name":"event_after_snapshot","type":"string","description":"[JSON of entity after change] - Captures the state of the target after action. Implements requirement for after-change visibility complying with rollback/audit. For example, the product's status after deactivation.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["event_timestamp","event_type"],"description":"[Composite index for event sequencing and search] - Implements quick audit search for admins/regulators."}],"ginIndexes":[{"fieldName":"event_before_snapshot","description":"[GIN index for full-text search on pre-event snapshot JSON]"},{"fieldName":"event_after_snapshot","description":"[GIN index for full-text search on post-event snapshot JSON]"}]},{"name":"ai_mall_policy","description":"[Formal system and compliance policy definitions] - Implements the policy management requirement from the compliance framework (requirement 7).\n\nDefines all operational, legal, privacy, and business workflow rules for the AI-Mall system. Maintains 3NF by uniquely identifying each policy and its current effective state (atomic, no redundant rules per row). Usage example: To store GDPR data retention policy, admin would insert/update here; referenced by other compliance modules (e.g., consent or exception workflow).\n\nKey relationships: May be referenced by compliance exceptions and audit logs. \nSpecial behaviors: Policies can be versioned via updates, never duplicated per effective period.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Policy primary key] - Uniquely identifies each policy (atomic, updatable). Maintains normalization by not merging policy states.","isId":true},"foreignFields":[],"plainFields":[{"name":"policy_code","type":"string","description":"[Unique policy code] - Implements atomic identification of each policy. Example: 'GDPR_DATA_RETENTION', 'SELLER_ONBOARD', 'PROMO_ISSUANCE'. Not repeated per file, avoids duplication.","nullable":false},{"name":"policy_title","type":"string","description":"[Policy title/summary] - User-readable short name for each policy. Ensures normalization by not duplicating policy details per usage.","nullable":false},{"name":"policy_content","type":"string","description":"[Full policy content, as markdown or text] - Implements business, legal, or system policy full-text. Maintains atomic definition - no derived content.","nullable":false},{"name":"effective_from","type":"datetime","description":"[Effective start date] - Implements requirement for versioning and rollback of policy applicability. Example: New GDPR rule takes effect July 2025, so set here.","nullable":false},{"name":"effective_to","type":"datetime","description":"[Effective end date] - Nullable. Null means 'current/indefinite'. Supports future policy transitions; implements versioning compliance without denormalization.","nullable":true}],"uniqueIndexes":[{"fieldNames":["policy_code"],"unique":true}],"plainIndexes":[{"fieldNames":["effective_from"],"description":"[Policy start date index] - Supports quick lookup of currently active policy by date."}],"ginIndexes":[{"fieldName":"policy_title","description":"[GIN index for policy title full-text search]"}]},{"name":"ai_mall_compliance_exception","description":"[Recorded exceptions to compliance or policy] - Implements compliance exception request and tracking from requirements section 7.\n\nTracks per-user, per-actor, or per-resource requests and decisions deviating from operational policy (e.g., right to be forgotten, dispute escalation, or data access outside usual policy). Maintains 3NF by uniquely linking exception to policy, actor, and affected target entity, with complete atomic tracking per exception.\n\nKey relationships: References policy, requestor (customer, seller, admin), and optionally targeted resource. \nSpecial behaviors: Exception status is tracked, and audit logs reference these for regulatory trails.\n","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Exception primary key] - Uniquely identifies each compliance exception. Maintains audit trail normalization.","isId":true},"foreignFields":[{"name":"policy_id","type":"uuid","relation":{"targetModel":"ai_mall_policy","name":"fkAiMallComplianceExceptionPolicy"},"unique":false,"nullable":false,"description":"[Foreign key to policy] - Links the exception to a specific compliance policy. Maintains referential integrity and normalized link to policy definitions."},{"name":"requested_by_customer_id","type":"uuid","relation":{"targetModel":"ai_mall_customer","name":"fkAiMallComplianceExceptionRequestedByCustomer"},"unique":false,"nullable":true,"description":"[FK: customer making exception request] - References the customer requesting a compliance exception (e.g., deletion, access). Nullable when requestor is a non-customer role. Maintains 3NF, avoids role duplication."},{"name":"requested_by_seller_id","type":"uuid","relation":{"targetModel":"ai_mall_seller","name":"fkAiMallComplianceExceptionRequestedBySeller"},"unique":false,"nullable":true,"description":"[FK: seller making the request] - References seller requestor in cases where seller initiates exception. Nullable; 3NF compliant."},{"name":"requested_by_admin_id","type":"uuid","relation":{"targetModel":"ai_mall_admin","name":"fkAiMallComplianceExceptionRequestedByAdmin"},"unique":false,"nullable":true,"description":"[FK: admin making the request] - References admin-initiated exceptions (rare, for regulatory triggers). Nullable for non-admins. Maintains audit compliance."}],"plainFields":[{"name":"target_type","type":"string","description":"[Resource/entity type affected] - Implements generalization of exception targets (e.g., 'order', 'customer', 'review').","nullable":false},{"name":"target_id","type":"uuid","description":"[ID of entity affected] - Implements atomic mapping of which entity is impacted (e.g., order or user id).","nullable":false},{"name":"exception_type","type":"string","description":"[Type/category of exception] - Specifies basis (e.g., 'data_erasure', 'policy_opt_out', 'dispute_escalation'). Not a derived value.","nullable":false},{"name":"reason","type":"string","description":"[Plain-text justification for exception] - Implements compliance documentation and traceability.","nullable":false},{"name":"status","type":"string","description":"[Current exception status] - E.g., 'pending', 'approved', 'denied', 'closed'. Ensures proper audit compliance.","nullable":false},{"name":"requested_at","type":"datetime","description":"[ISO 8601 request timestamp] - Atomic, not duplicated elsewhere.","nullable":false},{"name":"resolved_at","type":"datetime","description":"[Resolution timestamp, if processed] - Nullable. Maintains proper normalization (no partial date in status field).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["policy_id","status"],"description":"[Composite index for quick filtering by policy and status]."},{"fieldNames":["target_type","target_id"],"description":"[Composite index for target entity]."}],"ginIndexes":[{"fieldName":"reason","description":"[GIN on reason for textual search in exceptions]"}]},{"name":"ai_mall_notification","description":"[Business rule and compliance notifications] - Implements automated and manual notification requirement from compliance and audit sections (7.1, 7.2 in rules).\n\nCaptures all notification records – system, legal, or operational – about policies, compliance status, or exceptional events. Normalized (3NF) by keeping actor references and not duplicating notification text per recipient. Example: Notifies customer of policy update, seller of compliance event, admin of audit issue, etc.\n\nKey relationships: May reference customer, seller, or admin intended recipient, but each notification refers to a single recipient for atomicity. \nSpecial behaviors: Notification status (sent, read, archived) tracked distinctly from content.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Notification primary key] - Unique per notification. Normalized to avoid duplication.","isId":true},"foreignFields":[{"name":"to_customer_id","type":"uuid","relation":{"targetModel":"ai_mall_customer","name":"fkAiMallNotificationToCustomer"},"unique":false,"nullable":true,"description":"[Notification recipient: customer] - FK to customer table, notification sent to this customer. Nullable for non-customer recipients. Ensures proper role separation."},{"name":"to_seller_id","type":"uuid","relation":{"targetModel":"ai_mall_seller","name":"fkAiMallNotificationToSeller"},"unique":false,"nullable":true,"description":"[Notification recipient: seller] - Nullable, atomic to seller. 3NF-compliant."},{"name":"to_admin_id","type":"uuid","relation":{"targetModel":"ai_mall_admin","name":"fkAiMallNotificationToAdmin"},"unique":false,"nullable":true,"description":"[Notification recipient: admin] - For system/internal notifications. Nullable, never duplicated per admin role."}],"plainFields":[{"name":"notification_type","type":"string","description":"[Type/category of notification] - E.g., 'policy_update', 'compliance_action', 'exception_status'. Ensures proper categorization, not derived.","nullable":false},{"name":"content","type":"string","description":"[Notification message content] - Implements fully localized, arbitrary notification body (enforced at runtime). Normalized, only stores content, not behaviors.","nullable":false},{"name":"created_at","type":"datetime","description":"[Creation timestamp] - When the notification was created. Atomic and not duplicated.","nullable":false},{"name":"sent_at","type":"datetime","description":"[Timestamp notification was sent] - Nullable. Atomicity for compliance reporting. Normalized by separating from content.","nullable":true},{"name":"read_at","type":"datetime","description":"[Timestamp notification was read] - Nullable. Normalized tracking for unread states.","nullable":true},{"name":"archived_at","type":"datetime","description":"[Timestamp notification was archived] - Nullable. Maintains normalization (no status field with compound meaning).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["created_at","notification_type"],"description":"[Composite index for notification search]."}],"ginIndexes":[{"fieldName":"content","description":"[GIN Full-text search for notification body]."}]},{"name":"ai_mall_locale","description":"[Locales, languages, and regions supported] - Implements localization requirements from accessibility/localization documentation.\n\nDefines all configured locales, language tags, and region codes supported for notifications, policies, and UI. Maintains strict 3NF normalization: never duplicates messages or configs, just defines atomic locale. Example: 'en-US', 'ko-KR', etc. Used to lookup or validate supported languages for rendering.\n\nKey relationships: Referenced by notification modules and accessible profiles. \nSpecial behaviors: Disabling a locale marks it as unavailable for new sessions, not deletion.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Locale primary key] - Unique ID for each locale. Maintains normalization.","isId":true},"foreignFields":[],"plainFields":[{"name":"locale_code","type":"string","description":"[BCP 47 language/region code] - Implements localization per requirements. E.g., 'en-US', 'ko-KR'. Normalized, never duplicated.","nullable":false},{"name":"locale_title","type":"string","description":"[Human-readable locale name/title] - Example: 'English (US)', 'Korean (KR)'. Atomic, not redundant with locale_code.","nullable":false},{"name":"enabled","type":"boolean","description":"[Flag for active/disabled locale] - Implements requirement for configurable locale enable/disable. Not a derived status.","nullable":false}],"uniqueIndexes":[{"fieldNames":["locale_code"],"unique":true}],"plainIndexes":[],"ginIndexes":[{"fieldName":"locale_title","description":"[GIN index for locale name full-text search]."}]},{"name":"ai_mall_accessibility_profile","description":"[User accessibility and assistive feature preferences] - Implements personalized accessibility setting requirement (section 12: accessibility, 12.2).\n\nStores atomic, strictly normalized user-level accessibility flags for enforcing ADA/WCAG compliance (screen reader, high-contrast, etc). 3NF since never duplicates/summarizes preferences. Example: User with visual impairment saves profile with screen reader mode enabled. Multiple roles supported; user is one of customer, seller, or admin, but never more than one per row.\n\nKey relationships: Optionally references one of ai_mall_customer, ai_mall_seller, ai_mall_admin. \nSpecial behaviors: Only one role reference per row; unlinked if not used.","material":false,"primaryField":{"name":"id","type":"uuid","description":"[Primary key for accessibility profile] - Unique per profile. Normalized by separating each user preference row.","isId":true},"foreignFields":[{"name":"customer_id","type":"uuid","relation":{"targetModel":"ai_mall_customer","name":"fkAiMallAccessibilityProfileCustomer"},"unique":false,"nullable":true,"description":"[FK: customer] - Accessibility profile for a customer role. Nullable; only one of the three role refs filled per row. Normalized to not mix roles."},{"name":"seller_id","type":"uuid","relation":{"targetModel":"ai_mall_seller","name":"fkAiMallAccessibilityProfileSeller"},"unique":false,"nullable":true,"description":"[FK: seller] - Accessibility profile for a seller. Nullable, one-of-three only."},{"name":"admin_id","type":"uuid","relation":{"targetModel":"ai_mall_admin","name":"fkAiMallAccessibilityProfileAdmin"},"unique":false,"nullable":true,"description":"[FK: admin] - Accessibility profile for admin. Nullable, one-of-three only."},{"name":"locale_id","type":"uuid","relation":{"targetModel":"ai_mall_locale","name":"fkAiMallAccessibilityProfileLocale"},"unique":false,"nullable":true,"description":"[FK: preferred locale] - References ai_mall_locale, 3NF enforced."}],"plainFields":[{"name":"screen_reader","type":"boolean","description":"[Screen reader mode enabled] - Implements user assistive preference. Normalized, atomic flag.","nullable":false},{"name":"high_contrast_mode","type":"boolean","description":"[High contrast UI flag] - User setting for better visibility. Not derived or duplicated.","nullable":false},{"name":"captioning_enabled","type":"boolean","description":"[Caption/subtitle display flag] - For accessibility in media. Fulfills compliance, atomic.","nullable":false}],"uniqueIndexes":[{"fieldNames":["customer_id"],"unique":true,"description":"[At most one accessibility profile per customer]"},{"fieldNames":["seller_id"],"unique":true,"description":"[At most one accessibility profile per seller]"},{"fieldNames":["admin_id"],"unique":true,"description":"[At most one accessibility profile per admin]"}],"plainIndexes":[],"ginIndexes":[]}]}]}
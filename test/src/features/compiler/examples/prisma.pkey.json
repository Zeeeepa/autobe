{"files":[{"filename":"schema-01-systematic.prisma","namespace":"Systematic","models":[{"name":"shopping_mall_ai_channels","description":"Channel registry and lifecycle governance. Each record represents a distinct application/website context with its own configuration, currency/locale defaults, and policies. Sections and categories within a channel reference this table. Enforces unique business code and supports lifecycle states (Draft, Active, Suspended, Archived). Acts as a core reference for merchandising and analytics. Related entities: {@link shopping_mall_ai_sections}, {@link shopping_mall_ai_categories}, {@link shopping_mall_ai_channel_configurations}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique business code for the channel. Used across systems and external integrations.","nullable":false},{"name":"name","type":"string","description":"Human-readable channel name used in administration and analytics.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status of the channel. Allowed values by policy: Draft, Active, Suspended, Archived.","nullable":false},{"name":"base_locale","type":"string","description":"Default locale tag for the channel (e.g., en-US, ko-KR) used for content and formatting.","nullable":false},{"name":"default_currency","type":"string","description":"Default currency code (e.g., USD, KRW) for pricing display rules in this channel.","nullable":false},{"name":"policy_owner","type":"string","description":"Policy owner or administrative owner for governance and audit accountability.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the channel record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the channel record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp. When set, the record is logically deleted but retained for evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["status","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_sections","description":"Merchandising sections within a channel controlling visibility, scheduling, audience targeting, and ordering. Sections organize product placement and discovery surfaces. Enforces unique section code per channel and schedule-based visibility rules. Related to {@link shopping_mall_ai_channels}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Belonged channel's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Section code unique within the channel for deterministic references.","nullable":false},{"name":"display_name","type":"string","description":"Human-readable section title shown in tools and analytics.","nullable":false},{"name":"description","type":"string","description":"Optional description explaining the section’s purpose and content policy.","nullable":true},{"name":"status","type":"string","description":"Visibility status. Allowed values: Enabled, Disabled.","nullable":false},{"name":"schedule_start_at","type":"datetime","description":"Optional scheduled start time when the section becomes visible.","nullable":true},{"name":"schedule_end_at","type":"datetime","description":"Optional scheduled end time when the section becomes hidden.","nullable":true},{"name":"audience_rule","type":"string","description":"Optional audience targeting expression (business-level, policy evaluated by application).","nullable":true},{"name":"ordering_weight","type":"int","description":"Ordering weight for display prioritization (higher or policy-defined precedence).","nullable":false},{"name":"seller_scoped","type":"boolean","description":"Whether the section is restricted to specific sellers by policy.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the section record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the section record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status"]},{"fieldNames":["shopping_mall_ai_channel_id","ordering_weight","updated_at"]},{"fieldNames":["schedule_start_at","schedule_end_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_ai_categories","description":"Channel-specific hierarchical taxonomy categories used for navigation, discovery, and analytics. Supports single-parent trees and multi-category product assignment (via related components). Name is unique within a (channel, parent), and slug is unique within a channel. Depth is not stored here to maintain 3NF; compute depth in read paths or materialized views. Related to {@link shopping_mall_ai_channels} and self-referential parent category.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Belonged channel’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional parent category’s {@link shopping_mall_ai_categories.id} for hierarchy (null for root).","relation":{"name":"parent","targetModel":"shopping_mall_ai_categories","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"slug","type":"string","description":"URL-friendly unique slug within the channel for routing and analytics.","nullable":false},{"name":"name","type":"string","description":"Category display name. Unique within the same parent in the same channel.","nullable":false},{"name":"status","type":"string","description":"Publication status. Allowed values: Enabled, Disabled.","nullable":false},{"name":"ordering","type":"int","description":"Sibling ordering for display. Deterministic with parent grouping.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the category record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the category record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","slug"],"unique":true},{"fieldNames":["shopping_mall_ai_channel_id","parent_id","name"],"unique":true}],"plainIndexes":[{"fieldNames":["parent_id"]},{"fieldNames":["shopping_mall_ai_channel_id","parent_id","ordering"]},{"fieldNames":["shopping_mall_ai_channel_id","status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_category_mappings","description":"Cross-channel category mapping governance for analytics and unified campaigns. Records directional mappings from a source category to a target category with effective periods and optional priority/notes. Enables many-to-one and one-to-many with documented rules. Related to {@link shopping_mall_ai_categories} and {@link shopping_mall_ai_channels}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"source_channel_id","type":"uuid","description":"Source channel’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"sourceChannel","targetModel":"shopping_mall_ai_channels","targetField":"id","mappingName":"shopping_mall_ai_category_mappings_of_source_channel_id"},"unique":false,"nullable":false},{"name":"source_category_id","type":"uuid","description":"Source category’s {@link shopping_mall_ai_categories.id}.","relation":{"name":"sourceCategory","targetModel":"shopping_mall_ai_categories","targetField":"id","mappingName":"shopping_mall_ai_category_mappings_of_source_category_id"},"unique":false,"nullable":false},{"name":"target_channel_id","type":"uuid","description":"Target channel’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"targetChannel","targetModel":"shopping_mall_ai_channels","targetField":"id","mappingName":"shopping_mall_ai_category_mappings_of_target_channel_id"},"unique":false,"nullable":false},{"name":"target_category_id","type":"uuid","description":"Target category’s {@link shopping_mall_ai_categories.id}.","relation":{"name":"targetCategory","targetModel":"shopping_mall_ai_categories","targetField":"id","mappingName":"shopping_mall_ai_category_mappings_of_target_category_id"},"unique":false,"nullable":false}],"plainFields":[{"name":"effective_start_at","type":"datetime","description":"Mapping effective start time. Must be earlier than or equal to effective_end_at when end is defined.","nullable":false},{"name":"effective_end_at","type":"datetime","description":"Optional mapping end time. When null, mapping is considered open-ended.","nullable":true},{"name":"priority","type":"int","description":"Optional priority to resolve many-to-one mappings (higher number indicates higher priority).","nullable":false},{"name":"priority_note","type":"string","description":"Optional note to explain mapping priority and disambiguation rules.","nullable":true},{"name":"reason","type":"string","description":"Optional business reason for creating or changing the mapping (e.g., merge/split rationale).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the mapping record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the mapping record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["source_category_id","target_category_id","effective_start_at"],"unique":true}],"plainIndexes":[{"fieldNames":["source_channel_id","target_channel_id","created_at"]},{"fieldNames":["source_category_id","created_at"]},{"fieldNames":["target_category_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_channel_configurations","description":"Per-channel configuration (1:1) holding operational policies and defaults that are not part of the channel’s core identity. This table intentionally excludes base locale and default currency to avoid duplication with {@link shopping_mall_ai_channels}. Stores time zone, approval flags, session policies, and optional external settings reference. Managed via the channel’s administrative context.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Target channel’s {@link shopping_mall_ai_channels.id}. Enforced 1:1 via unique constraint.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":true,"nullable":false}],"plainFields":[{"name":"time_zone","type":"string","description":"IANA time zone identifier for business rules (e.g., Asia/Seoul).","nullable":false},{"name":"approvals_required_for_open","type":"boolean","description":"Whether catalog product opening requires prior approval in this channel.","nullable":false},{"name":"session_inactivity_timeout_minutes","type":"int","description":"Session inactivity timeout (minutes) enforced for this channel’s sessions.","nullable":false},{"name":"concurrent_session_limit","type":"int","description":"Maximum concurrent sessions allowed per member in this channel.","nullable":false},{"name":"settings_uri","type":"uri","description":"Optional external URI reference for extended channel settings managed elsewhere.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the configuration record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the configuration record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["time_zone","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_category_aliases","description":"Category alias governance supporting merges and renames within a channel. Associates legacy or alternative slugs/names to a target category with validity windows to preserve navigation continuity and analytics lineage. Related to {@link shopping_mall_ai_categories} and {@link shopping_mall_ai_channels}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_category_id","type":"uuid","description":"Target category’s {@link shopping_mall_ai_categories.id} that this alias points to.","relation":{"name":"category","targetModel":"shopping_mall_ai_categories","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"alias_slug","type":"string","description":"Alternate slug that should resolve to the target category within the channel.","nullable":false},{"name":"alias_name","type":"string","description":"Human-readable alias name for display and search assistance.","nullable":false},{"name":"valid_from_at","type":"datetime","description":"Timestamp from which the alias is effective.","nullable":false},{"name":"valid_to_at","type":"datetime","description":"Optional timestamp until which the alias remains effective.","nullable":true},{"name":"reason","type":"string","description":"Optional description of why the alias exists (e.g., merge, rebrand, typo correction).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the alias record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the alias record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","alias_slug"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_category_id","valid_from_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[{"fieldName":"alias_name"}]}]},{"filename":"schema-02-actors.prisma","namespace":"Actors","models":[{"name":"shopping_mall_ai_customers","description":"Customers of the platform (members/externals/guests uplifted to members). Represents the identity root for user-owned resources. Lifecycle state is tracked for business constraints. Referenced by {@link shopping_mall_ai_member_accounts}, {@link shopping_mall_ai_customer_emails}, {@link shopping_mall_ai_external_auths}, {@link shopping_mall_ai_identity_verifications}, {@link shopping_mall_ai_customer_connections}, {@link shopping_mall_ai_channel_piis}, and {@link shopping_mall_ai_addresses}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"membership_state","type":"string","description":"Membership lifecycle state of the customer (e.g., prospective, active, suspended, withdrawn). Used for access control and policy enforcement.","nullable":false},{"name":"active","type":"boolean","description":"Whether the customer account is currently active for normal operations.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the customer record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the customer record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the customer record is logically deleted.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["membership_state","created_at"]},{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_member_accounts","description":"Local authentication credentials for a customer. 1:1 with {@link shopping_mall_ai_customers}. Stores password hash and rotation timestamp. Managed indirectly via the customer identity domain.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owned customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetFieldName":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"password_hash","type":"string","description":"Hashed credential for local login. Plain passwords are never stored.","nullable":false},{"name":"password_updated_at","type":"datetime","description":"Timestamp when the password was last changed; used for session revocation policies.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the member account.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the member account.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the member account is logically deleted.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["customer_id","password_updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_customer_emails","description":"Email addresses owned by a {@link shopping_mall_ai_customers} account. Multiple emails are allowed per customer with one primary indicated by application logic. Used for login/notifications and identity proofing.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetFieldName":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"email","type":"string","description":"Email address value. Validated format and used for notifications and login recovery.","nullable":false},{"name":"verified","type":"boolean","description":"Whether this email has been verified by the user.","nullable":false},{"name":"verified_at","type":"datetime","description":"Timestamp when the email was verified.","nullable":true},{"name":"is_primary","type":"boolean","description":"Whether this email is the primary email for the customer. Enforced by application logic (one per customer).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the email record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the email record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the email record is logically deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["email"],"unique":true}],"plainIndexes":[{"fieldNames":["customer_id","created_at"]},{"fieldNames":["customer_id","is_primary"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_external_auths","description":"External authentication linkages (e.g., social or enterprise providers) associated with a {@link shopping_mall_ai_customers} account. Records the provider user identity and linkage times for audit, supporting policy-driven linkage and revocation.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Linked customer's {@link shopping_mall_ai_customers.id}. Nullable to allow pre-linkage records prior to customer creation by policy.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetFieldName":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"provider","type":"string","description":"External provider identifier (business name or key).","nullable":false},{"name":"provider_user_id","type":"string","description":"Provider-side unique identifier for the user.","nullable":false},{"name":"connected_at","type":"datetime","description":"Timestamp when the linkage was established.","nullable":false},{"name":"revoked_at","type":"datetime","description":"Timestamp when the linkage was revoked, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the external auth record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the external auth record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the external auth record is logically deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["provider","provider_user_id"],"unique":true}],"plainIndexes":[{"fieldNames":["customer_id","connected_at"]}],"ginIndexes":[{"fieldName":"provider_user_id"}]},{"name":"shopping_mall_ai_identity_verifications","description":"Identity verification attempts and outcomes for customers or prospective members. Acts as an immutable evidence log. Optionally references {@link shopping_mall_ai_customer_connections} for per-connection provenance. Append-only pattern from business perspective.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Related customer's {@link shopping_mall_ai_customers.id}. Nullable to allow pre-registration attempts.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetFieldName":"id"},"unique":false,"nullable":true},{"name":"customer_connection_id","type":"uuid","description":"Related connection's {@link shopping_mall_ai_customer_connections.id} used during verification.","relation":{"name":"connection","targetModel":"shopping_mall_ai_customer_connections","targetFieldName":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"method","type":"string","description":"Verification method (e.g., domestic_mobile_real_name, gov_id_check, sms_otp_kyc).","nullable":false},{"name":"result","type":"string","description":"Outcome category (e.g., success, failure, pending).","nullable":false},{"name":"reason","type":"string","description":"Optional failure or decision reason category for audit and user guidance.","nullable":true},{"name":"verified_at","type":"datetime","description":"Timestamp when verification succeeded, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the verification record (attempt time).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the verification record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the verification record is logically deleted (evidence retained by policy).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["customer_id","created_at"]},{"fieldNames":["customer_connection_id","created_at"]},{"fieldNames":["result","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_customer_connections","description":"Per-connection metadata captured for evidence and security analytics. May or may not be linked to a {@link shopping_mall_ai_customers} (guest vs member). Used by identity verification flows and session governance.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Optional linked customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetFieldName":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"ip","type":"string","description":"IP address observed for the connection (as captured for evidence).","nullable":false},{"name":"access_url","type":"uri","description":"Access URL where the connection occurred.","nullable":false},{"name":"referrer","type":"uri","description":"Referrer URL associated with the connection, if present.","nullable":true},{"name":"user_agent","type":"string","description":"User agent string (device/browser fingerprint) for analytics and fraud controls.","nullable":false},{"name":"device","type":"string","description":"Device descriptor extracted from user agent or platform metadata.","nullable":true},{"name":"first_seen_at","type":"datetime","description":"First time this connection was observed.","nullable":false},{"name":"last_seen_at","type":"datetime","description":"Most recent time this connection was observed.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the connection record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the connection record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the connection record is logically deleted.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["customer_id","last_seen_at"]},{"fieldNames":["ip","first_seen_at"]}],"ginIndexes":[{"fieldName":"user_agent"}]},{"name":"shopping_mall_ai_channel_piis","description":"Channel-scoped personal information overlays for a {@link shopping_mall_ai_customers} account. Enforces channel privacy by separating names/phone/locale per channel. One record per (customer, channel). This model is optimized for profile lookup and consented communications within a channel scope.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Scoped channel's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"given_name","type":"string","description":"Localized given name for the channel context.","nullable":false},{"name":"family_name","type":"string","description":"Localized family name for the channel context.","nullable":false},{"name":"phone","type":"string","description":"Channel-scoped contact phone number (formatted per channel policy).","nullable":true},{"name":"locale","type":"string","description":"Preferred locale for this channel scope (e.g., en-US, ko-KR).","nullable":true},{"name":"marketing_opt_in","type":"boolean","description":"Whether the customer opted-in to marketing messages in this channel.","nullable":false},{"name":"birthdate","type":"datetime","description":"Birthdate when policy requires storage; may be masked/omitted per jurisdiction.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the PII overlay.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the PII overlay.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the overlay is logically deleted.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["channel_id","customer_id"]},{"fieldNames":["customer_id","created_at"]}],"ginIndexes":[{"fieldName":"given_name"},{"fieldName":"family_name"},{"fieldName":"phone"}]},{"name":"shopping_mall_ai_addresses","description":"Customer-managed addresses with international formats and special delivery instructions. Optionally scoped to a channel to support per-channel primaries. Used in checkout and DSAR flows. Designed for global addressing and searchability without denormalization.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Optional channel scope's {@link shopping_mall_ai_channels.id} for per-channel primaries.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":true}],"plainFields":[{"name":"contact_name","type":"string","description":"Recipient or contact name for the address.","nullable":true},{"name":"country","type":"string","description":"Country/region code (e.g., ISO 3166-1 alpha-2).","nullable":false},{"name":"region","type":"string","description":"Administrative region/state/province if applicable.","nullable":true},{"name":"city","type":"string","description":"City or locality.","nullable":false},{"name":"postal_code","type":"string","description":"Postal or ZIP code in the local format.","nullable":false},{"name":"address_line1","type":"string","description":"Primary street address line.","nullable":false},{"name":"address_line2","type":"string","description":"Secondary address line (apartment, suite, etc.).","nullable":true},{"name":"instructions","type":"string","description":"Special delivery instructions or notes.","nullable":true},{"name":"phone_number","type":"string","description":"Contact phone number for delivery coordination.","nullable":true},{"name":"is_primary","type":"boolean","description":"Whether this address is the primary address for the customer within the optional channel scope (enforced by application logic).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the address record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the address record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp when the address record is logically deleted.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["customer_id","is_primary","created_at"]},{"fieldNames":["channel_id","customer_id","is_primary"]}],"ginIndexes":[{"fieldName":"address_line1"},{"fieldName":"city"},{"fieldName":"postal_code"},{"fieldName":"contact_name"}]}]},{"filename":"schema-03-rbac.prisma","namespace":"RBAC","models":[{"name":"shopping_mall_ai_roles","description":"Catalog of RBAC roles across the platform. Each role defines a named capability scope (e.g., platformWide, channelScoped, sellerScoped, customerScoped) and is assigned to users through {@link shopping_mall_ai_user_roles}. Permissions are associated via {@link shopping_mall_ai_role_permissions}. Roles are independently managed by administrators and audited through {@link shopping_mall_ai_admin_action_logs}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Machine-friendly unique code for the role (e.g., system_admin, channel_admin, seller_manager). Immutable identifier used by policy engines.","nullable":false},{"name":"name","type":"string","description":"Human-readable role name for management UI and audit readability.","nullable":false},{"name":"description","type":"string","description":"Business description of the role’s responsibilities and boundaries.","nullable":true},{"name":"scope_type","type":"string","description":"Scope semantics for this role. Expected values include platformWide, channelScoped, sellerScoped, and customerScoped as defined by governance.","nullable":false},{"name":"active","type":"boolean","description":"Whether the role is active and assignable.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for deprecation without physical removal.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["active","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_permissions","description":"Catalog of granular permissions that can be attached to roles via {@link shopping_mall_ai_role_permissions}. Represents system actions or resources (e.g., catalog.update_product, payments.cancel_pre_confirmation). Managed independently and referenced by RBAC policy evaluation.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Machine code of the permission (e.g., catalog.update_product). Used in authorization decisions.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the permission.","nullable":false},{"name":"description","type":"string","description":"Business purpose and constraints of this permission.","nullable":true},{"name":"domain","type":"string","description":"Business domain grouping for this permission (e.g., catalog, orders, payments, content).","nullable":false},{"name":"active","type":"boolean","description":"Whether the permission is currently enabled for assignment.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, retained for evidence and historical mapping.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["domain","active","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_role_permissions","description":"Junction mapping between {@link shopping_mall_ai_roles} and {@link shopping_mall_ai_permissions}. Establishes which permissions are granted to each role, capturing provenance of the grant for auditability. Typically managed through role/permission management workflows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"role_id","type":"uuid","description":"Granted role’s {@link shopping_mall_ai_roles.id}.","relation":{"name":"role","targetModel":"shopping_mall_ai_roles","targetField":"id"},"unique":false,"nullable":false},{"name":"permission_id","type":"uuid","description":"Granted permission’s {@link shopping_mall_ai_permissions.id}.","relation":{"name":"permission","targetModel":"shopping_mall_ai_permissions","targetField":"id"},"unique":false,"nullable":false},{"name":"granted_by_customer_id","type":"uuid","description":"Granting operator’s {@link shopping_mall_ai_customers.id} for audit provenance.","relation":{"name":"grantedByCustomer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"created_at","type":"datetime","description":"Creation timestamp for the grant.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp (e.g., metadata updates).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp to revoke while preserving evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["role_id","permission_id"],"unique":true}],"plainIndexes":[{"fieldNames":["granted_by_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_user_roles","description":"Assignments of {@link shopping_mall_ai_roles} to platform users (customers) with optional scope narrowing (channel or seller). Enables deny-by-default with least-privilege by linking a user to role(s) and scope(s). Frequently queried for audits and authorization checks.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Assigned user’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","mappingName":"shopping_mall_ai_user_roles_of_shopping_mall_ai_customer_id"},"unique":false,"nullable":false},{"name":"role_id","type":"uuid","description":"Assigned role’s {@link shopping_mall_ai_roles.id}.","relation":{"name":"role","targetModel":"shopping_mall_ai_roles"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel scope’s {@link shopping_mall_ai_channels.id} when scope_type=channelScoped.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":true},{"name":"seller_id","type":"uuid","description":"Seller scope’s {@link shopping_mall_ai_sellers.id} when scope_type=sellerScoped.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers"},"unique":false,"nullable":true},{"name":"granted_by_customer_id","type":"uuid","description":"Granting operator’s {@link shopping_mall_ai_customers.id} for audit provenance.","relation":{"name":"grantedByCustomer","targetModel":"shopping_mall_ai_customers","mappingName":"shopping_mall_ai_user_roles_of_granted_by_customer_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"scope_type","type":"string","description":"Scope semantics for this assignment (platformWide, channelScoped, sellerScoped, customerScoped).","nullable":false},{"name":"starts_at","type":"datetime","description":"Assignment effective start time, for time-bound grants and phased rollouts.","nullable":true},{"name":"ends_at","type":"datetime","description":"Assignment end time; authorization ceases after this point.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for revocation with evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","role_id","scope_type","channel_id","seller_id"],"unique":true}],"plainIndexes":[{"fieldNames":["channel_id"]},{"fieldNames":["seller_id"]},{"fieldNames":["granted_by_customer_id"]},{"fieldNames":["role_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","scope_type"]},{"fieldNames":["role_id","scope_type"]},{"fieldNames":["scope_type","channel_id"]},{"fieldNames":["scope_type","seller_id"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_admin_action_logs","description":"Immutable audit trail of privileged or sensitive actions performed by administrators or operators. Records who did what, when, where (scope), and the outcome, enabling compliance and forensic review. References the acting user and (optionally) the role used for the action. Events relate to various business resources across the platform.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"actor_customer_id","type":"uuid","description":"Acting user’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"actorCustomer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"actor_role_id","type":"uuid","description":"Role context’s {@link shopping_mall_ai_roles.id} used during the action, if applicable.","relation":{"name":"actorRole","targetModel":"shopping_mall_ai_roles"},"unique":false,"nullable":true},{"name":"channel_id","type":"uuid","description":"Channel scope’s {@link shopping_mall_ai_channels.id} where the action occurred, if applicable.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":true},{"name":"seller_id","type":"uuid","description":"Seller scope’s {@link shopping_mall_ai_sellers.id}, if applicable.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers"},"unique":false,"nullable":true}],"plainFields":[{"name":"action","type":"string","description":"Business action key (e.g., catalog.product.open, payments.cancel_pre_confirmation).","nullable":false},{"name":"resource_type","type":"string","description":"Target resource table or domain identifier (e.g., shopping_mall_ai_products).","nullable":false},{"name":"resource_id","type":"uuid","description":"Target resource’s UUID when available; may be null for non-entity actions.","nullable":true},{"name":"ip","type":"string","description":"Source IP of the actor connection, recorded for evidence and investigation.","nullable":true},{"name":"user_agent","type":"string","description":"User agent string of the actor’s client (browser/app).","nullable":true},{"name":"reason","type":"string","description":"Optional reason or justification supplied by the actor or policy reference.","nullable":true},{"name":"outcome","type":"string","description":"Outcome category (e.g., allowed, insufficientPermission, outOfScope, policyRestriction).","nullable":false},{"name":"created_at","type":"datetime","description":"Audit event creation timestamp (time of action).","nullable":false},{"name":"updated_at","type":"datetime","description":"Technical update timestamp (for metadata corrections if allowed).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if retention policy requires logical removal.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["actor_role_id"]},{"fieldNames":["seller_id"]},{"fieldNames":["actor_customer_id","created_at"]},{"fieldNames":["resource_type","resource_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["outcome","created_at"]}],"ginIndexes":[{"fieldName":"action"}]},{"name":"shopping_mall_ai_delegated_authorities","description":"Records of delegated authority where a permitted user (delegator) explicitly authorizes another user (delegatee) to act on their behalf within a declared scope and time window. Supports consent provenance for support operations and auditable on-behalf actions. Often referenced by authorization checks during delegated sessions.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"delegator_customer_id","type":"uuid","description":"Delegator’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"delegator","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_delegated_authorities_of_delegator_customer_id"},"unique":false,"nullable":false},{"name":"delegatee_customer_id","type":"uuid","description":"Delegatee’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"delegatee","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_delegated_authorities_of_delegatee_customer_id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel scope’s {@link shopping_mall_ai_channels.id} when scope_type=channelScoped.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"seller_id","type":"uuid","description":"Seller scope’s {@link shopping_mall_ai_sellers.id} when scope_type=sellerScoped.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"scope_type","type":"string","description":"Delegation scope semantics (platformWide, channelScoped, sellerScoped, customerScoped).","nullable":false},{"name":"consent_reason","type":"string","description":"Consent reason or case reference captured during delegation setup.","nullable":true},{"name":"active","type":"boolean","description":"Whether the delegation is currently active.","nullable":false},{"name":"started_at","type":"datetime","description":"Delegation effective start time.","nullable":false},{"name":"ended_at","type":"datetime","description":"Delegation end time when deactivated or expired.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for historical retention without physical removal.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["delegator_customer_id","created_at"]},{"fieldNames":["delegatee_customer_id","created_at"]},{"fieldNames":["active","started_at"]}],"ginIndexes":[{"fieldName":"consent_reason"}]},{"name":"shopping_mall_ai_break_glass_events","description":"Emergency access elevation (“break-glass”) events with approval chain and bounded time window. Used during incidents to grant time-limited access with full auditability. Read mostly by compliance/audit and incident response. Links requester and approver identities and optional scope (channel).","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"requester_customer_id","type":"uuid","description":"Requester’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"requester","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_break_glass_events_of_requester_customer_id"},"unique":false,"nullable":false},{"name":"approver_customer_id","type":"uuid","description":"Approver’s {@link shopping_mall_ai_customers.id} according to two-person rule.","relation":{"name":"approver","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_break_glass_events_of_approver_customer_id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel scope’s {@link shopping_mall_ai_channels.id} when elevation is channel-bound.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"scope_type","type":"string","description":"Elevation scope semantics (platformWide, channelScoped, sellerScoped, customerScoped).","nullable":false},{"name":"reason","type":"string","description":"Incident or emergency rationale for elevation request, suitable for audit and review.","nullable":false},{"name":"approved","type":"boolean","description":"Whether the event was approved per policy.","nullable":false},{"name":"window_start_at","type":"datetime","description":"Authorized elevation start timestamp.","nullable":true},{"name":"window_end_at","type":"datetime","description":"Authorized elevation end timestamp.","nullable":true},{"name":"resolved","type":"boolean","description":"Whether the event has been closed out with post-incident review completed.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for the event record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for administrative metadata.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if purged under retention policy.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["approved","window_start_at"]},{"fieldNames":["requester_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-04-roleentities.prisma","namespace":"RoleEntities","models":[{"name":"shopping_mall_ai_visitor","description":"Represents a visitor role entity. Used to track anonymous or pre-membership capabilities within a channel context. May optionally link to a {@link shopping_mall_ai_customers} record when a visitor later authenticates. Governance may search or soft-delete these records for evidence and policy analytics.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Optionally linked customer who is or becomes the subject of this visitor role. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel context for the visitor role. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the role assignment is currently active.","nullable":false},{"name":"status","type":"string","description":"Business status of the role (e.g., drafted, active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"When this role assignment became effective.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When this role assignment was revoked, if applicable.","nullable":true},{"name":"reason","type":"string","description":"Business reason for assignment or revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for audit trail.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for audit trail.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability and evidence retention.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_customer","description":"Represents the platform Customer role entity tied 1:1 to a member in {@link shopping_mall_ai_customers}. This table governs customer-role lifecycle (activation, suspension, withdrawal) and allows channel-scoped tracking via optional channel context. Removing the single-column unique on customer_id enables legitimate per-channel rows while preserving uniqueness per (customer, channel).","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Subject customer who holds the Customer role. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel context for channel-specific customer overlays. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the customer role is active and usable in commerce flows.","nullable":false},{"name":"status","type":"string","description":"Business lifecycle status (e.g., active, suspended, withdrawn).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Timestamp when the role became effective.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Timestamp when the role was revoked, if applicable.","nullable":true},{"name":"reason","type":"string","description":"Reason for state changes such as suspension or withdrawal.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for role entity.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for role entity.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_externalcustomer","description":"Represents an External Customer role for a member authenticated or linked via external identity providers. The linkages themselves live in {@link shopping_mall_ai_external_auths}; this table governs role lifecycle and compliance posture.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Subject internal customer entity mapped to an external identity. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":true,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel context for policy differences across channels. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the external customer role is currently active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., pending_link, active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Time when the external customer role became effective.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Time when the role was revoked, if applicable.","nullable":true},{"name":"reason","type":"string","description":"Reason for activation or revocation per policy.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for audit.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for audit.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_seller","description":"Represents a Seller role entity for a person operating under a seller organization. Links the actor (customer) to the seller entity with optional channel scope. Enforces role lifecycle and governance independent of general user profile or seller master data.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who is granted the Seller role. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Seller organization under which this role operates. Target model's {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope restricting where this seller role is effective. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the seller role is currently usable.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Effective date/time of role grant.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Revocation time, if removed.","nullable":true},{"name":"reason","type":"string","description":"Business reason for grant/revocation or status change.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","shopping_mall_ai_customer_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_sellermanager","description":"Represents a Seller Manager role entity. This grants elevated governance within the boundaries of a specific seller organization, optionally scoped to a channel. Managed separately from base Seller role for segregation of duties.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer receiving the Seller Manager role. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Seller organization context. Target model's {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope for the manager role. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the manager role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status of the manager role.","nullable":true},{"name":"assigned_at","type":"datetime","description":"Effective date/time of manager role grant.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When the manager role was revoked, if applicable.","nullable":true},{"name":"reason","type":"string","description":"Business reason for grant/revocation or status changes.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","shopping_mall_ai_customer_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_supportagent","description":"Represents a Support Agent role entity. May be platform-wide or scoped to a specific channel, enabling customer support operations with auditable boundaries. Managed independently for delegated authority workflows.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer granted the Support Agent role. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope limiting where the agent can operate. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"platform_scope","type":"boolean","description":"Whether this agent role is platform-wide (true) or not (false).","nullable":false},{"name":"active","type":"boolean","description":"Whether the support agent role is currently active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Effective datetime when the role was granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Datetime when the role was revoked, if any.","nullable":true},{"name":"reason","type":"string","description":"Reason for grant/revocation or policy state changes.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for audit.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for audit.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","platform_scope"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_contentmoderator","description":"Represents a Content Moderator role entity. Allows moderation operations either platform-wide or channel-scoped. This table controls lifecycle and scope distinct from user identity and general permissions.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who is assigned as Content Moderator. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope for moderation. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"platform_scope","type":"boolean","description":"Whether this moderator role is platform-wide (true) or scoped (false).","nullable":false},{"name":"active","type":"boolean","description":"Whether the moderator role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Effective datetime when moderation privileges were granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Datetime when privileges were revoked, if any.","nullable":true},{"name":"reason","type":"string","description":"Reason for lifecycle changes or policy modifications.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","platform_scope"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_financemanager","description":"Represents a Finance Manager role entity. Supports financial operations such as payment cancellations and reconciliation within channel or platform-wide scope, governed by segregation of duties policies.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who holds Finance Manager privileges. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope for financial governance. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"platform_scope","type":"boolean","description":"Whether this finance role is platform-wide (true) or scoped (false).","nullable":false},{"name":"active","type":"boolean","description":"Whether the finance manager role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"Effective datetime of role grant.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Datetime of revocation, if any.","nullable":true},{"name":"reason","type":"string","description":"Business reason for grant/revocation or status change.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","platform_scope"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_channeladmin","description":"Represents a Channel Administrator role entity. This role is strictly channel-scoped and controls channel configuration, categories, and policies per governance rules.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who is the Channel Administrator. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel for which the admin has authority. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the channel admin role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"When the channel admin role was granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When the role was revoked, if it was removed.","nullable":true},{"name":"reason","type":"string","description":"Business reason for grant or revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","shopping_mall_ai_customer_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_systemadmin","description":"Represents a System Administrator role entity. Platform-wide by nature; not bound to a specific channel. Governs platform-level configurations and compliance settings under strict audit.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who is granted System Administrator privileges. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"platform_scope","type":"boolean","description":"Always true for system administrators; indicates platform-wide authority.","nullable":false},{"name":"active","type":"boolean","description":"Whether the system admin role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"When the system admin role was granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When the role was revoked, if any.","nullable":true},{"name":"reason","type":"string","description":"Business reason for assignment or revocation.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_auditor","description":"Represents an Auditor role entity. Typically platform-wide but may optionally be scoped to a channel for investigative access. Read-only by policy with immutable evidence access.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who is granted Auditor privileges. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope for audit access within bounds. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"platform_scope","type":"boolean","description":"Whether this auditor privilege is platform-wide (true) or not (false).","nullable":false},{"name":"active","type":"boolean","description":"Whether the auditor role is active.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., active, suspended).","nullable":true},{"name":"assigned_at","type":"datetime","description":"When the auditor role was granted.","nullable":true},{"name":"revoked_at","type":"datetime","description":"When the role was revoked, if any.","nullable":true},{"name":"reason","type":"string","description":"Business reason for grant/revocation or status change.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for evidence.","nullable":false},{"name":"updated_at","type":"datetime","description":"Update timestamp for evidence.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","platform_scope"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-05-files.prisma","namespace":"Files","models":[{"name":"shopping_mall_ai_file_assets","description":"Master record for a file group (logical asset) representing publishable content and its governance metadata. Each asset can have multiple {@link shopping_mall_ai_file_versions} for immutable history, {@link shopping_mall_ai_file_permissions} for access control, and {@link shopping_mall_ai_file_derivatives} via versions for delivery optimization. Links to channel context and uploader for audit and privacy governance. Retention policy binding is required for compliance.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Owning channel's {@link shopping_mall_ai_channels.id}. Optional when the asset is platform-scoped.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Uploader customer's {@link shopping_mall_ai_customers.id}. Captures provenance for audit.","relation":{"name":"uploader","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_file_retention_policy_id","type":"uuid","description":"Applied retention policy's {@link shopping_mall_ai_file_retention_policies.id}. Required for purge eligibility and legal hold rules.","relation":{"name":"retentionPolicy","targetModel":"shopping_mall_ai_file_retention_policies","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"original_filename","type":"string","description":"Original file name as provided by uploader. Used for audit and search.","nullable":false},{"name":"normalized_filename","type":"string","description":"Normalized filename (policy-compliant) for consistent delivery and search.","nullable":false},{"name":"extension","type":"string","description":"File extension without leading dot (e.g., \"jpg\", \"pdf\").","nullable":false},{"name":"declared_mime","type":"string","description":"Declared MIME type from client or metadata at upload time.","nullable":false},{"name":"detected_mime","type":"string","description":"Server-detected MIME type post-validation/scan. May differ from declared.","nullable":true},{"name":"visibility_class","type":"string","description":"Visibility class: public/restricted/private per policy. Controls exposure in discovery and access guards.","nullable":false},{"name":"delivery_class","type":"string","description":"Delivery class: public (CDN-cacheable) or restricted/private (signed-link issuance).","nullable":false},{"name":"access_policy_code","type":"string","description":"Identifier for the access policy configuration applied to this asset (business-level code).","nullable":true},{"name":"legal_hold","type":"boolean","description":"Whether the asset is under legal hold, blocking purge regardless of retention.","nullable":false},{"name":"published_at","type":"datetime","description":"First publication timestamp of the asset (business event).","nullable":true},{"name":"description","type":"string","description":"Administrative description or notes about the asset for governance.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if the asset is logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["visibility_class","created_at"]},{"fieldNames":["delivery_class","created_at"]}],"ginIndexes":[{"fieldName":"original_filename"},{"fieldName":"normalized_filename"}]},{"name":"shopping_mall_ai_file_versions","description":"Immutable versions of a file asset capturing binary-specific metadata and storage references. Each version belongs to one {@link shopping_mall_ai_file_assets} and may have associated {@link shopping_mall_ai_file_scans} results and {@link shopping_mall_ai_file_derivatives}. Versions are append-only for evidence and audit.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_file_asset_id","type":"uuid","description":"Parent asset's {@link shopping_mall_ai_file_assets.id}.","relation":{"name":"asset","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional parent version's {@link shopping_mall_ai_file_versions.id} for lineage when a version derives from another.","relation":{"name":"parent","targetModel":"shopping_mall_ai_file_versions","targetField":"id","mappingName":"recursive"},"unique":false,"nullable":true}],"plainFields":[{"name":"version_number","type":"int","description":"Monotonic version number per asset, starting at 1.","nullable":false},{"name":"storage_uri","type":"uri","description":"Authoritative storage URI for this binary version (e.g., s3://bucket/key or https://...).","nullable":false},{"name":"byte_size","type":"int","description":"Binary size in bytes for this version.","nullable":false},{"name":"checksum","type":"string","description":"Strong hash checksum (e.g., SHA-256) for integrity verification.","nullable":false},{"name":"declared_mime","type":"string","description":"Declared MIME type recorded for this specific version.","nullable":false},{"name":"detected_mime","type":"string","description":"Detected MIME type after server-side validation/scan.","nullable":true},{"name":"validation_status","type":"string","description":"Validation outcome: pending/passed/failed (business string).","nullable":false},{"name":"upload_completed_at","type":"datetime","description":"Timestamp when upload finalized for this version.","nullable":true},{"name":"published_at","type":"datetime","description":"Publication timestamp when this version became the active public version (if applicable).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (purge scheduling uses policy).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_file_asset_id","version_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_file_asset_id","created_at"]},{"fieldNames":["checksum","created_at"]},{"fieldNames":["declared_mime","detected_mime"]}],"ginIndexes":[{"fieldName":"checksum"}]},{"name":"shopping_mall_ai_file_scans","description":"Security and policy scanning results for a specific {@link shopping_mall_ai_file_versions}. Captures engine metadata, risk scores, and evidence links (e.g., scan report URI). Multiple scans may exist due to re-scans or policy updates.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_file_version_id","type":"uuid","description":"Target version's {@link shopping_mall_ai_file_versions.id}.","relation":{"name":"version","targetModel":"shopping_mall_ai_file_versions","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"scan_status","type":"string","description":"Scan status such as pending/clean/infected/inconclusive/timeout.","nullable":false},{"name":"engine_version","type":"string","description":"Scanner engine version string used to process this scan.","nullable":true},{"name":"issues_found","type":"int","description":"Count of detected issues or flags.","nullable":false},{"name":"risk_score","type":"double","description":"Quantified risk score used for policy decisions.","nullable":true},{"name":"scan_report_uri","type":"uri","description":"Link to detailed scan report or artifact.","nullable":true},{"name":"rescanned","type":"boolean","description":"Whether this record is a re-scan of the same version.","nullable":false},{"name":"scanned_at","type":"datetime","description":"Time when scanning completed.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_file_version_id","scanned_at"]},{"fieldNames":["scan_status","scanned_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_file_permissions","description":"Access control entries for {@link shopping_mall_ai_file_assets}. Each row grants a specific permission (e.g., read/write) to a grantee type within scope (customer, role, or channel). Entries are typically administered through the parent asset rather than independently, so this table is a supporting entity. It combines with delivery/visibility classes for enforcement and is fully auditable.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_file_asset_id","type":"uuid","description":"Protected asset's {@link shopping_mall_ai_file_assets.id}","relation":{"name":"asset","targetModel":"shopping_mall_ai_file_assets"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Grantee customer's {@link shopping_mall_ai_customers.id} (nullable when grant targets role or channel).","relation":{"name":"granteeCustomer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_role_id","type":"uuid","description":"Grantee role's {@link shopping_mall_ai_roles.id} (nullable when grant targets customer or channel).","relation":{"name":"granteeRole","targetModel":"shopping_mall_ai_roles"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Grantee channel scope's {@link shopping_mall_ai_channels.id} (nullable when grant targets customer or role).","relation":{"name":"granteeChannel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":true}],"plainFields":[{"name":"permission","type":"string","description":"Granted permission keyword (e.g., read, write, approve). Interpreted by the access policy layer.","nullable":false},{"name":"expires_at","type":"datetime","description":"Optional expiration for time-bound access (required by policy when time_bound=true).","nullable":true},{"name":"time_bound","type":"boolean","description":"Whether this permission is time-bound (paired with expires_at by policy).","nullable":false},{"name":"granted_by_actor","type":"string","description":"Actor label that granted this permission (full audit is captured elsewhere).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_file_asset_id","permission","shopping_mall_ai_customer_id"],"unique":true},{"fieldNames":["shopping_mall_ai_file_asset_id","permission","shopping_mall_ai_role_id"],"unique":true},{"fieldNames":["shopping_mall_ai_file_asset_id","permission","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_file_asset_id","permission","created_at"]},{"fieldNames":["expires_at","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_file_derivatives","description":"Generated or attached derivative assets produced from a specific {@link shopping_mall_ai_file_versions} (e.g., thumbnails, previews, watermarked copies, transcripts). Improves delivery and UX while preserving chain-of-custody to the source version.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_file_version_id","type":"uuid","description":"Source version's {@link shopping_mall_ai_file_versions.id} from which this derivative is generated.","relation":{"name":"sourceVersion","targetModel":"shopping_mall_ai_file_versions","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"derivative_type","type":"string","description":"Type of derivative (e.g., thumbnail, preview, ocr_text, transcript, watermark).","nullable":false},{"name":"storage_uri","type":"uri","description":"Storage URI of the derivative artifact.","nullable":false},{"name":"width","type":"int","description":"Pixel width for image/video derivatives when applicable.","nullable":true},{"name":"height","type":"int","description":"Pixel height for image/video derivatives when applicable.","nullable":true},{"name":"byte_size","type":"int","description":"Size in bytes for this derivative.","nullable":true},{"name":"language_code","type":"string","description":"Language code when the derivative contains language-dependent content (e.g., transcript).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_file_version_id","derivative_type"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_file_version_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_file_retention_policies","description":"Retention policy definitions for files. Controls retention windows, purge grace periods, and legal-hold allowances. Assets reference this table to determine purge eligibility timelines and compliance behavior.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[],"plainFields":[{"name":"code","type":"string","description":"Unique business code of the retention policy (e.g., TXN_5Y, UGC_3Y).","nullable":false},{"name":"name","type":"string","description":"Human-readable policy name for administrative use.","nullable":false},{"name":"description","type":"string","description":"Detailed description of retention rules and scope.","nullable":true},{"name":"retention_days","type":"int","description":"Number of days data should be retained before eligible for purge (excluding legal holds).","nullable":false},{"name":"purge_grace_days","type":"int","description":"Optional grace period (days) before purge after retention window ends.","nullable":true},{"name":"legal_hold_allowed","type":"boolean","description":"Whether legal holds are permitted for this policy class.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["retention_days","purge_grace_days"]}],"ginIndexes":[]}]},{"filename":"schema-06-sellers.prisma","namespace":"Sellers","models":[{"name":"shopping_mall_ai_sellers","description":"Core seller entity representing a merchant organization operating on the platform. Managed by member users and associated to channels via {@link shopping_mall_ai_seller_channels}. Verification evidence is recorded in {@link shopping_mall_ai_seller_verifications}. Lifecycle transitions are captured in {@link shopping_mall_ai_seller_histories}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"owner_customer_id","type":"uuid","description":"Owning member account's {@link shopping_mall_ai_customers.id}. Represents the account that manages this seller.","relation":{"name":"ownerCustomer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"logo_file_asset_id","type":"uuid","description":"Optional logo image file reference. Targets {@link shopping_mall_ai_file_assets.id}.","relation":{"name":"logoFile","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Business identifier for the seller. Unique across the platform for governance and integrations.","nullable":false},{"name":"display_name","type":"string","description":"Human-readable seller display name used across listings and dashboards.","nullable":false},{"name":"status","type":"string","description":"Seller lifecycle status (e.g., Draft, PendingReview, Active, Suspended, Archived). Business logic enforces transitions via histories.","nullable":false},{"name":"description","type":"string","description":"Optional descriptive text about the seller (business profile, store intro).","nullable":true},{"name":"tax_id","type":"string","description":"Optional tax/business registration identifier (policy-governed handling).","nullable":true},{"name":"verification_required","type":"boolean","description":"Whether additional verification is required before activation per channel or policy.","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when the seller was approved/activated. Null until approved.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for the seller record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for the seller record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if the seller was logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["owner_customer_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"display_name"}]},{"name":"shopping_mall_ai_seller_verifications","description":"Verification attempts and outcomes for sellers. Records jurisdiction, method, requester/reviewer identities, and timestamps. Supports compliance evidence and policy re-verification. Related seller in {@link shopping_mall_ai_sellers}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Related seller's {@link shopping_mall_ai_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context for the verification. Targets {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"requested_by_customer_id","type":"uuid","description":"Requester actor's {@link shopping_mall_ai_customers.id}. Usually the seller operator.","relation":{"name":"requestedBy","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_seller_verifications_of_requested_by__48dc40ac"},"unique":false,"nullable":true},{"name":"reviewed_by_customer_id","type":"uuid","description":"Reviewer/approver actor's {@link shopping_mall_ai_customers.id}. Typically an admin within scope.","relation":{"name":"reviewedBy","targetModel":"shopping_mall_ai_customers","targetField":"id","mappingName":"shopping_mall_ai_seller_verifications_of_reviewed_by_c_c0935508"},"unique":false,"nullable":true},{"name":"evidence_file_asset_id","type":"uuid","description":"Optional file evidence reference. Targets {@link shopping_mall_ai_file_assets.id}.","relation":{"name":"evidenceFile","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"method","type":"string","description":"Verification method used (e.g., domestic_real_name, document_check, bank_account).","nullable":false},{"name":"jurisdiction","type":"string","description":"Jurisdiction/region governing the verification policy (e.g., KR, US, EU).","nullable":false},{"name":"outcome","type":"string","description":"Outcome category (e.g., approved, rejected, expired, pending).","nullable":false},{"name":"reason","type":"string","description":"Optional reason or note for outcome/decision.","nullable":true},{"name":"requested_at","type":"datetime","description":"Timestamp when verification was requested/initiated.","nullable":false},{"name":"reviewed_at","type":"datetime","description":"Timestamp when verification was reviewed/approved/rejected.","nullable":true},{"name":"expires_at","type":"datetime","description":"Optional validity expiration for the verification decision.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for this verification record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for this verification record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if this verification record was logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","outcome","requested_at"]},{"fieldNames":["jurisdiction","requested_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_seller_performance_metrics","description":"Aggregated performance metrics for a seller over a defined period. Captures KPIs such as order counts, GMV, cancellation/on-time delivery rates, and average rating. Functions as a historical snapshot for analytics and trend analysis. Related seller in {@link shopping_mall_ai_sellers}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Measured seller's {@link shopping_mall_ai_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"period_start","type":"datetime","description":"Inclusive UTC timestamp for the start of the aggregation window.","nullable":false},{"name":"period_end","type":"datetime","description":"Exclusive UTC timestamp for the end of the aggregation window.","nullable":false},{"name":"granularity","type":"string","description":"Aggregation grain (e.g., day, week, month).","nullable":false},{"name":"order_count","type":"int","description":"Total number of orders in the period.","nullable":false},{"name":"gmv","type":"double","description":"Gross merchandise value in settlement currency for the period.","nullable":false},{"name":"cancellation_rate","type":"double","description":"Share of cancelled orders over total orders (0–1).","nullable":false},{"name":"on_time_delivery_rate","type":"double","description":"Share of deliveries meeting promised windows (0–1).","nullable":false},{"name":"average_rating","type":"double","description":"Average customer review rating (e.g., 1–5 scale).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp for this snapshot record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for this snapshot record (rarely changes).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if the snapshot is withdrawn from reporting.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","period_start","period_end","granularity"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","period_start","period_end"]},{"fieldNames":["granularity"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_seller_histories","description":"Immutable history records for seller lifecycle/state changes and governance actions. Stores who/when/why details for audit trails. Related seller in {@link shopping_mall_ai_sellers}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Target seller's {@link shopping_mall_ai_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"actor_customer_id","type":"uuid","description":"Actor identity performing the change. {@link shopping_mall_ai_customers.id}.","relation":{"name":"actor","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true},{"name":"channel_id","type":"uuid","description":"Optional channel context for the action. {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"action","type":"string","description":"Action category (e.g., submit_for_review, approve, suspend, resume, archive, update_profile).","nullable":false},{"name":"from_status","type":"string","description":"Previous lifecycle status before the action.","nullable":true},{"name":"to_status","type":"string","description":"Resulting lifecycle status after the action.","nullable":true},{"name":"reason","type":"string","description":"Optional reason codes or narrative for the action taken.","nullable":true},{"name":"notes","type":"string","description":"Optional free-form notes to provide more context for the action.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for this history entry.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for this history entry (rarely updated).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when the history entry is logically removed from default views.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","created_at"]},{"fieldNames":["channel_id","created_at"]}],"ginIndexes":[{"fieldName":"action"}]},{"name":"shopping_mall_ai_seller_channels","description":"Junction table mapping sellers to channels where they operate. Supports activation windows and soft deletion. Related entities: {@link shopping_mall_ai_sellers} and {@link shopping_mall_ai_channels}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Mapped seller's {@link shopping_mall_ai_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Mapped channel's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"active","type":"boolean","description":"Whether the seller is currently enabled in the channel.","nullable":false},{"name":"assigned_at","type":"datetime","description":"Timestamp when the mapping became effective.","nullable":false},{"name":"removed_at","type":"datetime","description":"Timestamp when the mapping was deactivated/removed, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp for this mapping record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for this mapping record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if the mapping is logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","active"]},{"fieldNames":["channel_id","active"]}],"ginIndexes":[]}]},{"filename":"schema-07-catalog.prisma","namespace":"Catalog","models":[{"name":"shopping_mall_ai_products","description":"Primary catalog entity representing a sellable product owned by a seller within a channel/section context. Holds core attributes and lifecycle state. Related entities include media, attachments, tags, SEO overrides, categories, and historical states captured by {@link shopping_mall_ai_product_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_section_id","type":"uuid","description":"Optional merchandising section within the channel. {@link shopping_mall_ai_sections.id}","relation":{"name":"section","targetModel":"shopping_mall_ai_sections","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Owning seller. {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_return_policy_id","type":"uuid","description":"Linked return policy template. {@link shopping_mall_ai_return_policies.id}","relation":{"name":"returnPolicy","targetModel":"shopping_mall_ai_return_policies","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Seller-scoped product code used as a business identifier and for bulk operations.","nullable":false},{"name":"name","type":"string","description":"Product display name shown to customers.","nullable":false},{"name":"short_description","type":"string","description":"Short marketing description used in listings.","nullable":true},{"name":"long_description","type":"string","description":"Long-form product description (HTML/Markdown/text).","nullable":true},{"name":"status","type":"string","description":"Lifecycle status (Draft, PendingApproval, Open, Paused, Closed, Suspended, Discontinued) as business label.","nullable":false},{"name":"base_price","type":"double","description":"Base price before option adjustments and discounts, in the given currency.","nullable":false},{"name":"currency","type":"string","description":"Currency code (e.g., USD, KRW) for base_price as a business string.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_seller_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status"]},{"fieldNames":["shopping_mall_ai_seller_id","status"]},{"fieldNames":["shopping_mall_ai_section_id","status"]},{"fieldNames":["created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_product_snapshots","description":"Immutable historical record of a product state for evidence and audit. Captures business-visible fields at a point in time and links back to {@link shopping_mall_ai_products}. Used by carts, orders, inquiries, reviews, and favorites to bind to purchase-time context.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Source product reference. {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context at snapshot time. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Seller context at snapshot time. {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"version","type":"int","description":"Sequential version number for the product’s snapshot history.","nullable":false},{"name":"code","type":"string","description":"Product code captured at snapshot time.","nullable":false},{"name":"name","type":"string","description":"Product name captured at snapshot time.","nullable":false},{"name":"short_description","type":"string","description":"Short description captured at snapshot time.","nullable":true},{"name":"long_description","type":"string","description":"Long description captured at snapshot time.","nullable":true},{"name":"status","type":"string","description":"Lifecycle status captured at snapshot time.","nullable":false},{"name":"base_price","type":"double","description":"Base price captured at snapshot time.","nullable":false},{"name":"currency","type":"string","description":"Currency captured at snapshot time.","nullable":false},{"name":"slug","type":"string","description":"SEO slug at snapshot time, if any.","nullable":true},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp (time of capture).","nullable":false},{"name":"updated_at","type":"datetime","description":"Optional maintenance timestamp for correction notes (snapshots stay immutable in content).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when snapshots are retired under retention policies (rare).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","created_at"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"slug"}]},{"name":"shopping_mall_ai_product_media","description":"Files (images/videos) associated with {@link shopping_mall_ai_products}. Governs media roles and ordering for presentation. Binary/security aspects are managed by Files domain tables ({@link shopping_mall_ai_file_assets}).","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Belonged product’s {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_file_asset_id","type":"uuid","description":"Linked file asset’s {@link shopping_mall_ai_file_assets.id}","relation":{"name":"fileAsset","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"role","type":"string","description":"Business role of the media (e.g., primary, gallery, manual).","nullable":false},{"name":"position","type":"int","description":"Ordering sequence for deterministic display.","nullable":false},{"name":"alt_text","type":"string","description":"Alt text for accessibility and SEO.","nullable":true},{"name":"visible","type":"boolean","description":"Visibility flag per policy.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","shopping_mall_ai_file_asset_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","position"]},{"fieldNames":["shopping_mall_ai_product_id","created_at"]}],"ginIndexes":[{"fieldName":"alt_text"}]},{"name":"shopping_mall_ai_product_tags","description":"Per-channel tags associated with {@link shopping_mall_ai_products} to support discovery, vocabulary governance, and search relevance tuning. Managed as supporting data.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Target product’s {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context of the tag. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"tag","type":"string","description":"Tag text governed by channel vocabularies.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","shopping_mall_ai_channel_id","tag"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[{"fieldName":"tag"}]},{"name":"shopping_mall_ai_product_attachments","description":"Supporting file attachments for {@link shopping_mall_ai_products} (e.g., manuals, certificates) distinct from primary media. Binary management delegated to Files domain.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Target product’s {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_file_asset_id","type":"uuid","description":"Attached file asset’s {@link shopping_mall_ai_file_assets.id}","relation":{"name":"fileAsset","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Human-readable title for the attachment.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","shopping_mall_ai_file_asset_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_return_policies","description":"Return/exchange policy templates that products may reference. Managed by admins/sellers per channel; referenced by {@link shopping_mall_ai_products}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope when policy is channel-specific. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Optional seller scope for seller-owned policies. {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Business code for the return policy; unique within channel/seller scope.","nullable":false},{"name":"name","type":"string","description":"Human-readable policy name.","nullable":false},{"name":"body","type":"string","description":"Policy content (rich text stored as string).","nullable":false},{"name":"effective_from","type":"datetime","description":"Start of policy validity period.","nullable":false},{"name":"effective_to","type":"datetime","description":"End of policy validity period, if scheduled.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code","shopping_mall_ai_channel_id","shopping_mall_ai_seller_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_seller_id","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_product_seo_overrides","description":"Channel-specific SEO overrides for {@link shopping_mall_ai_products} including slug history and meta fields. Used to tailor search and social previews per channel without altering the base product.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Target product’s {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel where the override applies. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"slug","type":"string","description":"SEO-friendly URL slug for the product in this channel.","nullable":false},{"name":"title_tag","type":"string","description":"Override for HTML title tag.","nullable":true},{"name":"meta_description","type":"string","description":"Override for meta description.","nullable":true},{"name":"canonical_uri","type":"uri","description":"Canonical URL for the product detail page, if explicitly set.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","slug"],"unique":true},{"fieldNames":["shopping_mall_ai_product_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[{"fieldName":"slug"},{"fieldName":"title_tag"},{"fieldName":"meta_description"}]},{"name":"shopping_mall_ai_product_categories","description":"Junction table connecting {@link shopping_mall_ai_products} to channel-specific {@link shopping_mall_ai_categories}. Supports multi-category assignment and primary flag for navigation. Analytics rely on historical mappings maintained elsewhere.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Assigned product’s {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_category_id","type":"uuid","description":"Target category’s {@link shopping_mall_ai_categories.id}","relation":{"name":"category","targetModel":"shopping_mall_ai_categories","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context for the assignment. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"primary","type":"boolean","description":"Whether this assignment is the primary category for navigation.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","shopping_mall_ai_category_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]},{"fieldNames":["shopping_mall_ai_category_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_bundles","description":"Defines a product as a bundle and its pricing policy. Each bundle corresponds to exactly one {@link shopping_mall_ai_products} record; composition lines live in {@link shopping_mall_ai_bundle_items}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Product that represents this bundle. {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"pricing_model","type":"string","description":"Pricing model for the bundle (e.g., fixed, sum_of_parts) expressed as a business string identifier.","nullable":false},{"name":"active","type":"boolean","description":"Whether the bundle definition is active.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_bundle_items","description":"Composition lines for {@link shopping_mall_ai_bundles}, referencing component unit products and enforcing required/optional rules and multiplicity constraints.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_bundle_id","type":"uuid","description":"Parent bundle’s {@link shopping_mall_ai_bundles.id}","relation":{"name":"bundle","targetModel":"shopping_mall_ai_bundles","targetField":"id"},"unique":false,"nullable":false},{"name":"component_product_id","type":"uuid","description":"Component unit product’s {@link shopping_mall_ai_products.id}","relation":{"name":"componentProduct","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"required","type":"boolean","description":"Whether the component is required in every purchase configuration.","nullable":false},{"name":"min_quantity","type":"int","description":"Minimum quantity allowed for the component.","nullable":false},{"name":"max_quantity","type":"int","description":"Maximum quantity allowed for the component, if any.","nullable":true},{"name":"sequence","type":"int","description":"Display order within the bundle.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_bundle_id","component_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_bundle_id","sequence"]},{"fieldNames":["shopping_mall_ai_bundle_id","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-08-options-inventory.prisma","namespace":"OptionsInventory","models":[{"name":"shopping_mall_ai_option_groups","description":"Product-scoped option groups that define configuration dimensions (e.g., Color, Size) for a product. Each group controls requirement and whether selections affect price and/or inventory. Managed under the product context. One product can have multiple groups ordered for UI/validation. Related options stored in {@link shopping_mall_ai_options}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Belonged product's {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Business code of the option group, unique per product for stable references and imports.","nullable":false},{"name":"name","type":"string","description":"Human-readable name of the option group (e.g., \"Color\"). Used for display and search.","nullable":false},{"name":"display_type","type":"string","description":"Presentation type of the group (selection, boolean, numeric, string). Used by UI; business logic validates types.","nullable":false},{"name":"required","type":"boolean","description":"Whether this option group must be selected during configuration resolution.","nullable":false},{"name":"variable_for_price","type":"boolean","description":"Whether selections in this group affect price computations.","nullable":false},{"name":"variable_for_inventory","type":"boolean","description":"Whether selections in this group affect inventory (SKU generation).","nullable":false},{"name":"order_index","type":"int","description":"Display and validation order among groups for the same product.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null means active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_options","description":"Concrete selectable values within an option group (e.g., value_code=RED, label=\"Red\"). Options can optionally adjust price and/or impact inventory. Ordering is deterministic for UI. Belongs to {@link shopping_mall_ai_option_groups}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_option_group_id","type":"uuid","description":"Parent option group's {@link shopping_mall_ai_option_groups.id}","relation":{"name":"group","targetModel":"shopping_mall_ai_option_groups","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"value_code","type":"string","description":"Stable value code within the group used in rules and SKU hashing.","nullable":false},{"name":"label","type":"string","description":"Displayed label for the option value. Used in search and receipts.","nullable":false},{"name":"enabled","type":"boolean","description":"Whether the option can be used in new configurations. Historical SKUs remain valid.","nullable":false},{"name":"affects_price","type":"boolean","description":"Whether this option value contributes to price adjustment.","nullable":false},{"name":"price_delta","type":"double","description":"Optional price adjustment amount relative to product base price. Positive or negative.","nullable":true},{"name":"affects_inventory","type":"boolean","description":"Whether this option value contributes to inventory-affecting configuration identity.","nullable":false},{"name":"numeric_min","type":"double","description":"Minimum bound for numeric option values where applicable.","nullable":true},{"name":"numeric_max","type":"double","description":"Maximum bound for numeric option values where applicable.","nullable":true},{"name":"numeric_step","type":"double","description":"Step value for numeric option values where applicable.","nullable":true},{"name":"string_pattern","type":"string","description":"Optional regex-like pattern description for string options (documentation reference).","nullable":true},{"name":"order_index","type":"int","description":"Display order within the group.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null means active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_option_group_id","value_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_option_group_id","order_index"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"shopping_mall_ai_option_dependencies","description":"Dependency rules between option values to enforce valid or invalid combinations. Expresses relations like \"A requires B\" or \"A excludes C\" using option-to-option relations. Evaluated during configuration resolution for products using the related groups and options.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"source_option_id","type":"uuid","description":"Source option value's {@link shopping_mall_ai_options.id} that imposes the rule.","relation":{"name":"sourceOption","targetModel":"shopping_mall_ai_options","targetField":"id","mappingName":"shopping_mall_ai_option_dependencies_of_source_option_id"},"unique":false,"nullable":false},{"name":"target_option_id","type":"uuid","description":"Target option value's {@link shopping_mall_ai_options.id} affected by the rule.","relation":{"name":"targetOption","targetModel":"shopping_mall_ai_options","targetField":"id","mappingName":"shopping_mall_ai_option_dependencies_of_target_option_id"},"unique":false,"nullable":false}],"plainFields":[{"name":"relation","type":"string","description":"Rule type: requires, excludes, enables, or disables. Business logic validates allowed values.","nullable":false},{"name":"active","type":"boolean","description":"Whether this rule is currently enforced for new configurations.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for policy-driven removal.","nullable":true}],"uniqueIndexes":[{"fieldNames":["source_option_id","target_option_id","relation"],"unique":true}],"plainIndexes":[{"fieldNames":["source_option_id","created_at"]},{"fieldNames":["target_option_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_skus","description":"Final sellable configuration (SKU) per product representing a deterministic set of option selections. Serves as the anchor for inventory, serial/lots, and order item binding. Managed independently across products for operations, analytics, and reconciliation.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Owner product's {@link shopping_mall_ai_products.id}.","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Seller/business-visible SKU code unique per product.","nullable":false},{"name":"configuration_hash","type":"string","description":"Deterministic hash of option selections within the product. Unique per product for lookup and integrity.","nullable":false},{"name":"serial_tracking","type":"boolean","description":"Whether this SKU requires serial number tracking.","nullable":false},{"name":"lot_tracking","type":"boolean","description":"Whether this SKU uses lot/batch with expiry tracking.","nullable":false},{"name":"make_to_order","type":"boolean","description":"Whether this SKU is make-to-order and not held in on-hand inventory.","nullable":false},{"name":"active","type":"boolean","description":"Operational availability of the SKU for sale considering policy/state.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null means active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_product_id","configuration_hash"],"unique":true},{"fieldNames":["shopping_mall_ai_product_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_id","created_at"]}],"ginIndexes":[{"fieldName":"code"}]},{"name":"shopping_mall_ai_sku_options","description":"Junction table linking {@link shopping_mall_ai_skus} to selected {@link shopping_mall_ai_options} that compose the final configuration identity. Enables reconstruction and validation of SKU make-up.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Linked SKU's {@link shopping_mall_ai_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_option_id","type":"uuid","description":"Linked option value's {@link shopping_mall_ai_options.id}","relation":{"name":"option","targetModel":"shopping_mall_ai_options","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","shopping_mall_ai_option_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_option_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_inventory_levels","description":"Current inventory state per {@link shopping_mall_ai_skus}. Stores on-hand/reserved counts, safety stock, reorder thresholds, and derived availability status for customer-facing messaging and internal alerts.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Target SKU's {@link shopping_mall_ai_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":true,"nullable":false}],"plainFields":[{"name":"on_hand","type":"int","description":"Current on-hand quantity available for sale (excluding reserved and safety stock).","nullable":false},{"name":"reserved","type":"int","description":"Quantity reserved for in-progress orders not yet shipped or cancelled.","nullable":false},{"name":"safety_stock","type":"int","description":"Non-sellable buffer to prevent stockouts.","nullable":false},{"name":"reorder_threshold","type":"int","description":"Alert threshold that triggers replenishment workflows when on-hand drops to or below this number.","nullable":false},{"name":"status","type":"string","description":"Operational availability label (in stock, low stock, out of stock, backorder, preorder).","nullable":false},{"name":"low_stock_alerted","type":"boolean","description":"Whether a low-stock alert has been sent at or below threshold.","nullable":false},{"name":"last_restocked_at","type":"datetime","description":"Timestamp of last inbound restock application.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for logical removal.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_sku_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","updated_at"]},{"fieldNames":["status"]},{"fieldNames":["low_stock_alerted","updated_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_inventory_transactions","description":"Append-only stock movement history per {@link shopping_mall_ai_skus}. Records reasoned deltas (sale, replenishment, correction, write-off, restock, return, exchange), optional linkage to order items and product snapshot for evidence, and before/after balances for audit and reconciliation.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Affected SKU's {@link shopping_mall_ai_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id","onDelete":"Restrict"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_item_id","type":"uuid","description":"Optional linked order item's {@link shopping_mall_ai_order_items.id} that produced the movement.","relation":{"name":"orderItem","targetModel":"shopping_mall_ai_order_items","targetField":"id","onDelete":"NoAction"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Optional related product snapshot's {@link shopping_mall_ai_product_snapshots.id} for evidence at time of movement.","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id","onDelete":"NoAction"},"unique":false,"nullable":true}],"plainFields":[{"name":"movement_type","type":"string","description":"Business movement category (sale, replenishment, correction, write_off, restock, return, exchange).","nullable":false},{"name":"quantity_delta","type":"int","description":"Signed quantity change applied to on-hand balance (negative for decrements).","nullable":false},{"name":"balance_after","type":"int","description":"Resulting on-hand balance immediately after applying this transaction.","nullable":false},{"name":"reason_code","type":"string","description":"Optional business reason code used for analytics and audit.","nullable":true},{"name":"notes","type":"string","description":"Optional free-form note for reconciliation context.","nullable":true},{"name":"actor_role","type":"string","description":"Role of the actor performing the movement (e.g., sellerManager, systemAdmin, automation).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp of this immutable movement record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Technical update timestamp (normally unchanged for immutable records).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","created_at"]},{"fieldNames":["shopping_mall_ai_order_item_id","created_at"]},{"fieldNames":["movement_type","created_at"]},{"fieldNames":["shopping_mall_ai_sku_id","movement_type","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_inventory_threshold_alerts","description":"Alert events emitted when inventory levels breach configured thresholds (e.g., low stock, out of stock) for a given level record. Supports notification, resolution tracking, and SLA analytics. Belongs to {@link shopping_mall_ai_inventory_levels}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_inventory_level_id","type":"uuid","description":"Target inventory level's {@link shopping_mall_ai_inventory_levels.id}.","relation":{"name":"inventoryLevel","targetModel":"shopping_mall_ai_inventory_levels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"threshold_type","type":"string","description":"Type of threshold event (low_stock, out_of_stock, restocked, custom policy code).","nullable":false},{"name":"observed_quantity","type":"int","description":"Observed quantity (typically on-hand) at time of event.","nullable":false},{"name":"triggered_at","type":"datetime","description":"Timestamp when the threshold was detected.","nullable":false},{"name":"notified","type":"boolean","description":"Whether notifications were emitted for this alert.","nullable":false},{"name":"resolved_at","type":"datetime","description":"When the alert condition was cleared/resolved.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_inventory_level_id","triggered_at"]},{"fieldNames":["threshold_type","triggered_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_serial_numbers","description":"Serial number registry tied to {@link shopping_mall_ai_skus} for serialized item governance. Tracks lifecycle from available to allocated, sold, returned, or quarantined, optionally linked to an order item for traceability.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Parent SKU's {@link shopping_mall_ai_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_item_id","type":"uuid","description":"Optional related order item's {@link shopping_mall_ai_order_items.id} for allocation/sale linkage.","relation":{"name":"orderItem","targetModel":"shopping_mall_ai_order_items","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"serial_code","type":"string","description":"Manufacturer or platform-assigned serial code. Unique per SKU.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (available, allocated, sold, returned, quarantined).","nullable":false},{"name":"quality_status","type":"string","description":"Optional quality indicator (e.g., new, refurbished, failed-inspection).","nullable":true},{"name":"allocated_at","type":"datetime","description":"When the serial was allocated to an order or operation.","nullable":true},{"name":"sold_at","type":"datetime","description":"When the serial was marked as sold (typically payment/shipment event).","nullable":true},{"name":"returned_at","type":"datetime","description":"When the serial was returned and inspected.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp, if the serial is retired or removed from active pools.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","serial_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","status"]},{"fieldNames":["shopping_mall_ai_order_item_id","status"]}],"ginIndexes":[{"fieldName":"serial_code"}]},{"name":"shopping_mall_ai_lot_batches","description":"Lot/Batch records for SKUs with expiry or batch governance. Tracks lot code, received and expiry dates, and current on-hand and reserved quantities for FEFO/FIFO policies and compliance. Tied to {@link shopping_mall_ai_skus}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Parent SKU's {@link shopping_mall_ai_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"lot_code","type":"string","description":"Business lot/batch identifier unique per SKU.","nullable":false},{"name":"quantity_on_hand","type":"int","description":"Current on-hand quantity in this lot.","nullable":false},{"name":"reserved_quantity","type":"int","description":"Reserved quantity associated with open orders or holds.","nullable":false},{"name":"received_at","type":"datetime","description":"When the lot was received or first recorded.","nullable":false},{"name":"expires_at","type":"datetime","description":"Optional expiry date; used for FEFO/expiry policies.","nullable":true},{"name":"status","type":"string","description":"Operational state of the lot (available, quarantined, expired, consumed).","nullable":false},{"name":"blocked","type":"boolean","description":"Whether this lot is blocked from allocation (e.g., QA hold, legal hold).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retired lots.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","lot_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_sku_id","expires_at"]},{"fieldNames":["shopping_mall_ai_sku_id","status"]}],"ginIndexes":[{"fieldName":"lot_code"}]}]},{"filename":"schema-09-carts.prisma","namespace":"Carts","models":[{"name":"shopping_mall_ai_carts","description":"Shopping carts scoped to a single channel and optionally owned by a customer. Supports guest carts (via guest_token), expiration/recovery windows, and checkout locks. Captures per-connection evidence (IP, access URL, referrer, user agent). Historical carts must be retained; uniqueness across (channel_id, customer_id) is enforced in application logic (single active cart) rather than a global DB unique constraint. Related evidence in {@link shopping_mall_ai_cart_deletion_logs}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Belonged channel's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Owning customer's {@link shopping_mall_ai_customers.id}. Nullable for guest carts.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"guest_token","type":"string","description":"Opaque identifier for a guest cart within a channel. Used for resume/merge flows.","nullable":true},{"name":"status","type":"string","description":"Lifecycle state of the cart (e.g., active, expired, locked). Used for workflows and visibility.","nullable":false},{"name":"cart_type","type":"string","description":"Cart ownership type: guest or member.","nullable":false},{"name":"ip","type":"string","description":"Origin IP address at cart creation/update for evidence and anti-abuse analytics.","nullable":true},{"name":"access_url","type":"uri","description":"Access URL at creation (evidence).","nullable":true},{"name":"referrer","type":"uri","description":"HTTP referrer at creation (evidence).","nullable":true},{"name":"user_agent","type":"string","description":"User agent fingerprint for session/evidence correlation.","nullable":true},{"name":"expires_at","type":"datetime","description":"Expiration time after inactivity per channel policy.","nullable":true},{"name":"recoverable_until_at","type":"datetime","description":"Recovery window end time for restoring expired carts per policy.","nullable":true},{"name":"locked_for_checkout","type":"boolean","description":"Whether the cart is currently locked for checkout (items cannot be edited).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","guest_token"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status","updated_at"]},{"fieldNames":["shopping_mall_ai_customer_id","updated_at"]},{"fieldNames":["shopping_mall_ai_channel_id","shopping_mall_ai_customer_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_cart_items","description":"Individual cart lines bound to a specific {@link shopping_mall_ai_product_snapshots} and optionally a {@link shopping_mall_ai_skus} for inventory-at-configuration granularity. Item-level locking supports checkout flows. Stored unit price reflects the snapshot pricing at add/update time for evidence.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_cart_id","type":"uuid","description":"Parent cart's {@link shopping_mall_ai_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_ai_carts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Bound product snapshot at selection time. {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_sku_id","type":"uuid","description":"Resolved SKU (final configuration) when options affect inventory. {@link shopping_mall_ai_skus.id}","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"quantity","type":"int","description":"Requested quantity of the item.","nullable":false},{"name":"unit_price","type":"double","description":"Unit price at add/update time based on snapshot pricing rules (not a derived aggregate).","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code used for pricing at the time of add/update.","nullable":false},{"name":"locked_for_checkout","type":"boolean","description":"Whether this item is currently locked for checkout.","nullable":false},{"name":"locked_at","type":"datetime","description":"Timestamp when the item was locked for checkout.","nullable":true},{"name":"recalculated_at","type":"datetime","description":"Timestamp of last successful revalidation/recalculation after changes.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_sku_id"]},{"fieldNames":["shopping_mall_ai_cart_id","created_at"]},{"fieldNames":["shopping_mall_ai_product_snapshot_id","created_at"]},{"fieldNames":["shopping_mall_ai_cart_id","shopping_mall_ai_product_snapshot_id","shopping_mall_ai_sku_id"]},{"fieldNames":["shopping_mall_ai_cart_id","locked_for_checkout"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_cart_item_options","description":"Selected option values for a cart item. Each record binds one {@link shopping_mall_ai_options} definition to the concrete value chosen, preserving ordering for deterministic configuration resolution and evidence.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_cart_item_id","type":"uuid","description":"Parent cart item's {@link shopping_mall_ai_cart_items.id}","relation":{"name":"cartItem","targetModel":"shopping_mall_ai_cart_items","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_option_id","type":"uuid","description":"Selected option definition. {@link shopping_mall_ai_options.id}","relation":{"name":"option","targetModel":"shopping_mall_ai_options","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"value","type":"string","description":"Chosen value key or literal (for numeric/string types) corresponding to the defined option.","nullable":false},{"name":"sequence","type":"int","description":"Presentation/processing order among selected options for the item.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_cart_item_id","shopping_mall_ai_option_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_cart_item_id","sequence"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_cart_validation_issues","description":"Deterministic validation outcomes captured at cart- or item-level to explain denials and preserve evidence. Links to {@link shopping_mall_ai_carts} and optionally {@link shopping_mall_ai_cart_items}. Useful for policy/error analytics and customer support workflows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_cart_id","type":"uuid","description":"Related cart's {@link shopping_mall_ai_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_ai_carts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_cart_item_id","type":"uuid","description":"Related cart item's {@link shopping_mall_ai_cart_items.id} (null for cart-level issues).","relation":{"name":"cartItem","targetModel":"shopping_mall_ai_cart_items","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"violation_code","type":"string","description":"Business error identifier (e.g., OPT_REQUIRED_MISSING, OPT_INVALID_COMBINATION, INV_INSUFFICIENT_STOCK).","nullable":false},{"name":"message","type":"string","description":"Human-readable explanation suitable for localization.","nullable":false},{"name":"resolved","type":"boolean","description":"Whether the issue has been resolved after corrective actions.","nullable":false},{"name":"resolved_at","type":"datetime","description":"Timestamp when resolved (if applicable).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_cart_id","created_at"]},{"fieldNames":["shopping_mall_ai_cart_item_id","created_at"]},{"fieldNames":["violation_code","created_at"]},{"fieldNames":["shopping_mall_ai_cart_id","resolved","created_at"]}],"ginIndexes":[{"fieldName":"message"}]},{"name":"shopping_mall_ai_cart_templates","description":"Cart composition templates authored by sellers/admins per channel for campaigns or onboarding. Enforces unique code per channel, lifecycle status (Draft/Active/Paused/Retired), optional audience targeting, and activation windows. Items are defined in {@link shopping_mall_ai_cart_template_items}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel where the template is valid. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Owning seller when authored by a merchant (nullable for channel/platform templates). {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique template code within the channel for stable references.","nullable":false},{"name":"name","type":"string","description":"Human-readable template name for back-office search and governance.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (Draft, Active, Paused, Retired).","nullable":false},{"name":"valid_from","type":"datetime","description":"Activation start time (channel-local policy).","nullable":true},{"name":"valid_to","type":"datetime","description":"Activation end time (channel-local policy).","nullable":true},{"name":"audience_segment","type":"string","description":"Optional audience/segment label when targeting is enabled.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_seller_id"]},{"fieldNames":["shopping_mall_ai_channel_id","status","valid_from"]},{"fieldNames":["shopping_mall_ai_channel_id","status","valid_to"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_cart_template_items","description":"Lines composing a cart template. May bind directly to a {@link shopping_mall_ai_product_snapshots} (publication-time binding) or to a {@link shopping_mall_ai_products} with snapshot binding deferred to application time. Quantity rules (required/min/max) and ordering supported.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_cart_template_id","type":"uuid","description":"Parent template's {@link shopping_mall_ai_cart_templates.id}","relation":{"name":"template","targetModel":"shopping_mall_ai_cart_templates","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Bound product snapshot at publication (nullable if binding at application). {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Base product reference when snapshot binding is deferred to apply-time. {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"bind_snapshot_at_application","type":"boolean","description":"Whether to bind snapshot at application time (true) vs at publication (false).","nullable":false},{"name":"is_required","type":"boolean","description":"Whether this line is required for template application.","nullable":false},{"name":"default_qty","type":"int","description":"Default quantity to add when the template is applied.","nullable":false},{"name":"min_qty","type":"int","description":"Minimum allowed quantity when configurable by customer.","nullable":true},{"name":"max_qty","type":"int","description":"Maximum allowed quantity when configurable by customer.","nullable":true},{"name":"sequence","type":"int","description":"Ordering within the template.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_cart_template_id","sequence"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_cart_template_id","shopping_mall_ai_product_id"]},{"fieldNames":["shopping_mall_ai_cart_template_id","shopping_mall_ai_product_snapshot_id"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_cart_deletion_logs","description":"Append-only evidence of cart deletions including actor role, optional customer linkage, reason, and deletion timestamp. Supports legal/audit discovery and read-only analytics. References {@link shopping_mall_ai_carts} and optionally {@link shopping_mall_ai_customers}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_cart_id","type":"uuid","description":"Deleted cart's {@link shopping_mall_ai_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_ai_carts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Actor customer if the deletion was performed by the owner (nullable; admins may also delete). {@link shopping_mall_ai_customers.id}","relation":{"name":"actorCustomer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"actor_role","type":"string","description":"Business role of the actor at deletion time (e.g., customer, supportAgent, systemAdmin).","nullable":false},{"name":"reason","type":"string","description":"Optional human-readable reason for deletion, suitable for audit evidence.","nullable":true},{"name":"deleted_at","type":"datetime","description":"Timestamp of the deletion event.","nullable":false},{"name":"created_at","type":"datetime","description":"Log creation timestamp (evidence record time).","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_cart_id","deleted_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-10-orders.prisma","namespace":"Orders","models":[{"name":"shopping_mall_ai_orders","description":"Orders represent customer purchase applications and, upon payment confirmation, become confirmed orders ready for fulfillment. Each order is scoped to a channel and linked to the customer and (optionally) the source cart. Business totals are captured as raw transactional facts and not re-computed post-confirmation. Related entities: {@link shopping_mall_ai_order_items}, {@link shopping_mall_ai_shipments}, and historical transitions in {@link shopping_mall_ai_order_histories}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"channel_id","type":"uuid","description":"Belonged channel's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"customer_id","type":"uuid","description":"Owning customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"cart_id","type":"uuid","description":"Source cart (if converted) {@link shopping_mall_ai_carts.id}","relation":{"name":"cart","targetModel":"shopping_mall_ai_carts"},"unique":true,"nullable":true},{"name":"shipping_address_id","type":"uuid","description":"Shipping address used at order time {@link shopping_mall_ai_addresses.id}","relation":{"name":"shippingAddress","targetModel":"shopping_mall_ai_addresses","mappingName":"shopping_mall_ai_orders_of_shipping_address_id"},"unique":false,"nullable":true},{"name":"billing_address_id","type":"uuid","description":"Billing address used at order time {@link shopping_mall_ai_addresses.id}","relation":{"name":"billingAddress","targetModel":"shopping_mall_ai_addresses","mappingName":"shopping_mall_ai_orders_of_billing_address_id"},"unique":false,"nullable":true}],"plainFields":[{"name":"order_number","type":"string","description":"Business-visible order number unique within a channel.","nullable":false},{"name":"status","type":"string","description":"Order lifecycle status (e.g., pending_payment, partially_confirmed, confirmed, cancelled, expired).","nullable":false},{"name":"currency_code","type":"string","description":"ISO currency code used for the order amounts.","nullable":false},{"name":"subtotal_amount","type":"double","description":"Subtotal of items before discounts and taxes.","nullable":false},{"name":"discount_total_amount","type":"double","description":"Total discount applied across the order.","nullable":false},{"name":"tax_total_amount","type":"double","description":"Total tax amount for the order.","nullable":false},{"name":"shipping_total_amount","type":"double","description":"Total shipping charge for the order.","nullable":false},{"name":"payable_total_amount","type":"double","description":"Total amount payable after discounts and taxes.","nullable":false},{"name":"application_placed_at","type":"datetime","description":"Timestamp when order application was created.","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Timestamp when the order became fully confirmed. Null if not fully confirmed.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Timestamp when the order was cancelled, if applicable.","nullable":true},{"name":"expired_at","type":"datetime","description":"Timestamp when the order application expired due to payment window lapse, if applicable.","nullable":true},{"name":"customer_note","type":"string","description":"Optional note from customer to seller or fulfillment.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability and evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["cart_id"],"unique":true},{"fieldNames":["channel_id","order_number"],"unique":true}],"plainIndexes":[{"fieldNames":["shipping_address_id"]},{"fieldNames":["billing_address_id"]},{"fieldNames":["customer_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["order_number"]},{"fieldNames":["customer_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_order_histories","description":"Append-only audit trail capturing significant changes to an order with before/after state, actor, and reason. Used for evidence and dispute handling. References {@link shopping_mall_ai_orders}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Target order's {@link shopping_mall_ai_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"change_type","type":"string","description":"Classification of change (e.g., state, totals, address, policy_hold).","nullable":false},{"name":"state_before","type":"string","description":"Serialized state or key value before change, if applicable.","nullable":true},{"name":"state_after","type":"string","description":"Serialized state or key value after change, if applicable.","nullable":true},{"name":"reason","type":"string","description":"Optional reason code or human-readable note for the transition.","nullable":true},{"name":"actor_role","type":"string","description":"Role of the actor who initiated the change (e.g., customer, seller, supportAgent, system).","nullable":false},{"name":"actor_user_id","type":"uuid","description":"Optional actor user identifier for traceability (no FK to preserve append-only nature).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp of the history event.","nullable":false}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_order_items","description":"Order line items bound to product snapshots and optionally to concrete SKUs for option-combination specificity. Each item stores raw monetary facts (unit price, taxes, discounts) and lifecycle timestamps. References {@link shopping_mall_ai_orders}, {@link shopping_mall_ai_product_snapshots}, {@link shopping_mall_ai_skus}, and {@link shopping_mall_ai_sellers}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Parent order's {@link shopping_mall_ai_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"product_snapshot_id","type":"uuid","description":"Bound product snapshot at purchase time {@link shopping_mall_ai_product_snapshots.id}.","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id"},"unique":false,"nullable":false},{"name":"sku_id","type":"uuid","description":"Resolved SKU (final configuration) if applicable {@link shopping_mall_ai_skus.id}.","relation":{"name":"sku","targetModel":"shopping_mall_ai_skus","targetField":"id"},"unique":false,"nullable":true},{"name":"seller_id","type":"uuid","description":"Owning seller's {@link shopping_mall_ai_sellers.id}.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"item_number","type":"int","description":"Sequential line number within the order (starts at 1).","nullable":false},{"name":"quantity","type":"int","description":"Ordered quantity for this item.","nullable":false},{"name":"unit_price_amount","type":"double","description":"Item unit price at application (in order currency).","nullable":false},{"name":"currency_code","type":"string","description":"ISO currency code for this item line amounts.","nullable":false},{"name":"discount_amount","type":"double","description":"Discount applied to this line item.","nullable":false},{"name":"tax_amount","type":"double","description":"Tax amount for this line item.","nullable":false},{"name":"total_amount","type":"double","description":"Extended line total (unit_price * quantity - discounts + taxes).","nullable":false},{"name":"status","type":"string","description":"Item lifecycle status (e.g., pending_payment, confirmed, preparing, manufacturing, shipping, delivered, completed, cancelled).","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Timestamp when this item became confirmed (covered by payment).","nullable":true},{"name":"delivered_at","type":"datetime","description":"Timestamp when this item was delivered (completed or start of A/S window).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_id","item_number"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id","status"]},{"fieldNames":["seller_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_order_item_allocations","description":"Allocations connect order items to planned/committed fulfillment units (e.g., shipments). They enable split shipments and granular tracking of how quantities are assigned. References {@link shopping_mall_ai_order_items} and optionally {@link shopping_mall_ai_shipments}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_item_id","type":"uuid","description":"Allocated order item's {@link shopping_mall_ai_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_ai_order_items","targetField":"id"},"unique":false,"nullable":false},{"name":"shipment_id","type":"uuid","description":"Associated shipment when committed {@link shopping_mall_ai_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_ai_shipments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"quantity","type":"int","description":"Allocated quantity from the order item.","nullable":false},{"name":"allocation_status","type":"string","description":"Allocation state (e.g., planned, committed, released).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["order_item_id","created_at"]},{"fieldNames":["shipment_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_shipments","description":"Shipments represent physical fulfillment units for an order. Track carrier, tracking number, status, and milestone timestamps. A shipment belongs to one order and may include multiple order items via {@link shopping_mall_ai_shipment_items}. Delivery stages are recorded in {@link shopping_mall_ai_delivery_stages} and exceptions in {@link shopping_mall_ai_delivery_exceptions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"order_id","type":"uuid","description":"Parent order's {@link shopping_mall_ai_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":false},{"name":"shipping_address_id","type":"uuid","description":"Destination shipping address {@link shopping_mall_ai_addresses.id}.","relation":{"name":"shippingAddress","targetModel":"shopping_mall_ai_addresses","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"carrier","type":"string","description":"Carrier name for the shipment.","nullable":false},{"name":"tracking_number","type":"string","description":"Tracking number assigned by carrier (may be null if not yet available).","nullable":true},{"name":"status","type":"string","description":"Shipment status (e.g., preparation, manufacturing, shipping, delivered).","nullable":false},{"name":"shipped_at","type":"datetime","description":"Timestamp when shipment left origin.","nullable":true},{"name":"delivered_at","type":"datetime","description":"Timestamp when shipment was delivered.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["order_id","tracking_number"],"unique":true}],"plainIndexes":[{"fieldNames":["order_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"tracking_number"}]},{"name":"shopping_mall_ai_shipment_items","description":"Junction table linking shipments to order items with quantities. Ensures traceability of which items and amounts were included in each shipment. References {@link shopping_mall_ai_shipments} and {@link shopping_mall_ai_order_items}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shipment_id","type":"uuid","description":"Belonged shipment's {@link shopping_mall_ai_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_ai_shipments","targetField":"id"},"unique":false,"nullable":false},{"name":"order_item_id","type":"uuid","description":"Linked order item's {@link shopping_mall_ai_order_items.id}.","relation":{"name":"orderItem","targetModel":"shopping_mall_ai_order_items","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"quantity","type":"int","description":"Quantity of the order item included in the shipment.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shipment_id","order_item_id"],"unique":true}],"plainIndexes":[],"ginIndexes":[]},{"name":"shopping_mall_ai_delivery_stages","description":"Per-shipment delivery stage events with timestamps and actor context. Captures transitions such as preparation, manufacturing, shipping, and delivered with start/end times. References {@link shopping_mall_ai_shipments}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shipment_id","type":"uuid","description":"Target shipment's {@link shopping_mall_ai_shipments.id}","relation":{"name":"shipment","targetModel":"shopping_mall_ai_shipments"},"unique":false,"nullable":false}],"plainFields":[{"name":"stage","type":"string","description":"Stage name (e.g., preparation, manufacturing, shipping, delivered).","nullable":false},{"name":"started_at","type":"datetime","description":"Stage start timestamp.","nullable":false},{"name":"completed_at","type":"datetime","description":"Stage completion timestamp, if finished.","nullable":true},{"name":"actor_role","type":"string","description":"Role of the actor who registered the stage (e.g., seller, supportAgent, system).","nullable":false},{"name":"notes","type":"string","description":"Optional notes for this stage event.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shipment_id","stage","started_at"],"unique":true}],"plainIndexes":[{"fieldNames":["shipment_id","started_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_delivery_exceptions","description":"Shipment exception events such as delays, loss, damage, customs holds, and reroutes. Optionally scoped to a specific shipment item. Used for SLA tracking and customer communications. References {@link shopping_mall_ai_shipments} and optionally {@link shopping_mall_ai_shipment_items}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shipment_id","type":"uuid","description":"Affected shipment's {@link shopping_mall_ai_shipments.id}.","relation":{"name":"shipment","targetModel":"shopping_mall_ai_shipments","targetField":"id"},"unique":false,"nullable":false},{"name":"shipment_item_id","type":"uuid","description":"Affected shipment item's {@link shopping_mall_ai_shipment_items.id}, if applicable.","relation":{"name":"shipmentItem","targetModel":"shopping_mall_ai_shipment_items","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Business exception code (e.g., delay, lost, damaged, customs_hold).","nullable":false},{"name":"description","type":"string","description":"Human-readable description of the exception.","nullable":true},{"name":"occurred_at","type":"datetime","description":"When the exception occurred.","nullable":false},{"name":"resolved_at","type":"datetime","description":"When the exception was resolved, if applicable.","nullable":true},{"name":"resolution_notes","type":"string","description":"Notes about how the exception was resolved.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shipment_id","occurred_at"]},{"fieldNames":["code","occurred_at"]}],"ginIndexes":[]}]},{"filename":"schema-11-payments.prisma","namespace":"Payments","models":[{"name":"shopping_mall_ai_payments","description":"Payment application entity representing a single attempt to pay for an order application. Tracks lifecycle state (intent → initiated → authorized/approved → pending_async → partially_confirmed/confirmed → failed/cancelled/expired), legal completion timestamp, channel scope, and customer/order references. Primary record for finance reporting with breakdowns in {@link shopping_mall_ai_payment_allocations} and provider events in {@link shopping_mall_ai_payment_transactions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_order_id","type":"uuid","description":"Related order application's {@link shopping_mall_ai_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_ai_orders"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Payer customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Canonical payment state (e.g., payment_intent_created, initiated, authorized_or_approved, pending_async, partially_confirmed, confirmed, failed, cancelled, expired).","nullable":false},{"name":"method_type","type":"string","description":"High-level method class (e.g., card, virtual_account, bank_transfer, wallet).","nullable":false},{"name":"currency","type":"string","description":"ISO currency code used for the payment application.","nullable":false},{"name":"amount_payable","type":"double","description":"Total amount requested to be covered by this payment after discounts/stored values.","nullable":false},{"name":"amount_confirmed","type":"double","description":"Cumulative amount confirmed across all legs; equals amount_payable when fully confirmed.","nullable":false},{"name":"idempotency_key","type":"string","description":"Client-provided idempotency key to deduplicate application attempts within a channel.","nullable":false},{"name":"intent_created_at","type":"datetime","description":"Timestamp when payment intent/application was created.","nullable":false},{"name":"initiated_at","type":"datetime","description":"When the user initiated the payment flow (if different from intent).","nullable":true},{"name":"authorized_or_approved_at","type":"datetime","description":"Approval/authorization timestamp for synchronous methods (non-final).","nullable":true},{"name":"pending_async_until","type":"datetime","description":"Expiration timestamp for asynchronous payment instructions.","nullable":true},{"name":"partially_confirmed_at","type":"datetime","description":"First time when partial confirmation occurred (mixed tender or partial capture).","nullable":true},{"name":"confirmed_at","type":"datetime","description":"Timestamp when the payable amount became fully covered and legally confirmed.","nullable":true},{"name":"failed_at","type":"datetime","description":"Failure timestamp if the payment attempt failed.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Cancellation timestamp when cancelled pre-confirmation by policy.","nullable":true},{"name":"expired_at","type":"datetime","description":"Expiration timestamp for asynchronous methods when instructions elapsed without match.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_order_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["shopping_mall_ai_order_id","status"]},{"fieldNames":["method_type","status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_payment_allocations","description":"Breakdown (legs) of a payment into distinct components such as cash-equivalent, deposit, and mileage. Supports partial confirmations by recording amounts per type and lifecycle timestamps. Subsidiary to {@link shopping_mall_ai_payments}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_payment_id","type":"uuid","description":"Parent payment's {@link shopping_mall_ai_payments.id}.","relation":{"name":"payment","targetModel":"shopping_mall_ai_payments","targetFieldName":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"type","type":"string","description":"Allocation type label (e.g., cash, deposit, mileage).","nullable":false},{"name":"amount","type":"double","description":"Amount of this allocation leg in the payment currency.","nullable":false},{"name":"currency","type":"string","description":"ISO currency code for this leg (usually same as payment currency).","nullable":false},{"name":"status","type":"string","description":"Allocation lifecycle status (e.g., pending, confirmed, cancelled).","nullable":false},{"name":"confirmed_at","type":"datetime","description":"Time when this leg was confirmed and funds became final.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Time when this leg was cancelled pre-confirmation.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_payment_id","created_at"]},{"fieldNames":["type","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_payment_transactions","description":"Provider-facing transaction records (per attempt/leg) including gateway provider, method, external transaction reference, status and event timestamps. Used for reconciliation and audit. Links to parent {@link shopping_mall_ai_payments}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_payment_id","type":"uuid","description":"Parent payment's {@link shopping_mall_ai_payments.id}","relation":{"name":"payment","targetModel":"shopping_mall_ai_payments"},"unique":false,"nullable":false}],"plainFields":[{"name":"gateway_provider","type":"string","description":"Business identifier of the payment gateway/provider handling this transaction.","nullable":false},{"name":"method","type":"string","description":"Concrete payment method label within the provider (e.g., visa, bank_transfer, virtual_account).","nullable":false},{"name":"transaction_reference","type":"string","description":"Provider transaction reference or ID used for reconciliation.","nullable":false},{"name":"amount","type":"double","description":"Amount associated with this provider transaction (may be a partial capture).","nullable":false},{"name":"currency","type":"string","description":"ISO currency code for this transaction.","nullable":false},{"name":"status","type":"string","description":"Transaction state (e.g., initiated, authorized, pending_async, confirmed, failed, cancelled, expired).","nullable":false},{"name":"approved_at","type":"datetime","description":"Timestamp when the transaction received authorization/approval (if applicable).","nullable":true},{"name":"confirmed_at","type":"datetime","description":"Timestamp when the transaction was confirmed/settled.","nullable":true},{"name":"failed_at","type":"datetime","description":"Timestamp when the transaction failed.","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Timestamp when the transaction was cancelled.","nullable":true},{"name":"expired_at","type":"datetime","description":"Timestamp when asynchronous instruction expired without matching funds.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key at provider call boundary (to deduplicate provider-side attempts).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["gateway_provider","transaction_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_payment_id","created_at"]},{"fieldNames":["status","created_at"]},{"fieldNames":["gateway_provider","status","created_at"]}],"ginIndexes":[{"fieldName":"transaction_reference"},{"fieldName":"gateway_provider"}]},{"name":"shopping_mall_ai_payment_cancellations","description":"Cancellation requests/executions occurring before payment confirmation. Captures requester/approver role context, reasons, and timestamps. Attached to {@link shopping_mall_ai_payments}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_payment_id","type":"uuid","description":"Target payment's {@link shopping_mall_ai_payments.id}","relation":{"name":"payment","targetModel":"shopping_mall_ai_payments"},"unique":false,"nullable":false}],"plainFields":[{"name":"reason_code","type":"string","description":"Categorized business reason (e.g., user_request, risk_hold, duplicate_attempt).","nullable":false},{"name":"reason","type":"string","description":"Human-readable explanation for cancellation.","nullable":true},{"name":"requested_by_role","type":"string","description":"Role of the requester (e.g., customer, supportAgent, financeManager).","nullable":false},{"name":"requested_at","type":"datetime","description":"When cancellation was requested.","nullable":false},{"name":"approved_by_role","type":"string","description":"Role of the approver when policy requires approval.","nullable":true},{"name":"approved_at","type":"datetime","description":"When cancellation was approved (if applicable).","nullable":true},{"name":"completed_at","type":"datetime","description":"When cancellation was completed and reflected in business state.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_payment_id","requested_at"]},{"fieldNames":["reason_code","requested_at"]},{"fieldNames":["shopping_mall_ai_payment_id","completed_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_reconciliation_discrepancies","description":"Finance-managed discrepancy records created during daily reconciliation between platform records and provider statements. Captures category (amount_mismatch, duplicate, late_receipt), expected vs actual values, and resolution outcome. Linked to {@link shopping_mall_ai_payment_transactions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_payment_transaction_id","type":"uuid","description":"Related transaction's {@link shopping_mall_ai_payment_transactions.id}.","relation":{"name":"paymentTransaction","targetModel":"shopping_mall_ai_payment_transactions","targetFieldName":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"category","type":"string","description":"Discrepancy category (e.g., amount_mismatch, duplicate, late_receipt, fx_mismatch).","nullable":false},{"name":"expected_amount","type":"double","description":"Expected amount per platform records.","nullable":false},{"name":"actual_amount","type":"double","description":"Actual amount per provider statement.","nullable":false},{"name":"expected_currency","type":"string","description":"Currency code of expected amount.","nullable":false},{"name":"actual_currency","type":"string","description":"Currency code of actual amount.","nullable":false},{"name":"occurred_at","type":"datetime","description":"Business timestamp when the discrepancy pertains to (e.g., provider settlement time).","nullable":false},{"name":"resolved","type":"boolean","description":"Whether the discrepancy has been resolved.","nullable":false},{"name":"resolved_at","type":"datetime","description":"When the discrepancy was resolved.","nullable":true},{"name":"resolution_note","type":"string","description":"Free-form resolution notes and references.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_payment_transaction_id","occurred_at"]},{"fieldNames":["category","occurred_at"]},{"fieldNames":["resolved","resolved_at"]}],"ginIndexes":[{"fieldName":"resolution_note"}]},{"name":"shopping_mall_ai_disputes","description":"Chargeback/dispute case tied to a payment transaction. Stores dispute reference, reasons, amounts, lifecycle timestamps, and outcomes for audit and reporting. Often referenced by finance and auditors independently from payments.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_payment_transaction_id","type":"uuid","description":"Related transaction's {@link shopping_mall_ai_payment_transactions.id}.","relation":{"name":"paymentTransaction","targetModel":"shopping_mall_ai_payment_transactions","targetFieldName":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"dispute_reference","type":"string","description":"External dispute/chargeback reference identifier.","nullable":false},{"name":"reason_code","type":"string","description":"Scheme/provider reason code explaining the dispute.","nullable":false},{"name":"opened_at","type":"datetime","description":"When the dispute was opened.","nullable":false},{"name":"outcome","type":"string","description":"Final outcome (e.g., won, lost, write_off) when resolved.","nullable":true},{"name":"outcome_at","type":"datetime","description":"When the dispute outcome was finalized.","nullable":true},{"name":"amount","type":"double","description":"Disputed amount (may be partial).","nullable":true},{"name":"currency","type":"string","description":"Currency code for the disputed amount.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention and evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["dispute_reference"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_payment_transaction_id","opened_at"]},{"fieldNames":["outcome","outcome_at"]}],"ginIndexes":[{"fieldName":"reason_code"}]}]},{"filename":"schema-12-coupons.prisma","namespace":"Coupons","models":[{"name":"shopping_mall_ai_coupons","description":"Master entity for discount coupons. Represents business definition, lifecycle, and governance including exclusivity/stacking rules and validity windows. A coupon may be scoped to a specific {@link shopping_mall_ai_channels} and optionally to a {@link shopping_mall_ai_sellers} issuer. Scope rules are expressed in {@link shopping_mall_ai_coupon_conditions}. Issued tickets are tracked in {@link shopping_mall_ai_coupon_tickets}; private one-time codes in {@link shopping_mall_ai_one_time_coupon_codes}. Actual applications are recorded in {@link shopping_mall_ai_coupon_redemptions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional scope's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Issuing seller's {@link shopping_mall_ai_sellers.id} when seller-scoped.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Human-entered coupon code for public redemption. Unique per channel. Nullable for non-code coupons (e.g., tickets-only).","nullable":true},{"name":"name","type":"string","description":"Display name/title of the coupon.","nullable":false},{"name":"description","type":"string","description":"Detailed description or policy notes for the coupon.","nullable":true},{"name":"type","type":"string","description":"Discount type label: expected values are [\"amount\", \"percentage\"].","nullable":false},{"name":"amount","type":"double","description":"Fixed discount amount in order currency when type=amount.","nullable":true},{"name":"percentage","type":"double","description":"Percentage discount (0–100) when type=percentage.","nullable":true},{"name":"max_discount_amount","type":"double","description":"Maximum discount amount cap (applies primarily to percentage coupons).","nullable":true},{"name":"min_order_amount","type":"double","description":"Minimum eligible order amount for applying the coupon.","nullable":true},{"name":"exclusive","type":"boolean","description":"Whether this coupon is exclusive (disallows stacking with other coupons).","nullable":false},{"name":"stackable","type":"boolean","description":"Whether this coupon can stack with other coupons (ignored when exclusive=true).","nullable":false},{"name":"status","type":"string","description":"Lifecycle status label such as draft, active, disabled, archived.","nullable":false},{"name":"valid_from","type":"datetime","description":"Start of validity window (channel-local policy).","nullable":true},{"name":"valid_to","type":"datetime","description":"End of validity window (channel-local policy).","nullable":true},{"name":"issuance_quantity","type":"int","description":"Total issuance quantity cap for tickets/codes.","nullable":true},{"name":"per_user_limit","type":"int","description":"Maximum number of times a single customer can use this coupon.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status","valid_from"]},{"fieldNames":["shopping_mall_ai_seller_id","status"]},{"fieldNames":["valid_to"]},{"fieldNames":["status","valid_from","valid_to"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_coupon_conditions","description":"Supporting rules that define scope and eligibility of a {@link shopping_mall_ai_coupons}. Each row represents a single include/exclude atom for a specific scope type (channel, section, seller, category, product). Managed through coupon flows and evaluated deterministically during application.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_coupon_id","type":"uuid","description":"Belonged coupon's {@link shopping_mall_ai_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_ai_coupons","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Target channel's {@link shopping_mall_ai_channels.id} when scope_type='channel'.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_section_id","type":"uuid","description":"Target section's {@link shopping_mall_ai_sections.id} when scope_type='section'.","relation":{"name":"section","targetModel":"shopping_mall_ai_sections","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Target seller's {@link shopping_mall_ai_sellers.id} when scope_type='seller'.","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_category_id","type":"uuid","description":"Target category's {@link shopping_mall_ai_categories.id} when scope_type='category'.","relation":{"name":"category","targetModel":"shopping_mall_ai_categories","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Target product's {@link shopping_mall_ai_products.id} when scope_type='product'.","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"scope_type","type":"string","description":"Scope of the condition. Expected values: [\"channel\",\"section\",\"seller\",\"category\",\"product\"].","nullable":false},{"name":"include","type":"boolean","description":"Whether this condition is an include (true) or an exclude (false) rule.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_coupon_id","scope_type","include","shopping_mall_ai_channel_id","shopping_mall_ai_section_id","shopping_mall_ai_seller_id","shopping_mall_ai_category_id","shopping_mall_ai_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_coupon_id","scope_type"]},{"fieldNames":["include","scope_type"]},{"fieldNames":["shopping_mall_ai_channel_id","shopping_mall_ai_section_id","shopping_mall_ai_seller_id","shopping_mall_ai_category_id","shopping_mall_ai_product_id"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_coupon_tickets","description":"Per-customer issuance records for {@link shopping_mall_ai_coupons}. Tickets represent assignable/activatable coupon instances with their own validity window and state. Redemptions that use tickets link from {@link shopping_mall_ai_coupon_redemptions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_coupon_id","type":"uuid","description":"Issued coupon's {@link shopping_mall_ai_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_ai_coupons","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context {@link shopping_mall_ai_channels.id} for policy and analytics.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"ticket_code","type":"string","description":"Unique ticket identifier visible to the customer (e.g., for QR or support lookup).","nullable":false},{"name":"status","type":"string","description":"Ticket lifecycle status such as issued, active, used, expired, revoked.","nullable":false},{"name":"valid_from","type":"datetime","description":"Ticket validity start (overrides coupon if narrower).","nullable":true},{"name":"valid_to","type":"datetime","description":"Ticket validity end (overrides coupon if narrower).","nullable":true},{"name":"used_at","type":"datetime","description":"Timestamp when this ticket was consumed by a redemption.","nullable":true},{"name":"revoked_at","type":"datetime","description":"Timestamp when this ticket was administratively revoked.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["ticket_code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id"]},{"fieldNames":["shopping_mall_ai_customer_id","status","valid_to"]},{"fieldNames":["shopping_mall_ai_coupon_id","status"]},{"fieldNames":["shopping_mall_ai_coupon_id","shopping_mall_ai_customer_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_one_time_coupon_codes","description":"Private one-time codes associated with a {@link shopping_mall_ai_coupons}. These are generated for restricted distribution and can be assigned and redeemed exactly once. Redemptions link from {@link shopping_mall_ai_coupon_redemptions}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_coupon_id","type":"uuid","description":"Belonged coupon's {@link shopping_mall_ai_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_ai_coupons","targetField":"id"},"unique":false,"nullable":false},{"name":"assigned_customer_id","type":"uuid","description":"Optionally assigned recipient {@link shopping_mall_ai_customers.id}.","relation":{"name":"assignedCustomer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"The one-time code string. Must be unique and used at most once.","nullable":false},{"name":"status","type":"string","description":"Lifecycle state of the code: issued, used, expired, revoked.","nullable":false},{"name":"redeemed_at","type":"datetime","description":"Timestamp when code was redeemed (if used).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_coupon_id","status"]},{"fieldNames":["shopping_mall_ai_channel_id","status"]},{"fieldNames":["assigned_customer_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_coupon_redemptions","description":"Immutable evidence records for the application of a {@link shopping_mall_ai_coupons} by a customer. Captures linkage to orders/carts, amounts, and timestamps for legal-grade audit. May reference a specific {@link shopping_mall_ai_coupon_tickets} or {@link shopping_mall_ai_one_time_coupon_codes}. Supports risk oversight via {@link shopping_mall_ai_coupon_risk_reviews}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_coupon_id","type":"uuid","description":"Applied coupon's {@link shopping_mall_ai_coupons.id}.","relation":{"name":"coupon","targetModel":"shopping_mall_ai_coupons","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Customer who redeemed the coupon {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_id","type":"uuid","description":"Target order application/confirmed order {@link shopping_mall_ai_orders.id}.","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_cart_id","type":"uuid","description":"Cart context when evaluated before conversion {@link shopping_mall_ai_carts.id}.","relation":{"name":"cart","targetModel":"shopping_mall_ai_carts","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_coupon_ticket_id","type":"uuid","description":"Optional ticket used {@link shopping_mall_ai_coupon_tickets.id}.","relation":{"name":"couponTicket","targetModel":"shopping_mall_ai_coupon_tickets","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_one_time_coupon_code_id","type":"uuid","description":"Optional one-time code used {@link shopping_mall_ai_one_time_coupon_codes.id}.","relation":{"name":"oneTimeCode","targetModel":"shopping_mall_ai_one_time_coupon_codes","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"status","type":"string","description":"Redemption state label such as applied, reverted, pending_review.","nullable":false},{"name":"redeemed_amount","type":"double","description":"Discount amount applied (in order currency).","nullable":false},{"name":"eligible_base_amount","type":"double","description":"Eligible base amount on which discount was evaluated (for evidence).","nullable":true},{"name":"settlement_currency","type":"string","description":"Currency code used for the order settlement (e.g., USD, KRW).","nullable":true},{"name":"redeemed_at","type":"datetime","description":"Timestamp the redemption was applied.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_order_id","shopping_mall_ai_coupon_id"],"unique":true},{"fieldNames":["shopping_mall_ai_cart_id","shopping_mall_ai_coupon_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_cart_id"]},{"fieldNames":["shopping_mall_ai_coupon_ticket_id"]},{"fieldNames":["shopping_mall_ai_one_time_coupon_code_id"]},{"fieldNames":["shopping_mall_ai_customer_id","redeemed_at"]},{"fieldNames":["shopping_mall_ai_coupon_id","redeemed_at"]},{"fieldNames":["shopping_mall_ai_channel_id","redeemed_at"]},{"fieldNames":["shopping_mall_ai_coupon_id","shopping_mall_ai_customer_id"]},{"fieldNames":["status","redeemed_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_coupon_risk_reviews","description":"Risk review records for a specific {@link shopping_mall_ai_coupon_redemptions}. Used by finance/risk teams to capture abuse indicators, reviewer decisions, and rationale. 1:1 with the redemption under review.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_coupon_redemption_id","type":"uuid","description":"Reviewed redemption's {@link shopping_mall_ai_coupon_redemptions.id}.","relation":{"name":"redemption","targetModel":"shopping_mall_ai_coupon_redemptions","targetField":"id"},"unique":true,"nullable":false},{"name":"reviewer_customer_id","type":"uuid","description":"Reviewer user reference {@link shopping_mall_ai_customers.id} (operator performing review).","relation":{"name":"reviewer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"risk_score","type":"double","description":"Quantified risk score at review time (e.g., 0–100).","nullable":true},{"name":"decision","type":"string","description":"Review decision such as allow, block, review_required.","nullable":false},{"name":"reason","type":"string","description":"Human-readable reason or codes for the decision.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation time.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update time.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion time if logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_coupon_redemption_id"],"unique":true}],"plainIndexes":[{"fieldNames":["decision","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-13-coins.prisma","namespace":"Coins","models":[{"name":"shopping_mall_ai_deposit_accounts","description":"Stored-value deposit account per customer per channel. Maintains available and pending balances for cash-equivalent deposits used in mixed tenders. One account exists per (customer, channel). Related entities include {@link shopping_mall_ai_deposit_transactions} and {@link shopping_mall_ai_deposit_charges}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Account owner. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel scoping of this account. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"currency","type":"string","description":"ISO 4217 currency code that governs deposits in this account.","nullable":false},{"name":"balance","type":"double","description":"Current available balance after confirmed transactions.","nullable":false},{"name":"pending_balance","type":"double","description":"Amount currently on hold (e.g., pending confirmations) and not yet available.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status of the account (e.g., Active, Suspended, Closed).","nullable":false},{"name":"low_balance_threshold","type":"double","description":"Optional alert threshold for low balance notifications.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_deposit_transactions","description":"Immutable ledger entries for deposit accounts. Each record reflects a balance-changing event with before/after amounts, reasons, and optional linkage to orders/payments for reconciliation. Child of {@link shopping_mall_ai_deposit_accounts}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_deposit_account_id","type":"uuid","description":"Belonged account's {@link shopping_mall_ai_deposit_accounts.id}","relation":{"name":"depositAccount","targetModel":"shopping_mall_ai_deposit_accounts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_id","type":"uuid","description":"Optional related order for audit trace. Target model's {@link shopping_mall_ai_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_payment_id","type":"uuid","description":"Optional related payment for audit trace. Target model's {@link shopping_mall_ai_payments.id}","relation":{"name":"payment","targetModel":"shopping_mall_ai_payments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"kind","type":"string","description":"Transaction direction: \"credit\" for balance increase or \"debit\" for decrease (stored as string).","nullable":false},{"name":"amount","type":"double","description":"Absolute amount of this transaction in account currency.","nullable":false},{"name":"balance_before","type":"double","description":"Account balance just before applying this transaction.","nullable":false},{"name":"balance_after","type":"double","description":"Account balance immediately after applying this transaction.","nullable":false},{"name":"reason_code","type":"string","description":"Business reason category for this transaction (e.g., charge_confirmed, refund, adjustment).","nullable":false},{"name":"memo","type":"string","description":"Optional human-readable memo or notes for this ledger entry.","nullable":true},{"name":"idempotency_key","type":"string","description":"Client- or system-supplied idempotency key to prevent duplicate ledger writes.","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp when the business event actually occurred (may differ from created_at).","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp (write time).","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for exceptional cases; ledger entries are typically append-only.","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_deposit_account_id","occurred_at"]},{"fieldNames":["shopping_mall_ai_channel_id","occurred_at"]},{"fieldNames":["shopping_mall_ai_order_id","occurred_at"]}],"ginIndexes":[{"fieldName":"memo"}]},{"name":"shopping_mall_ai_deposit_charges","description":"Charge application records for funding deposit accounts. Tracks lifecycle for synchronous/asynchronous methods, provider references, and reconciliation. Links to {@link shopping_mall_ai_deposit_accounts}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_deposit_account_id","type":"uuid","description":"Target deposit account's {@link shopping_mall_ai_deposit_accounts.id}","relation":{"name":"depositAccount","targetModel":"shopping_mall_ai_deposit_accounts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_payment_id","type":"uuid","description":"Optional linkage to a payment entity for orchestration. Target model's {@link shopping_mall_ai_payments.id}","relation":{"name":"payment","targetModel":"shopping_mall_ai_payments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"requested_amount","type":"double","description":"Requested charge amount in account currency.","nullable":false},{"name":"currency","type":"string","description":"ISO 4217 currency code for this charge request.","nullable":false},{"name":"status","type":"string","description":"Lifecycle of the charge (e.g., pending, confirmed, cancelled, failed).","nullable":false},{"name":"external_provider","type":"string","description":"Business name of the payment provider/gateway handling this charge (if applicable).","nullable":true},{"name":"external_transaction_id","type":"string","description":"Provider-side transaction identifier used for reconciliation.","nullable":true},{"name":"request_code","type":"string","description":"Business request code used for idempotency and tracking; unique per charge request.","nullable":false},{"name":"expires_at","type":"datetime","description":"Optional expiration time for asynchronous instructions.","nullable":true},{"name":"confirmed_at","type":"datetime","description":"Time when funds were confirmed (if confirmed).","nullable":true},{"name":"cancelled_at","type":"datetime","description":"Time when the charge was cancelled (if cancelled).","nullable":true},{"name":"failure_reason","type":"string","description":"Failure or discrepancy reason text, if any.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["request_code"],"unique":true},{"fieldNames":["external_provider","external_transaction_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_deposit_account_id","status"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[{"fieldName":"failure_reason"}]},{"name":"shopping_mall_ai_deposit_fraud_flags","description":"Fraud/velocity/risk flags associated with deposit activity for review workflows. Serves as supporting evidence and should not duplicate denormalized customer data. May optionally reference a specific {@link shopping_mall_ai_deposit_charges} record.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_deposit_account_id","type":"uuid","description":"Related account's {@link shopping_mall_ai_deposit_accounts.id}","relation":{"name":"depositAccount","targetModel":"shopping_mall_ai_deposit_accounts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_deposit_charge_id","type":"uuid","description":"Optional linkage to a specific charge. Target model's {@link shopping_mall_ai_deposit_charges.id}","relation":{"name":"depositCharge","targetModel":"shopping_mall_ai_deposit_charges","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"category","type":"string","description":"Flag category (e.g., velocity, mismatched_identity, geo_anomaly, duplicate_funding).","nullable":false},{"name":"severity","type":"string","description":"Severity label for triage (e.g., info, warning, critical).","nullable":false},{"name":"active","type":"boolean","description":"Whether this flag is currently active.","nullable":false},{"name":"reason","type":"string","description":"Human-readable reason/notes giving investigation context.","nullable":false},{"name":"resolved_at","type":"datetime","description":"Timestamp when this flag was resolved (if resolved).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_deposit_account_id","active"]},{"fieldNames":["category","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_mileage_accounts","description":"Per-customer per-channel mileage (loyalty points) account. Stores current balance and status; earning/spending recorded in {@link shopping_mall_ai_mileage_transactions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Account owner. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel scoping. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"balance","type":"int","description":"Current available mileage points after confirmed transactions.","nullable":false},{"name":"status","type":"string","description":"Lifecycle status (e.g., Active, Suspended, Closed).","nullable":false},{"name":"expiry_policy","type":"string","description":"Optional policy descriptor for how points expire (rolling/fixed windows, grace).","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_mileage_transactions","description":"Immutable ledger entries for mileage accounts including earn, spend, reversal, expiry, and donation operations. Supports idempotency and optional linkage to orders and earning rules.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_mileage_account_id","type":"uuid","description":"Belonged account's {@link shopping_mall_ai_mileage_accounts.id}","relation":{"name":"mileageAccount","targetModel":"shopping_mall_ai_mileage_accounts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_id","type":"uuid","description":"Optional related order for verified purchase/adjustments. Target model's {@link shopping_mall_ai_orders.id}","relation":{"name":"order","targetModel":"shopping_mall_ai_orders","targetField":"id"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_mileage_earning_rule_id","type":"uuid","description":"Optional earning rule applied for this transaction. Target model's {@link shopping_mall_ai_mileage_earning_rules.id}","relation":{"name":"earningRule","targetModel":"shopping_mall_ai_mileage_earning_rules","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"kind","type":"string","description":"Operation kind (earn, spend, reversal, expiry, donation). Stored as string for governance flexibility.","nullable":false},{"name":"points","type":"int","description":"Integer points earned or spent (negative not stored; direction is in kind).","nullable":false},{"name":"balance_before","type":"int","description":"Points balance just before this transaction.","nullable":false},{"name":"balance_after","type":"int","description":"Points balance immediately after this transaction.","nullable":false},{"name":"reason_code","type":"string","description":"Business reason category (e.g., order_confirmed, refund, admin_adjustment, expiry).","nullable":false},{"name":"memo","type":"string","description":"Optional human-readable memo.","nullable":true},{"name":"idempotency_key","type":"string","description":"Idempotency key to prevent duplicate ledger writes.","nullable":true},{"name":"expiration_at","type":"datetime","description":"If applicable to earn operations, the expiration date/time of the earned points segment.","nullable":true},{"name":"occurred_at","type":"datetime","description":"Timestamp when the business event actually occurred.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_mileage_account_id","occurred_at"]},{"fieldNames":["shopping_mall_ai_channel_id","occurred_at"]},{"fieldNames":["shopping_mall_ai_order_id","occurred_at"]}],"ginIndexes":[{"fieldName":"memo"}]},{"name":"shopping_mall_ai_mileage_earning_rules","description":"Configurable earning rules determining how mileage points are calculated for eligible orders within a channel, optionally scoped to a seller. Managed by admins with full audit needs. Transactions may reference a rule via {@link shopping_mall_ai_mileage_transactions}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel where this rule applies. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_seller_id","type":"uuid","description":"Optional seller scoping for seller-specific earning policies. Target model's {@link shopping_mall_ai_sellers.id}","relation":{"name":"seller","targetModel":"shopping_mall_ai_sellers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Business rule code unique within a channel for governance and analytics.","nullable":false},{"name":"name","type":"string","description":"Human-readable rule name.","nullable":false},{"name":"description","type":"string","description":"Detailed description of the rule and its applicability.","nullable":true},{"name":"active","type":"boolean","description":"Whether the rule is currently active.","nullable":false},{"name":"calculation_basis","type":"string","description":"Basis of calculation (e.g., percentage_of_net, fixed_points).","nullable":false},{"name":"percentage_rate","type":"double","description":"Percentage rate to apply when calculation_basis implies a percentage.","nullable":true},{"name":"fixed_points","type":"int","description":"Fixed points to award when calculation_basis implies a fixed amount.","nullable":true},{"name":"min_order_amount","type":"double","description":"Optional minimum order amount required to earn points.","nullable":true},{"name":"max_points_per_order","type":"int","description":"Optional cap on points per order.","nullable":true},{"name":"starts_at","type":"datetime","description":"Optional start of validity window for this rule.","nullable":true},{"name":"ends_at","type":"datetime","description":"Optional end of validity window for this rule.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","active"]},{"fieldNames":["starts_at","ends_at"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"description"}]},{"name":"shopping_mall_ai_mileage_donations","description":"Administrative mileage donations to customer accounts for goodwill, campaigns, or remediation. Each record captures points, reason, and timing for audit. Links to {@link shopping_mall_ai_mileage_accounts}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_mileage_account_id","type":"uuid","description":"Recipient account's {@link shopping_mall_ai_mileage_accounts.id}","relation":{"name":"mileageAccount","targetModel":"shopping_mall_ai_mileage_accounts","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context for this donation. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"points","type":"int","description":"Number of points granted.","nullable":false},{"name":"reason","type":"string","description":"Reason for donation (campaign, service recovery, admin goodwill).","nullable":false},{"name":"idempotency_key","type":"string","description":"Idempotency key to prevent duplicate grants.","nullable":true},{"name":"granted_at","type":"datetime","description":"Timestamp when the donation was granted.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["idempotency_key"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_mileage_account_id","granted_at"]},{"fieldNames":["shopping_mall_ai_channel_id","granted_at"]}],"ginIndexes":[{"fieldName":"reason"}]}]},{"filename":"schema-14-articles.prisma","namespace":"Articles","models":[{"name":"shopping_mall_ai_board_posts","description":"Community board posts across channels/sections. Holds workflow state and linkage only; actual content is captured in immutable {@link shopping_mall_ai_post_snapshots}. Posts may optionally relate to a product snapshot for product-linked threads. Authors are end-users (customers) or staff users represented via the customers domain with roles.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"section_id","type":"uuid","description":"Optional merchandising section within the channel. Target model's {@link shopping_mall_ai_sections.id}","relation":{"name":"section","targetModel":"shopping_mall_ai_sections","targetField":"id"},"unique":false,"nullable":true},{"name":"product_snapshot_id","type":"uuid","description":"Optional product snapshot bound when the post is product-linked. Target model's {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id"},"unique":false,"nullable":true},{"name":"author_customer_id","type":"uuid","description":"Author (customer) who created the post. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"author","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Lifecycle state of the post (e.g., draft, pendingModeration, published, hidden, locked, archived).","nullable":false},{"name":"visibility","type":"string","description":"Visibility policy for the post (e.g., public, private).","nullable":false},{"name":"locked","type":"boolean","description":"Whether the thread is locked, preventing new edits/comments except by authorized roles.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability and evidence preservation.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["channel_id","created_at"]},{"fieldNames":["author_customer_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_post_snapshots","description":"Immutable snapshots of {@link shopping_mall_ai_board_posts} capturing title/body and key flags at the moment of change for audit/evidence. Append-only version history supporting diffs and dispute resolution.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"board_post_id","type":"uuid","description":"Source board post. Target model's {@link shopping_mall_ai_board_posts.id}","relation":{"name":"post","targetModel":"shopping_mall_ai_board_posts","targetField":"id"},"unique":false,"nullable":false},{"name":"editor_customer_id","type":"uuid","description":"Editor (customer) who made this change, if applicable. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"editor","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"version","type":"int","description":"Monotonic version number per post; starts at 1 and increments on each content/state change.","nullable":false},{"name":"title","type":"string","description":"Post title captured in this snapshot.","nullable":false},{"name":"body","type":"string","description":"Post body/content captured in this snapshot.","nullable":false},{"name":"visibility","type":"string","description":"Visibility captured at this snapshot (e.g., public, private).","nullable":false},{"name":"locked","type":"boolean","description":"Locked flag captured at this snapshot.","nullable":false},{"name":"reason","type":"string","description":"Optional reason or note associated with this change (e.g., moderation note).","nullable":true},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Maintenance timestamp (rarely used for snapshots, kept for consistency).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp (normally null; snapshots are immutable and rarely deleted).","nullable":true}],"uniqueIndexes":[{"fieldNames":["board_post_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["board_post_id","created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_ai_post_attachments","description":"Files attached to a specific {@link shopping_mall_ai_post_snapshots} for immutable evidence. Each record links a snapshot to a file asset with ordering and optional caption.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"post_snapshot_id","type":"uuid","description":"Bound post snapshot's {@link shopping_mall_ai_post_snapshots.id}","relation":{"name":"postSnapshot","targetModel":"shopping_mall_ai_post_snapshots","targetField":"id"},"unique":false,"nullable":false},{"name":"file_asset_id","type":"uuid","description":"Attached file asset's {@link shopping_mall_ai_file_assets.id}","relation":{"name":"fileAsset","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"role","type":"string","description":"Semantic role of the file in the post (e.g., primary_image, inline_image, document).","nullable":false},{"name":"caption","type":"string","description":"Optional human-readable caption for the file.","nullable":true},{"name":"position","type":"int","description":"Ordering position within the snapshot's attachment list (0-based or 1-based by policy).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; record remains for evidence.","nullable":true}],"uniqueIndexes":[{"fieldNames":["post_snapshot_id","file_asset_id"],"unique":true}],"plainIndexes":[{"fieldNames":["post_snapshot_id","position"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_comments","description":"Hierarchical comments on board posts. Stores workflow/visibility and relationships; actual comment text is preserved in immutable {@link shopping_mall_ai_comment_snapshots}. Supports nested replies via self-referencing parent chain. Designed for cross-post moderation/search and independent management lifecycle.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"board_post_id","type":"uuid","description":"Target post being commented on. {@link shopping_mall_ai_board_posts.id}","relation":{"name":"post","targetModel":"shopping_mall_ai_board_posts","targetField":"id"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional parent comment for hierarchical replies. {@link shopping_mall_ai_comments.id}","relation":{"name":"parent","targetModel":"shopping_mall_ai_comments","targetField":"id","mappingName":"recursive"},"unique":false,"nullable":true},{"name":"author_customer_id","type":"uuid","description":"Author (customer) of the comment. {@link shopping_mall_ai_customers.id}","relation":{"name":"author","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Lifecycle status used for moderation workflows (e.g., published, hidden, deletedSoft, locked).","nullable":false},{"name":"visibility","type":"string","description":"Visibility policy for the comment (e.g., public, private).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for recoverability and evidence.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["board_post_id","created_at"]},{"fieldNames":["parent_id","created_at"]},{"fieldNames":["author_customer_id","created_at"]},{"fieldNames":["board_post_id","status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_comment_snapshots","description":"Immutable snapshots of {@link shopping_mall_ai_comments} capturing the comment text and key flags at time of change. Enables audit trails and edit histories while main comment stores relationships and state only.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"comment_id","type":"uuid","description":"Source comment. Target model's {@link shopping_mall_ai_comments.id}","relation":{"name":"comment","targetModel":"shopping_mall_ai_comments","targetField":"id"},"unique":false,"nullable":false},{"name":"editor_customer_id","type":"uuid","description":"Editor (customer) who made this change, if applicable. Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"editor","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"version","type":"int","description":"Monotonic version number per comment; starts at 1 and increments on each change.","nullable":false},{"name":"body","type":"string","description":"Comment text captured at this snapshot.","nullable":false},{"name":"visibility","type":"string","description":"Visibility captured at this snapshot (e.g., public, private).","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Maintenance timestamp (rarely used for snapshots, kept for consistency).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp (normally null; snapshots are immutable and rarely deleted).","nullable":true}],"uniqueIndexes":[{"fieldNames":["comment_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["comment_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_ai_moderation_actions","description":"Records moderation decisions and actions applied to posts or comments, providing evidence with optional linkage to the exact {@link shopping_mall_ai_post_snapshots} or {@link shopping_mall_ai_comment_snapshots} affected. Includes actor identity (customer-based with role) and reason codes.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"board_post_id","type":"uuid","description":"Target post affected by this moderation action, if applicable. {@link shopping_mall_ai_board_posts.id}","relation":{"name":"post","targetModel":"shopping_mall_ai_board_posts","targetField":"id"},"unique":false,"nullable":true},{"name":"comment_id","type":"uuid","description":"Target comment affected by this moderation action, if applicable. {@link shopping_mall_ai_comments.id}","relation":{"name":"comment","targetModel":"shopping_mall_ai_comments","targetField":"id"},"unique":false,"nullable":true},{"name":"post_snapshot_id","type":"uuid","description":"Specific post snapshot moderated, if applicable. {@link shopping_mall_ai_post_snapshots.id}","relation":{"name":"postSnapshot","targetModel":"shopping_mall_ai_post_snapshots","targetField":"id"},"unique":false,"nullable":true},{"name":"comment_snapshot_id","type":"uuid","description":"Specific comment snapshot moderated, if applicable. {@link shopping_mall_ai_comment_snapshots.id}","relation":{"name":"commentSnapshot","targetModel":"shopping_mall_ai_comment_snapshots","targetField":"id"},"unique":false,"nullable":true},{"name":"actor_customer_id","type":"uuid","description":"Moderator (customer) who acted. {@link shopping_mall_ai_customers.id}","relation":{"name":"actor","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"action","type":"string","description":"Action type performed (e.g., approve, reject, hide, redact, takedown, lock, unlock).","nullable":false},{"name":"reason","type":"string","description":"Reason code or free-text explanation supporting the decision.","nullable":false},{"name":"notes","type":"string","description":"Optional additional notes for internal audit/context.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp of the moderation record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; evidence preserved for retention period.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["board_post_id","created_at"]},{"fieldNames":["comment_id","created_at"]},{"fieldNames":["actor_customer_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_notifications","description":"Notification outbox for subscribers/authors related to posts and comments. Captures recipient, context (channel/section), message kind and delivery status transitions with timestamps (sent/read). Enables per-recipient queues and status-based dispatch workflows.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"recipient_customer_id","type":"uuid","description":"Notification recipient’s {@link shopping_mall_ai_customers.id}","relation":{"name":"recipient","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context’s {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"section_id","type":"uuid","description":"Optional merchandising section context’s {@link shopping_mall_ai_sections.id}","relation":{"name":"section","targetModel":"shopping_mall_ai_sections","targetField":"id"},"unique":false,"nullable":true},{"name":"board_post_id","type":"uuid","description":"Related post’s {@link shopping_mall_ai_board_posts.id} (nullable).","relation":{"name":"post","targetModel":"shopping_mall_ai_board_posts","targetField":"id"},"unique":false,"nullable":true},{"name":"comment_id","type":"uuid","description":"Related comment’s {@link shopping_mall_ai_comments.id} (nullable).","relation":{"name":"comment","targetModel":"shopping_mall_ai_comments","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"notification_type","type":"string","description":"Business classification of this notification (e.g., post_published, new_comment, official_response, moderation_decision).","nullable":false},{"name":"status","type":"string","description":"Delivery status (e.g., pending, sent, failed, read).","nullable":false},{"name":"sent_at","type":"datetime","description":"Timestamp when the notification was sent (if sent).","nullable":true},{"name":"read_at","type":"datetime","description":"Timestamp when the recipient read the notification (if read).","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp; evidence retained per policy.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["section_id"]},{"fieldNames":["board_post_id"]},{"fieldNames":["comment_id"]},{"fieldNames":["recipient_customer_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["recipient_customer_id","status","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-15-inquiries.prisma","namespace":"Inquiries","models":[{"name":"shopping_mall_ai_inquiries","description":"Primary entity for product-linked inquiries within a channel. Stores the current visibility and content at the inquiry level while immutable history is preserved in {@link shopping_mall_ai_inquiry_snapshots}. Each inquiry references a product state via {@link shopping_mall_ai_product_snapshots} for evidence. Official responses are recorded in {@link shopping_mall_ai_inquiry_responses} and threaded discussions in {@link shopping_mall_ai_inquiry_comments}. SLA outcomes are captured in {@link shopping_mall_ai_inquiry_sla_metrics}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Belonged channel's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_section_id","type":"uuid","description":"Optional merchandising section's {@link shopping_mall_ai_sections.id}.","relation":{"name":"section","targetModel":"shopping_mall_ai_sections"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Inquiry author's {@link shopping_mall_ai_customers.id}.","relation":{"name":"author","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Bound product evidence's {@link shopping_mall_ai_product_snapshots.id}.","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Inquiry title/headline as provided by the author at creation time.","nullable":false},{"name":"body","type":"string","description":"Inquiry content body. Markdown/text per policy.","nullable":false},{"name":"visibility","type":"string","description":"Visibility policy (e.g., public, private). Aligns with Articles domain for cross-domain consistency.","nullable":false},{"name":"creator_role","type":"string","description":"Actor role at creation time (e.g., customer, seller, supportAgent). Stored for evidence.","nullable":false},{"name":"status","type":"string","description":"Business status of the inquiry (e.g., open, hidden, closed).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","visibility","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_product_snapshot_id","created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_ai_inquiry_snapshots","description":"Immutable point-in-time records capturing the inquiry’s state for evidence and audits. Stores content and a visibility string along with actor/resolution context at the time of change. Linked to {@link shopping_mall_ai_inquiries}, {@link shopping_mall_ai_product_snapshots}, and {@link shopping_mall_ai_channels}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_inquiry_id","type":"uuid","description":"Owning inquiry’s {@link shopping_mall_ai_inquiries.id}.","relation":{"name":"inquiry","targetModel":"shopping_mall_ai_inquiries"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Bound product evidence’s {@link shopping_mall_ai_product_snapshots.id}.","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"title","type":"string","description":"Inquiry title at the snapshot time.","nullable":false},{"name":"body","type":"string","description":"Inquiry body at the snapshot time.","nullable":false},{"name":"visibility","type":"string","description":"Visibility policy captured at snapshot time (e.g., public, private).","nullable":false},{"name":"actor_role","type":"string","description":"Actor role causing the snapshot (e.g., author, moderator, supportAgent).","nullable":false},{"name":"reason","type":"string","description":"Optional reason for the change snapshot (e.g., policy update, redaction).","nullable":true},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp (evidence time).","nullable":false},{"name":"updated_at","type":"datetime","description":"Administrative update time for metadata if ever changed by system (rare).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp under retention/legal policies.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_inquiry_id","created_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_ai_inquiry_responses","description":"Official responses to inquiries authored by authorized roles (seller/sellerManager/supportAgent) within a channel. Used for SLA measurement (time-to-first-response) and moderation workflows. Related to {@link shopping_mall_ai_inquiries}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_inquiry_id","type":"uuid","description":"Target inquiry’s {@link shopping_mall_ai_inquiries.id}","relation":{"name":"inquiry","targetModel":"shopping_mall_ai_inquiries","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Responder identity (seller/support/admin user representation). Target model's {@link shopping_mall_ai_customers.id}","relation":{"name":"responder","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"body","type":"string","description":"Response content body.","nullable":false},{"name":"visibility","type":"string","description":"Visibility classification for the response (e.g., public, private-to-author-and-staff) per policy.","nullable":false},{"name":"status","type":"string","description":"Moderation/publication status (e.g., published, hidden).","nullable":false},{"name":"responded_at","type":"datetime","description":"Business timestamp for when this official response was posted.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (for storage record).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_inquiry_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_ai_inquiry_comments","description":"Threaded comments associated with inquiries. Supports hierarchical replies via self-reference and respects the inquiry’s visibility policies. Uses a visibility string for consistency with the Articles and Inquiries domains.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_inquiry_id","type":"uuid","description":"Related inquiry’s {@link shopping_mall_ai_inquiries.id}.","relation":{"name":"inquiry","targetModel":"shopping_mall_ai_inquiries"},"unique":false,"nullable":false},{"name":"parent_id","type":"uuid","description":"Optional parent comment’s {@link shopping_mall_ai_inquiry_comments.id}.","relation":{"name":"parent","targetModel":"shopping_mall_ai_inquiry_comments","mappingName":"recursive"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Author identity’s {@link shopping_mall_ai_customers.id}.","relation":{"name":"author","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context’s {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"body","type":"string","description":"Comment content body.","nullable":false},{"name":"visibility","type":"string","description":"Visibility policy (e.g., public, private-to-author-and-staff) per channel rules.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_inquiry_id","created_at"]},{"fieldNames":["parent_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]}],"ginIndexes":[{"fieldName":"body"}]},{"name":"shopping_mall_ai_inquiry_sla_metrics","description":"Supporting table capturing SLA-related timestamps and current outcome classification for an inquiry. Records target due time and actual first-view/first-response timestamps for evidence. Maintained by workflows and referenced for analytics; not a materialized view. One-to-one with {@link shopping_mall_ai_inquiries}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_inquiry_id","type":"uuid","description":"Owning inquiry (1:1). Target model's {@link shopping_mall_ai_inquiries.id}","relation":{"name":"inquiry","targetModel":"shopping_mall_ai_inquiries","targetField":"id"},"unique":true,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. Target model's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"target_first_response_due_at","type":"datetime","description":"Policy-derived due time for the first official response at the time the SLA target was set.","nullable":true},{"name":"seller_first_viewed_at","type":"datetime","description":"Timestamp when the seller/support first viewed the inquiry for SLA metrics.","nullable":true},{"name":"first_official_response_at","type":"datetime","description":"Timestamp of the first official response if any.","nullable":true},{"name":"status","type":"string","description":"SLA status classification captured by the system (e.g., pending, met, breached).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp (record inception).","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp when logically removed.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_inquiry_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status"]}],"ginIndexes":[]}]},{"filename":"schema-16-reviews.prisma","namespace":"Reviews","models":[{"name":"shopping_mall_ai_reviews","description":"Primary entity representing a product review authored by a customer within a channel. Enforces verified-purchase linkage via the order item (1:1). Content history resides in {@link shopping_mall_ai_review_snapshots}. Moderation actions in {@link shopping_mall_ai_review_moderations}. Product context is bound via {@link shopping_mall_ai_product_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Review's channel context. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Authoring customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_order_item_id","type":"uuid","description":"Verified purchase linkage to {@link shopping_mall_ai_order_items.id} (1:1 enforced).","relation":{"name":"orderItem","targetModel":"shopping_mall_ai_order_items"},"unique":true,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Bound product evidence at review creation. {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"status","type":"string","description":"Review lifecycle status (e.g., draft, published, hidden, archived).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_order_item_id"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_product_snapshot_id","created_at"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["status","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_review_snapshots","description":"Immutable snapshots capturing the content and rating of a review at a point in time. Stores title/body/rating and binds to the product snapshot for evidence. Used for search and analytics; aspect ratings live in {@link shopping_mall_ai_review_ratings}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_review_id","type":"uuid","description":"Owning review's {@link shopping_mall_ai_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_ai_reviews"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_snapshot_id","type":"uuid","description":"Product snapshot bound for evidence at this version. {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots"},"unique":false,"nullable":false}],"plainFields":[{"name":"version","type":"int","description":"Monotonic version number within a review.","nullable":false},{"name":"title","type":"string","description":"Snapshot title of the review at this version.","nullable":false},{"name":"body","type":"string","description":"Snapshot body/content of the review at this version.","nullable":false},{"name":"rating","type":"int","description":"Star rating (1–5). Application-level validation enforces the range.","nullable":false},{"name":"created_at","type":"datetime","description":"Snapshot creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last metadata update time (rarely used).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (rare).","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_review_id","version"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_review_id","created_at"]},{"fieldNames":["shopping_mall_ai_product_snapshot_id","created_at"]},{"fieldNames":["shopping_mall_ai_product_snapshot_id","rating"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"body"}]},{"name":"shopping_mall_ai_review_moderations","description":"Moderation actions performed on reviews, capturing decisions like approve, hide, redact, lock/unlock with reason codes and actor identity. Enables audit and policy enforcement. Links to {@link shopping_mall_ai_reviews}.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_review_id","type":"uuid","description":"Target review under moderation. {@link shopping_mall_ai_reviews.id}","relation":{"name":"review","targetModel":"shopping_mall_ai_reviews"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_actor_customer_id","type":"uuid","description":"Acting moderator/operator identity. {@link shopping_mall_ai_customers.id}","relation":{"name":"actor","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false}],"plainFields":[{"name":"action","type":"string","description":"Moderation action category (e.g., approve, reject, hide, redact, lock, unlock).","nullable":false},{"name":"reason","type":"string","description":"Structured reason code or narrative for the action.","nullable":false},{"name":"notes","type":"string","description":"Optional notes supporting the decision.","nullable":true},{"name":"created_at","type":"datetime","description":"Timestamp when the moderation action was recorded.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp for this moderation record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_review_id","created_at"]},{"fieldNames":["action","created_at"]},{"fieldNames":["shopping_mall_ai_actor_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_review_ratings","description":"Aspect ratings associated with a specific {@link shopping_mall_ai_review_snapshots} version (e.g., \"quality\", \"value\", \"delivery\"). Enables multi-criteria evaluations while keeping core review content normalized in snapshots.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_review_snapshot_id","type":"uuid","description":"Owning snapshot for which this aspect rating applies. Target model's {@link shopping_mall_ai_review_snapshots.id}","relation":{"name":"reviewSnapshot","targetModel":"shopping_mall_ai_review_snapshots","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"dimension","type":"string","description":"Rating dimension key (e.g., quality, value, delivery).","nullable":false},{"name":"score","type":"int","description":"Integer score for the dimension (1–5).","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp of the aspect rating record.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp of the aspect rating record.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp. Null when active.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_review_snapshot_id","dimension"],"unique":true}],"plainIndexes":[{"fieldNames":["dimension","score"]}],"ginIndexes":[]}]},{"filename":"schema-17-favorites.prisma","namespace":"Favorites","models":[{"name":"shopping_mall_ai_favorite_products","description":"Customer-managed product favorites with snapshot evidence. To fully prevent duplicates per customer and channel across snapshot changes, this model now references the base product entity as well as the snapshot. Uniqueness is enforced on (customer_id, channel_id, shopping_mall_ai_product_id) while retaining the snapshot reference for immutable evidence. Related lists use a junction table. References {@link shopping_mall_ai_customers}, {@link shopping_mall_ai_channels}, {@link shopping_mall_ai_products}, and {@link shopping_mall_ai_product_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_product_id","type":"uuid","description":"Base product being favorited. {@link shopping_mall_ai_products.id}","relation":{"name":"product","targetModel":"shopping_mall_ai_products","targetField":"id"},"unique":false,"nullable":false},{"name":"product_snapshot_id","type":"uuid","description":"Favorited product snapshot for immutable evidence. {@link shopping_mall_ai_product_snapshots.id}","relation":{"name":"productSnapshot","targetModel":"shopping_mall_ai_product_snapshots","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"price_drop_opt_in","type":"boolean","description":"Whether the customer opts into price-drop alerts for this favorite.","nullable":false},{"name":"label","type":"string","description":"Optional customer-defined label for organization and filtering.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","channel_id","shopping_mall_ai_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["product_snapshot_id"]},{"fieldNames":["customer_id","channel_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["customer_id","created_at"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"shopping_mall_ai_favorite_inquiries","description":"Customer-managed favorites for inquiries with snapshot evidence. This model now references the base inquiry entity in addition to the snapshot to ensure de-duplication by (customer, channel, inquiry) across snapshot updates. References {@link shopping_mall_ai_customers}, {@link shopping_mall_ai_channels}, {@link shopping_mall_ai_inquiries}, and {@link shopping_mall_ai_inquiry_snapshots}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context's {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_inquiry_id","type":"uuid","description":"Base inquiry being favorited. {@link shopping_mall_ai_inquiries.id}","relation":{"name":"inquiry","targetModel":"shopping_mall_ai_inquiries","targetField":"id"},"unique":false,"nullable":false},{"name":"inquiry_snapshot_id","type":"uuid","description":"Favorited inquiry snapshot for immutable evidence. {@link shopping_mall_ai_inquiry_snapshots.id}","relation":{"name":"inquirySnapshot","targetModel":"shopping_mall_ai_inquiry_snapshots","targetField":"id"},"unique":false,"nullable":false}],"plainFields":[{"name":"update_notice_opt_in","type":"boolean","description":"Whether to notify on official responses or visible updates to this inquiry.","nullable":false},{"name":"label","type":"string","description":"Optional customer-defined label for organizing favorites.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","channel_id","shopping_mall_ai_inquiry_id"],"unique":true}],"plainIndexes":[{"fieldNames":["inquiry_snapshot_id"]},{"fieldNames":["customer_id","channel_id","created_at"]},{"fieldNames":["channel_id","created_at"]},{"fieldNames":["customer_id","created_at"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"shopping_mall_ai_favorite_addresses","description":"Customer-managed address favorites to streamline checkout. Scoped by channel for privacy and policy; may mark a favorite as primary per channel (enforced by application logic). References {@link shopping_mall_ai_customers}, {@link shopping_mall_ai_channels}, and {@link shopping_mall_ai_addresses}. Related to favorite lists via {@link shopping_mall_ai_favorite_lists_shopping_mall_ai_favorite_addresses}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"address_id","type":"uuid","description":"Target shipping address's {@link shopping_mall_ai_addresses.id}.","relation":{"name":"address","targetModel":"shopping_mall_ai_addresses"},"unique":false,"nullable":false}],"plainFields":[{"name":"is_primary","type":"boolean","description":"Whether this favorite is the primary address for the customer within this channel. Application logic enforces single-primary invariant.","nullable":false},{"name":"label","type":"string","description":"Optional customer-defined label (e.g., \"Home\", \"Office\").","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","channel_id","address_id"],"unique":true}],"plainIndexes":[{"fieldNames":["customer_id","channel_id"]},{"fieldNames":["customer_id","created_at"]}],"ginIndexes":[{"fieldName":"label"}]},{"name":"shopping_mall_ai_price_drop_alerts","description":"Event/evidence log of price-drop alerts generated for favorited products. Each record links to a {@link shopping_mall_ai_favorite_products} entry and stores the pricing change context and coalescing outcome for auditability. Intended for analytics and notification history; typically append-only.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_product_id","type":"uuid","description":"Related favorite product's {@link shopping_mall_ai_favorite_products.id}.","relation":{"name":"favoriteProduct","targetModel":"shopping_mall_ai_favorite_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"triggered_at","type":"datetime","description":"Timestamp when the alert was generated (business event time).","nullable":false},{"name":"previous_price","type":"double","description":"Effective price before the drop (in order currency context).","nullable":false},{"name":"new_price","type":"double","description":"Effective price after the drop (in order currency context).","nullable":false},{"name":"coalesced","type":"boolean","description":"Whether this alert was coalesced under the current policy window.","nullable":false},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for retention governance.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["favorite_product_id","triggered_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_favorite_lists","description":"User-managed lists for organizing favorites (e.g., \"Wishlist\", \"CompareLater\"). Lists are scoped per customer and channel. Items are associated via junction tables to support many-to-many relationships with product, inquiry, and address favorites. References {@link shopping_mall_ai_customers} and {@link shopping_mall_ai_channels}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"customer_id","type":"uuid","description":"Owner customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"customer","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":false},{"name":"channel_id","type":"uuid","description":"Channel context's {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false}],"plainFields":[{"name":"code","type":"string","description":"Stable programmatic code for the list (unique per customer and channel).","nullable":false},{"name":"name","type":"string","description":"Human-readable list name displayed to the user.","nullable":false},{"name":"description","type":"string","description":"Optional description or notes about the list.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp for evidence retention.","nullable":true}],"uniqueIndexes":[{"fieldNames":["customer_id","channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["customer_id","created_at"]},{"fieldNames":["channel_id","created_at"]}],"ginIndexes":[{"fieldName":"name"}]},{"name":"shopping_mall_ai_favorite_lists_shopping_mall_ai_favorite_products","description":"Junction table connecting {@link shopping_mall_ai_favorite_lists} and {@link shopping_mall_ai_favorite_products} to support many-to-many list membership for product favorites. Prevents duplicate membership entries and preserves audit timestamps.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_list_id","type":"uuid","description":"List's {@link shopping_mall_ai_favorite_lists.id}.","relation":{"name":"favoriteList","targetModel":"shopping_mall_ai_favorite_lists"},"unique":false,"nullable":false},{"name":"favorite_product_id","type":"uuid","description":"Favorite product's {@link shopping_mall_ai_favorite_products.id}.","relation":{"name":"favoriteProduct","targetModel":"shopping_mall_ai_favorite_products"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Membership creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["favorite_list_id","favorite_product_id"],"unique":true}],"plainIndexes":[{"fieldNames":["favorite_list_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_favorite_lists_shopping_mall_ai_favorite_inquiries","description":"Junction table connecting {@link shopping_mall_ai_favorite_lists} and {@link shopping_mall_ai_favorite_inquiries} to support many-to-many list membership for inquiry favorites. Prevents duplicate membership entries and preserves audit timestamps.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_list_id","type":"uuid","description":"List's {@link shopping_mall_ai_favorite_lists.id}.","relation":{"name":"favoriteList","targetModel":"shopping_mall_ai_favorite_lists"},"unique":false,"nullable":false},{"name":"favorite_inquiry_id","type":"uuid","description":"Favorite inquiry's {@link shopping_mall_ai_favorite_inquiries.id}.","relation":{"name":"favoriteInquiry","targetModel":"shopping_mall_ai_favorite_inquiries"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Membership creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["favorite_list_id","favorite_inquiry_id"],"unique":true}],"plainIndexes":[{"fieldNames":["favorite_list_id","created_at"]}],"ginIndexes":[]},{"name":"shopping_mall_ai_favorite_lists_shopping_mall_ai_favorite_addresses","description":"Junction table connecting {@link shopping_mall_ai_favorite_lists} and {@link shopping_mall_ai_favorite_addresses} to support many-to-many list membership for address favorites. Prevents duplicate membership entries and preserves audit timestamps.","material":false,"stance":"subsidiary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"favorite_list_id","type":"uuid","description":"List's {@link shopping_mall_ai_favorite_lists.id}.","relation":{"name":"favoriteList","targetModel":"shopping_mall_ai_favorite_lists"},"unique":false,"nullable":false},{"name":"favorite_address_id","type":"uuid","description":"Favorite address's {@link shopping_mall_ai_favorite_addresses.id}.","relation":{"name":"favoriteAddress","targetModel":"shopping_mall_ai_favorite_addresses"},"unique":false,"nullable":false}],"plainFields":[{"name":"created_at","type":"datetime","description":"Membership creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["favorite_list_id","favorite_address_id"],"unique":true}],"plainIndexes":[{"fieldNames":["favorite_list_id","created_at"]}],"ginIndexes":[]}]},{"filename":"schema-18-compliance.prisma","namespace":"Compliance","models":[{"name":"shopping_mall_ai_consents","description":"Consent receipts per subject and channel recording purpose, version, provenance, and grant/withdrawal timestamps. Supports privacy governance and audit evidence. Related entities: {@link shopping_mall_ai_customers}, {@link shopping_mall_ai_channels}, and optional receipt {@link shopping_mall_ai_file_assets}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Subject user reference. {@link shopping_mall_ai_customers.id}","relation":{"name":"subject","targetModel":"shopping_mall_ai_customers"},"unique":false,"nullable":true},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel context. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_file_asset_id","type":"uuid","description":"Optional receipt file evidence. {@link shopping_mall_ai_file_assets.id}","relation":{"name":"receiptFile","targetModel":"shopping_mall_ai_file_assets"},"unique":false,"nullable":true}],"plainFields":[{"name":"purpose","type":"string","description":"Business purpose of consent (e.g., personalization, marketing).","nullable":false},{"name":"scope","type":"string","description":"Optional scope or audience qualifiers per channel policy.","nullable":true},{"name":"version","type":"string","description":"Policy/notice version of the consent record.","nullable":false},{"name":"granted","type":"boolean","description":"Whether consent is currently granted (true) or withdrawn (false).","nullable":false},{"name":"granted_at","type":"datetime","description":"Timestamp when consent was granted.","nullable":false},{"name":"revoked_at","type":"datetime","description":"Timestamp when consent was withdrawn, if applicable.","nullable":true},{"name":"provenance_uri","type":"uri","description":"Optional provenance or receipt URI.","nullable":true},{"name":"created_at","type":"datetime","description":"Record creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Record last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","purpose","version"],"unique":true}],"plainIndexes":[{"fieldNames":["shopping_mall_ai_file_asset_id"]},{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["granted","granted_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]},{"fieldNames":["shopping_mall_ai_customer_id","shopping_mall_ai_channel_id","purpose","granted"]}],"ginIndexes":[{"fieldName":"purpose"}]},{"name":"shopping_mall_ai_dsar_requests","description":"Data Subject Access Requests (DSAR) tracked per channel and requester with lifecycle timestamps and evidence linkage. Supports access/erasure/correction/portability with SLA due dates. References {@link shopping_mall_ai_customers}, {@link shopping_mall_ai_channels}, and optional export artifact {@link shopping_mall_ai_file_assets}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_customer_id","type":"uuid","description":"Requester customer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"requester","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel scope {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":false},{"name":"export_shopping_mall_ai_file_asset_id","type":"uuid","description":"Optional exported data package file {@link shopping_mall_ai_file_assets.id}.","relation":{"name":"exportFile","targetModel":"shopping_mall_ai_file_assets","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"request_type","type":"string","description":"Type of DSAR request (access, deletion, correction, portability).","nullable":false},{"name":"status","type":"string","description":"Processing status (e.g., submitted, verified, in_progress, completed, denied).","nullable":false},{"name":"reason","type":"string","description":"Free-text business reason or notes (e.g., verification failure details).","nullable":true},{"name":"submitted_at","type":"datetime","description":"When the request was submitted.","nullable":false},{"name":"verified_at","type":"datetime","description":"When identity verification succeeded for this request, if required.","nullable":true},{"name":"completed_at","type":"datetime","description":"When the request was completed.","nullable":true},{"name":"due_at","type":"datetime","description":"SLA due date/time per jurisdiction and policy.","nullable":false},{"name":"denial_reason","type":"string","description":"If denied, the reason category or notes.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","status","due_at"]},{"fieldNames":["shopping_mall_ai_customer_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_legal_holds","description":"Legal holds applied to suspend purge and preserve evidence for investigations or litigation. Can target a specific table/row and is imposed by an authorized user. Optionally scoped to a channel. References {@link shopping_mall_ai_customers} as the imposer and {@link shopping_mall_ai_channels} for channel context.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"imposed_by_shopping_mall_ai_customer_id","type":"uuid","description":"Imposer's {@link shopping_mall_ai_customers.id}.","relation":{"name":"imposer","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel scope {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"target_table","type":"string","description":"Target table name under hold (e.g., shopping_mall_ai_orders).","nullable":false},{"name":"target_row_id","type":"uuid","description":"Optional target row UUID of the record under hold.","nullable":true},{"name":"reason","type":"string","description":"Reason and notes describing the legal hold.","nullable":true},{"name":"active","type":"boolean","description":"Whether the hold is currently active.","nullable":false},{"name":"imposed_at","type":"datetime","description":"Timestamp when the legal hold was imposed.","nullable":false},{"name":"released_at","type":"datetime","description":"Timestamp when the hold was released, if applicable.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["target_table","target_row_id","active"],"unique":true}],"plainIndexes":[{"fieldNames":["active","imposed_at"]},{"fieldNames":["shopping_mall_ai_channel_id","imposed_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_data_retention_policies","description":"Data retention policies describing data categories, legal bases, and durations. Configurable per channel or platform-wide (channel null). Used by purge jobs and evidence governance. References {@link shopping_mall_ai_channels} optionally for channel-specific policies.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel for policy applicability {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"code","type":"string","description":"Unique policy code within channel or platform.","nullable":false},{"name":"name","type":"string","description":"Human-readable policy name.","nullable":false},{"name":"description","type":"string","description":"Detailed description of the policy scope and application rules.","nullable":true},{"name":"data_category","type":"string","description":"Data category identifier (e.g., transactional, UGC, identity_evidence).","nullable":false},{"name":"retention_period_days","type":"int","description":"Retention duration in days for the category under this policy.","nullable":false},{"name":"legal_basis","type":"string","description":"Legal basis summary (e.g., contract, legal_obligation, consent, legitimate_interest).","nullable":false},{"name":"active","type":"boolean","description":"Whether the policy is currently active and enforceable.","nullable":false},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp.","nullable":true}],"uniqueIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","code"],"unique":true}],"plainIndexes":[{"fieldNames":["active"]},{"fieldNames":["data_category","active"]}],"ginIndexes":[{"fieldName":"name"},{"fieldName":"description"}]},{"name":"shopping_mall_ai_privacy_events","description":"Immutable privacy-related evidence events (e.g., consent changes, access decisions, DSAR lifecycle steps). Records actor/subject identities, channel context, resource linkages, outcomes, and connection metadata for audit and forensics. Related to {@link shopping_mall_ai_channels} and {@link shopping_mall_ai_customers}.","material":false,"stance":"snapshot","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Channel where the event occurred. {@link shopping_mall_ai_channels.id}","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels"},"unique":false,"nullable":false},{"name":"actor_shopping_mall_ai_customer_id","type":"uuid","description":"Optional actor identity (who performed the action). {@link shopping_mall_ai_customers.id}","relation":{"name":"actor","targetModel":"shopping_mall_ai_customers","mappingName":"shopping_mall_ai_privacy_events_of_actor_shopping_mall_31a7364e"},"unique":false,"nullable":true},{"name":"subject_shopping_mall_ai_customer_id","type":"uuid","description":"Optional subject identity (whose data is affected). {@link shopping_mall_ai_customers.id}","relation":{"name":"subject","targetModel":"shopping_mall_ai_customers","mappingName":"shopping_mall_ai_privacy_events_of_subject_shopping_ma_01e45dac"},"unique":false,"nullable":true}],"plainFields":[{"name":"event_type","type":"string","description":"Event type category (e.g., consent_granted, pii_access_denied, dsar_verified).","nullable":false},{"name":"resource_table","type":"string","description":"Related resource table name, if applicable.","nullable":true},{"name":"resource_id","type":"uuid","description":"Related resource UUID, if applicable.","nullable":true},{"name":"ip","type":"string","description":"Connection IP captured at event time.","nullable":true},{"name":"user_agent","type":"string","description":"User agent or device attributes.","nullable":true},{"name":"url","type":"uri","description":"Access URL, if applicable.","nullable":true},{"name":"referrer_uri","type":"uri","description":"Referrer URL, if applicable.","nullable":true},{"name":"outcome","type":"string","description":"Outcome category (allow, deny, review, error).","nullable":false},{"name":"reason","type":"string","description":"Free-text reason or decision note.","nullable":true},{"name":"created_at","type":"datetime","description":"Event creation timestamp (time of occurrence).","nullable":false},{"name":"updated_at","type":"datetime","description":"Technical update timestamp (rare for immutable events).","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft deletion timestamp (typically unused).","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["shopping_mall_ai_channel_id","created_at"]},{"fieldNames":["event_type","created_at"]},{"fieldNames":["actor_shopping_mall_ai_customer_id"]},{"fieldNames":["subject_shopping_mall_ai_customer_id"]},{"fieldNames":["resource_table","resource_id","created_at"]}],"ginIndexes":[{"fieldName":"reason"}]},{"name":"shopping_mall_ai_security_incidents","description":"Security incidents lifecycle management including discovery, containment, notifications, and root cause. Supports compliance reporting and links to related legal holds when applicable. References {@link shopping_mall_ai_channels}, {@link shopping_mall_ai_customers} (creator/owner), and optional {@link shopping_mall_ai_legal_holds}.","material":false,"stance":"primary","primaryField":{"name":"id","type":"uuid","description":"Primary Key."},"foreignFields":[{"name":"shopping_mall_ai_channel_id","type":"uuid","description":"Optional channel where the incident occurred {@link shopping_mall_ai_channels.id}.","relation":{"name":"channel","targetModel":"shopping_mall_ai_channels","targetField":"id"},"unique":false,"nullable":true},{"name":"created_by_shopping_mall_ai_customer_id","type":"uuid","description":"Incident creator/owner {@link shopping_mall_ai_customers.id}.","relation":{"name":"creator","targetModel":"shopping_mall_ai_customers","targetField":"id"},"unique":false,"nullable":false},{"name":"shopping_mall_ai_legal_hold_id","type":"uuid","description":"Optional linked legal hold {@link shopping_mall_ai_legal_holds.id}.","relation":{"name":"legalHold","targetModel":"shopping_mall_ai_legal_holds","targetField":"id"},"unique":false,"nullable":true}],"plainFields":[{"name":"title","type":"string","description":"Short incident title for identification.","nullable":false},{"name":"description","type":"string","description":"Detailed description of the incident and impact.","nullable":false},{"name":"severity","type":"string","description":"Severity category (e.g., low, medium, high, critical).","nullable":false},{"name":"status","type":"string","description":"Workflow status (e.g., open, investigating, contained, resolved, closed).","nullable":false},{"name":"discovered_at","type":"datetime","description":"Timestamp when the incident was discovered.","nullable":false},{"name":"contained_at","type":"datetime","description":"Timestamp when containment was achieved, if applicable.","nullable":true},{"name":"notified_authorities_at","type":"datetime","description":"Timestamp when authorities were notified, if applicable.","nullable":true},{"name":"public_disclosure_uri","type":"uri","description":"Public disclosure link if published.","nullable":true},{"name":"root_cause","type":"string","description":"Root cause summary or notes, if known.","nullable":true},{"name":"created_at","type":"datetime","description":"Creation timestamp.","nullable":false},{"name":"updated_at","type":"datetime","description":"Last update timestamp.","nullable":false},{"name":"deleted_at","type":"datetime","description":"Soft-deletion timestamp.","nullable":true}],"uniqueIndexes":[],"plainIndexes":[{"fieldNames":["status","severity"]},{"fieldNames":["shopping_mall_ai_channel_id","discovered_at"]}],"ginIndexes":[{"fieldName":"title"},{"fieldName":"description"}]}]}]}